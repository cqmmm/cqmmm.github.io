<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Warner&#039;s Wiki</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Warner&#039;s Wiki"><meta name="msapplication-TileImage" content="/logo.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Warner&#039;s Wiki"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Warner&#039;s Wiki"><meta property="og:url" content="https://cqmmm.github.io/"><meta property="og:site_name" content="Warner&#039;s Wiki"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cqmmm.github.io/img/og_image.png"><meta property="article:author" content="Warner"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://cqmmm.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://cqmmm.github.io"},"headline":"Warner's Wiki","image":["https://cqmmm.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Warner"},"publisher":{"@type":"Organization","name":"Warner's Wiki","logo":{"@type":"ImageObject","url":"https://cqmmm.github.io/logo.jpg"}},"description":""}</script><link rel="icon" href="/logo.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/logo.jpg" alt="Warner&#039;s Wiki" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/cqmmm/"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-02-18T08:06:41.000Z" title="2/18/2024, 4:06:41 PM">2024-02-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-18T09:14:58.446Z" title="2/18/2024, 5:14:58 PM">2024-02-18</time></span><span class="level-item">6 minutes read (About 850 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/02/18/nexus/">Nexus</a></p><div class="content"><p>Nexus æ˜¯ä¸€ä¸ªç”¨äºä¸“é—¨æ­å»º Maven ä»“åº“çš„è½¯ä»¶ï¼Œé™¤äº†ä½œä¸º Maven ä»“åº“ï¼Œå®ƒè¿˜èƒ½å¤Ÿä½œä¸º Docker é•œåƒä»“åº“ã€Yum ä»“åº“ç­‰ç­‰ã€‚</p>
<h2 id="Nexus-éƒ¨ç½²"><a href="#Nexus-éƒ¨ç½²" class="headerlink" title="Nexus éƒ¨ç½²"></a>Nexus éƒ¨ç½²</h2><p><strong>deploy.yaml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nexus</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nexus</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nexus</span></span><br><span class="line">  <span class="attr">strategy:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nexus</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">volume-mount-hack</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">busybox:latest</span></span><br><span class="line">          <span class="attr">command:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">sh</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;-c&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;chown -R 200:200 /nexus-data&#x27;</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nexus-data</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/nexus-data</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">sonatype/nexus3:3.37.3</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nexus</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8081</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">INSTALL4J_ADD_VM_PARAMS</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;-Xms2703m -Xmx2703m -XX:MaxDirectMemorySize=2703m -Djava.util.prefs.userRoot=$&#123;NEXUS_DATA&#125;/javaprefs&quot;</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">2000m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">2048Mi</span>      </span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">2000m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">2048Mi</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nexus-data</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/nexus-data</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nexus-data</span></span><br><span class="line">        <span class="comment"># è‡ªè¡Œä¿®æ”¹æŒ‚è½½ç±»å‹ï¼Œä¸ä¿®æ”¹åˆ™éœ€åˆ›å»ºå¯¹åº”PVå’ŒPVCğŸ‘‡</span></span><br><span class="line">        <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">          <span class="attr">claimName:</span> <span class="string">nexus-data</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nexus</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nexus</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nexus</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8081</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nexus</span></span><br></pre></td></tr></table></figure>

<p>éƒ¨ç½²åï¼Œåœ¨å®¹å™¨å†…éƒ¨è·å– admin å¯†ç </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $(cat /nexus-data/admin.password)</span><br></pre></td></tr></table></figure>

<h2 id="é»˜è®¤ä»“åº“è¯´æ˜"><a href="#é»˜è®¤ä»“åº“è¯´æ˜" class="headerlink" title="é»˜è®¤ä»“åº“è¯´æ˜"></a>é»˜è®¤ä»“åº“è¯´æ˜</h2><ul>
<li>maven-centralï¼šä¸­å¤®ä»“åº“ï¼Œé»˜è®¤ä» <code>https://repo1.maven.org/maven2/</code> æ‹‰å– jar åŒ…</li>
<li>maven-releasesï¼šç§åº“å‘è¡Œ jarï¼Œå»ºè®®å°†è®¾ç½®æ”¹ä¸º <code>Allow redeploy</code></li>
<li>maven-snapshotsï¼šç§åº“å¿«ç…§ jarï¼Œå³åº“ä¸­çš„ jar å‡ä¸ºè°ƒè¯•ç‰ˆæœ¬</li>
<li>maven-publicï¼šä»“åº“åˆ†ç»„ï¼ŒæŠŠä¸Šé¢ä¸‰ä¸ªä»“åº“ç»„åˆåœ¨ä¸€èµ·å¯¹å¤–æä¾›æœåŠ¡ï¼Œåœ¨æœ¬åœ° maven çš„ settings.xml æ–‡ä»¶æˆ–é¡¹ç›®çš„ pom.xml æ–‡ä»¶è®¾ç½®ä¸ºè¯¥ä»“åº“åœ°å€ï¼Œå³å¯è°ƒç”¨</li>
</ul>
<h2 id="ä»“åº“ç±»å‹è¯´æ˜"><a href="#ä»“åº“ç±»å‹è¯´æ˜" class="headerlink" title="ä»“åº“ç±»å‹è¯´æ˜"></a>ä»“åº“ç±»å‹è¯´æ˜</h2><ul>
<li>groupï¼šä»“åº“ç»„ï¼Œèµ·åˆ°äº†èšåˆçš„ä½œç”¨ï¼Œåœ¨è¯¥ç»„ä¸­çš„ä»“åº“éƒ½å¯ä»¥é€šè¿‡è¯¥ç»„çš„ URL è¿›è¡Œè®¿é—®</li>
<li>hostedï¼šç§æœ‰ä»“åº“ï¼Œé¡¾åæ€ä¹‰ï¼Œç”¨æ¥å­˜å‚¨è‡ªå·±çš„ jar åŒ…</li>
<li>snapshotï¼šå¿«ç…§ä»“åº“</li>
<li>releaseï¼šæœ¬åœ°é¡¹ç›®çš„æ­£å¼ç‰ˆæœ¬ä»“åº“</li>
<li>proxyï¼šä»£ç†ï¼ŒNexus çš„ maven-central å°±æ˜¯è¿™ç§ç±»å‹ï¼Œä»£ç†åœ°å€ä¸º <code>https://repo1.maven.org/maven2/</code> ï¼Œé»˜è®¤ä¼šå»è¯¥åœ°å€ä¸‹æ‹‰å– jar åŒ…</li>
<li>centralï¼šä¸­å¤®ä»“åº“</li>
</ul>
<h2 id="æ–°å¢ä»£ç†ä»“åº“"><a href="#æ–°å¢ä»£ç†ä»“åº“" class="headerlink" title="æ–°å¢ä»£ç†ä»“åº“"></a>æ–°å¢ä»£ç†ä»“åº“</h2><p>åˆ›å»ºä»“åº“é€‰æ‹© <code>maven2(proxy)</code> ç±»å‹</p>
<p><img src="/2024/02/18/nexus/%E6%96%B0%E5%A2%9E%E4%BB%A3%E7%90%86%E4%BB%93%E5%BA%93.png" alt="æ–°å¢ä»£ç†ä»“åº“"></p>
<p>æ·»åŠ åˆ° <code>maven-public</code></p>
<p><img src="/2024/02/18/nexus/%E6%B7%BB%E5%8A%A0%E5%88%B0%E7%BB%84.png" alt="æ·»åŠ åˆ°ç»„"></p>
<h2 id="Maven-é…ç½®ä½¿ç”¨ç§æœ"><a href="#Maven-é…ç½®ä½¿ç”¨ç§æœ" class="headerlink" title="Maven é…ç½®ä½¿ç”¨ç§æœ"></a>Maven é…ç½®ä½¿ç”¨ç§æœ</h2><p>è¦åœ¨æœ¬åœ° Maven åœ¨ç§æœæ‹‰å– jar çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>settings.xmlï¼šå…¨å±€é…ç½®æ¨¡å¼</li>
<li>pom.xmlï¼šé¡¹ç›®ç‹¬äº«æ¨¡å¼</li>
</ul>
<p>å¦‚æœä¸¤ç§æ–¹å¼éƒ½é…ç½®äº†ï¼Œé‚£ä¹ˆä»¥ pom.xml æ–‡ä»¶é…ç½®ä¸ºå‡†ã€‚</p>
<p>å½“æˆ‘ä»¬é€šè¿‡ Maven ä½¿ç”¨ Nexus çš„ <code>maven-public</code> çš„æ—¶å€™ï¼Œä¼šæŒ‰ç…§ä»¥ä¸‹æ–¹å¼é¡ºåºè®¿é—®ï¼š</p>
<ol>
<li><p>æœ¬åœ°ä»“åº“</p>
</li>
<li><p>ç§æœ maven-releases</p>
</li>
<li><p>ç§æœ maven-snapshots</p>
</li>
<li><p>è¿œç¨‹é˜¿é‡Œ maven ä»“åº“</p>
</li>
<li><p>è¿œç¨‹ä¸­å¤®ä»“åº“</p>
</li>
</ol>
<h3 id="é€šè¿‡-settings-xml-æ–‡ä»¶é…ç½®"><a href="#é€šè¿‡-settings-xml-æ–‡ä»¶é…ç½®" class="headerlink" title="é€šè¿‡ settings.xml æ–‡ä»¶é…ç½®"></a>é€šè¿‡ settings.xml æ–‡ä»¶é…ç½®</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- serverså—ä¸­æ·»åŠ ç”¨æˆ·è®¤è¯ä¿¡æ¯ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">password</span>&gt;</span>changeme<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mirrorså—ä¸­æ·»åŠ maven-publicä¿¡æ¯ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- å”¯ä¸€æ ‡è¯†ç¬¦ --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span> </span><br><span class="line">   <span class="comment">&lt;!-- åç§° --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>cqm maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- maven-publicåœ°å€ --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.159.11:35826/repository/maven-public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- *æŒ‡çš„æ˜¯è®¿é—®ä»»ä½•ä»“åº“éƒ½ä½¿ç”¨æˆ‘ä»¬çš„ç§æœï¼Œå¯è®¾ç½®ä¸ºcentralç­‰ç­‰ --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºé˜¿é‡Œçš„</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="é€šè¿‡-pom-xml-æ–‡ä»¶é…ç½®"><a href="#é€šè¿‡-pom-xml-æ–‡ä»¶é…ç½®" class="headerlink" title="é€šè¿‡ pom.xml æ–‡ä»¶é…ç½®"></a>é€šè¿‡ pom.xml æ–‡ä»¶é…ç½®</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>mnexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>cqm nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.159.11:35826/repository/maven-public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åŒæ ·ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºé˜¿é‡Œçš„</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">updatePolicy</span>&gt;</span>always<span class="tag">&lt;/<span class="name">updatePolicy</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">checksumPolicy</span>&gt;</span>fail<span class="tag">&lt;/<span class="name">checksumPolicy</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨-Maven-æ‰¹é‡å‘-Nexus-ä¸Šä¼ "><a href="#ä½¿ç”¨-Maven-æ‰¹é‡å‘-Nexus-ä¸Šä¼ " class="headerlink" title="ä½¿ç”¨ Maven æ‰¹é‡å‘ Nexus ä¸Šä¼ "></a>ä½¿ç”¨ Maven æ‰¹é‡å‘ Nexus ä¸Šä¼ </h2><p>é¦–å…ˆéœ€è¦å°† <code>.m2/repository</code> ä¸‹çš„ç›¸åº” jar åŒ…å’Œ pom æ–‡ä»¶ cp å‡ºæ¥ï¼Œå†è¿›è¡Œ deployã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-DrepositoryId å‚æ•°è°ƒç”¨äº† settings.xml ä¸­ servers å—çš„è´¦å·å¯†ç è¿›è¡Œè®¤è¯</span></span><br><span class="line">find . -name &quot;*.jar&quot; | awk &#x27;&#123; gsub(&quot;\.jar$&quot;,&quot;&quot;,$0); print &quot;mvn deploy:deploy-file -Dfile=&quot;$0&quot;.jar -DpomFile=&quot;$0&quot;.pom -Dpackaging=jar -DrepositoryId=nexus -Durl=\&quot;http://nexus-path\&quot;&quot;&#125;&#x27;	</span><br></pre></td></tr></table></figure>

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-02-18T08:06:41.000Z" title="2/18/2024, 4:06:41 PM">2024-02-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-18T11:05:34.526Z" title="2/18/2024, 7:05:34 PM">2024-02-18</time></span><span class="level-item">31 minutes read (About 4642 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/02/18/prometheus/">Prometheus</a></p><div class="content"><p><img src="/2024/02/18/prometheus/prometheus_logo.jpg" alt="prometheus_logo"></p>
<p>Prometheusæ˜¯ä¸€ä¸ªå¼€æºçš„<strong>äº‘åŸç”Ÿ</strong>ç›‘æ§ç³»ç»Ÿå’Œæ—¶é—´åºåˆ—æ•°æ®åº“ã€‚</p>
<h2 id="ä¸€ã€Prometheusæ¦‚è¿°"><a href="#ä¸€ã€Prometheusæ¦‚è¿°" class="headerlink" title="ä¸€ã€Prometheusæ¦‚è¿°"></a>ä¸€ã€Prometheusæ¦‚è¿°</h2><p>Prometheus ä½œä¸ºæ–°ä¸€ä»£çš„äº‘åŸç”Ÿç›‘æ§ç³»ç»Ÿï¼Œç›®å‰å·²ç»æœ‰è¶…è¿‡ 650+ä½è´¡çŒ®è€…å‚ä¸åˆ° Prometheus çš„ç ”å‘å·¥ä½œä¸Šï¼Œå¹¶ä¸”è¶…è¿‡ 120+é¡¹çš„ç¬¬ä¸‰æ–¹é›†æˆã€‚</p>
<h3 id="1-1-Prometheusçš„ä¼˜ç‚¹"><a href="#1-1-Prometheusçš„ä¼˜ç‚¹" class="headerlink" title="1.1 Prometheusçš„ä¼˜ç‚¹"></a>1.1 Prometheusçš„ä¼˜ç‚¹</h3><ol>
<li><strong>æä¾›å¤šç»´åº¦æ•°æ®æ¨¡å‹å’Œçµæ´»çš„æŸ¥è¯¢æ–¹å¼</strong>ï¼Œé€šè¿‡å°†ç›‘æ§æŒ‡æ ‡å…³è”å¤šä¸ª tagï¼Œæ¥å°†ç›‘æ§æ•°æ®è¿›è¡Œä»»æ„ç»´åº¦çš„ç»„åˆï¼Œå¹¶ä¸”æä¾›ç®€å•çš„ PromQL æŸ¥è¯¢æ–¹å¼ï¼Œè¿˜æä¾› HTTP æŸ¥è¯¢æ¥å£ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç»“åˆ Grafana ç­‰ GUI ç»„ä»¶å±•ç¤ºæ•°æ®ã€‚</li>
<li>åœ¨ä¸ä¾èµ–å¤–éƒ¨å­˜å‚¨çš„æƒ…å†µä¸‹ï¼Œ<strong>æ”¯æŒæœåŠ¡å™¨èŠ‚ç‚¹çš„æœ¬åœ°å­˜å‚¨</strong>ï¼Œé€šè¿‡ Prometheus è‡ªå¸¦çš„æ—¶åºæ•°æ®åº“ï¼Œå¯ä»¥å®Œæˆæ¯ç§’åƒä¸‡çº§çš„æ•°æ®å­˜å‚¨ï¼›ä¸ä»…å¦‚æ­¤ï¼Œåœ¨ä¿å­˜å¤§é‡å†å²æ•°æ®çš„åœºæ™¯ä¸­ï¼ŒPrometheus å¯ä»¥å¯¹æ¥ç¬¬ä¸‰æ–¹æ—¶åºæ•°æ®åº“å’Œ OpenTSDB ç­‰ã€‚</li>
<li><strong>å®šä¹‰äº†å¼€æ”¾æŒ‡æ ‡æ•°æ®æ ‡å‡†</strong>ï¼Œä»¥åŸºäº HTTP çš„ Pull æ–¹å¼é‡‡é›†æ—¶åºæ•°æ®ï¼Œåªæœ‰å®ç°äº† Prometheus ç›‘æ§æ•°æ®æ‰å¯ä»¥è¢« Prometheus é‡‡é›†ã€æ±‡æ€»ã€å¹¶æ”¯æŒ Push æ–¹å¼å‘ä¸­é—´ç½‘å…³æ¨é€æ—¶åºåˆ—æ•°æ®ï¼Œèƒ½æ›´åŠ çµæ´»åœ°åº”å¯¹å¤šç§ç›‘æ§åœºæ™¯ã€‚</li>
<li><strong>æ”¯æŒé€šè¿‡é™æ€æ–‡ä»¶é…ç½®å’ŒåŠ¨æ€å‘ç°æœºåˆ¶å‘ç°ç›‘æ§å¯¹è±¡ï¼Œè‡ªåŠ¨å®Œæˆæ•°æ®é‡‡é›†</strong>ã€‚</li>
<li>Prometheus ç›®å‰å·²ç»æ”¯æŒ Kubernetesã€etcdã€Consul ç­‰å¤šç§æœåŠ¡å‘ç°æœºåˆ¶ã€‚<strong>æ˜“äºç»´æŠ¤</strong>ï¼Œå¯ä»¥é€šè¿‡äºŒè¿›åˆ¶æ–‡ä»¶ç›´æ¥å¯åŠ¨ï¼Œå¹¶ä¸”æä¾›äº†å®¹å™¨åŒ–éƒ¨ç½²é•œåƒã€‚</li>
<li><strong>æ”¯æŒæ•°æ®çš„åˆ†åŒºé‡‡æ ·å’Œè”é‚¦éƒ¨ç½²ï¼Œæ”¯æŒå¤§è§„æ¨¡é›†ç¾¤ç›‘æ§ã€‚</strong></li>
</ol>
<h3 id="1-2-PrometheusåŸºæœ¬ç»„ä»¶"><a href="#1-2-PrometheusåŸºæœ¬ç»„ä»¶" class="headerlink" title="1.2 PrometheusåŸºæœ¬ç»„ä»¶"></a>1.2 PrometheusåŸºæœ¬ç»„ä»¶</h3><ol>
<li>Prometheus Serverï¼šæ˜¯ Prometheus ç»„ä»¶ä¸­çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œè´Ÿè´£å®ç°å¯¹ç›‘æ§æ•°æ®çš„è·å–ï¼Œå­˜å‚¨ä»¥åŠæŸ¥è¯¢ã€‚æ”¶é›†åˆ°çš„æ•°æ®ç»Ÿç§°ä¸º<strong>metrics</strong>ã€‚</li>
<li>Push Gatewayï¼šå½“ç½‘ç»œéœ€æ±‚æ— æ³•ç›´æ¥æ»¡è¶³æ—¶ï¼Œå°±å¯ä»¥åˆ©ç”¨ Push Gateway æ¥è¿›è¡Œä¸­è½¬ã€‚å¯ä»¥é€šè¿‡ Push Gateway å°†å†…éƒ¨ç½‘ç»œçš„ç›‘æ§æ•°æ®ä¸»åŠ¨ <strong>Push</strong> åˆ° Gateway å½“ä¸­ã€‚è€Œ Prometheus Server åˆ™å¯ä»¥é‡‡ç”¨åŒæ · <strong>Pull</strong> çš„æ–¹å¼ä» Push Gateway ä¸­è·å–åˆ°ç›‘æ§æ•°æ®ã€‚</li>
<li>Exporterï¼šä¸»è¦ç”¨æ¥é‡‡é›†æ•°æ®ï¼Œå¹¶é€šè¿‡ HTTP æœåŠ¡çš„å½¢å¼æš´éœ²ç»™ Prometheus Serverï¼ŒPrometheus Server é€šè¿‡è®¿é—®è¯¥ Exporter æä¾›çš„æ¥å£ï¼Œå³å¯è·å–åˆ°éœ€è¦é‡‡é›†çš„ç›‘æ§æ•°æ®ã€‚</li>
<li>Alert managerï¼šç®¡ç†å‘Šè­¦ï¼Œä¸»è¦æ˜¯è´Ÿè´£å®ç°æŠ¥è­¦åŠŸèƒ½ã€‚ç°åœ¨grafanaä¹Ÿèƒ½å®ç°æŠ¥è­¦åŠŸèƒ½ï¼Œæ‰€ä»¥ä¹Ÿæ…¢æ…¢è¢«å–ä»£ã€‚</li>
</ol>
<p><img src="/2024/02/18/prometheus/Prometheus%E6%9E%B6%E6%9E%84.png" alt="Prometheusæ¶æ„"></p>
<h3 id="1-3-Prometheusæ•°æ®ç±»å‹"><a href="#1-3-Prometheusæ•°æ®ç±»å‹" class="headerlink" title="1.3 Prometheusæ•°æ®ç±»å‹"></a>1.3 Prometheusæ•°æ®ç±»å‹</h3><ol>
<li>Counterï¼ˆè®¡æ•°å™¨ç±»å‹ï¼‰ï¼šCounterç±»å‹çš„æŒ‡æ ‡çš„å·¥ä½œæ–¹å¼å’Œè®¡æ•°å™¨ä¸€æ ·ï¼Œåªå¢ä¸å‡ï¼ˆé™¤éç³»ç»Ÿå‘ç”Ÿäº†é‡ç½®ï¼‰ã€‚</li>
<li>Gaugeï¼ˆä»ªè¡¨ç›˜ç±»å‹ï¼‰ï¼šGaugeæ˜¯å¯å¢å¯å‡çš„æŒ‡æ ‡ç±»ï¼Œå¯ä»¥ç”¨äºååº”å½“å‰åº”ç”¨çš„çŠ¶æ€ã€‚</li>
<li>Histogramï¼ˆç›´æ–¹å›¾ç±»å‹ï¼‰ï¼šä¸»è¦ç”¨äºè¡¨ç¤ºä¸€æ®µæ—¶é—´èŒƒå›´å†…å¯¹æ•°æ®è¿›è¡Œé‡‡æ ·ï¼ˆé€šå¸¸æ˜¯è¯·æ±‚æŒç»­æ—¶é—´æˆ–å“åº”å¤§å°ï¼‰ï¼Œå¹¶èƒ½å¤Ÿå¯¹å…¶æŒ‡å®šåŒºé—´ä»¥åŠæ€»æ•°è¿›è¡Œç»Ÿè®¡ï¼Œé€šå¸¸å®ƒé‡‡é›†çš„æ•°æ®å±•ç¤ºä¸ºç›´æ–¹å›¾ã€‚</li>
<li>Summaryï¼ˆæ‘˜è¦ç±»å‹ï¼‰ï¼šä¸»è¦ç”¨äºè¡¨ç¤ºä¸€æ®µæ—¶é—´å†…æ•°æ®é‡‡æ ·ç»“æœï¼ˆé€šå¸¸æ˜¯è¯·æ±‚æŒç»­æ—¶é—´æˆ–å“åº”å¤§å°ï¼‰ã€‚</li>
</ol>
<h2 id="äºŒã€Prometheuså®‰è£…"><a href="#äºŒã€Prometheuså®‰è£…" class="headerlink" title="äºŒã€Prometheuså®‰è£…"></a>äºŒã€Prometheuså®‰è£…</h2><h3 id="2-1-Prometheus-serverå®‰è£…"><a href="#2-1-Prometheus-serverå®‰è£…" class="headerlink" title="2.1 Prometheus serverå®‰è£…"></a>2.1 Prometheus serverå®‰è£…</h3><ol>
<li>Prometheuså®‰è£…è¾ƒä¸ºç®€å•ï¼Œä¸‹è½½è§£å‹å³å¯</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/prometheus/prometheus/releases/download/v2.26.0-rc.0/prometheus-2.26.0-rc.0.linux-amd64.tar.gz</span><br><span class="line">tar -xf prometheus-2.26.0-rc.0.linux-amd64.tar.gz</span><br><span class="line">mv prometheus-2.26.0-rc.0.linux-amd64 prometheus</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>prometheus.ymlé…ç½®æ–‡ä»¶</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…¨å±€é…ç½®</span></span><br><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span>     <span class="string">15s</span> <span class="comment"># è®¾ç½®æŠ“å–é—´éš”ï¼Œé»˜è®¤ä¸º1åˆ†é’Ÿ</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">15s</span> <span class="comment"># ä¼°ç®—è§„åˆ™çš„é»˜è®¤å‘¨æœŸï¼Œæ¯15ç§’è®¡ç®—ä¸€æ¬¡è§„åˆ™ï¼Œé»˜è®¤1åˆ†é’Ÿ</span></span><br><span class="line">  <span class="comment"># scrape_timeout # é»˜è®¤æŠ“å–è¶…æ—¶ï¼Œé»˜è®¤ä¸º10s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠ¥è­¦é…ç½®</span></span><br><span class="line"><span class="attr">alerting:</span></span><br><span class="line">  <span class="attr">alertmanagers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">      <span class="comment"># - alertmanager:9093</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§„åˆ™æ–‡ä»¶åˆ—è¡¨ï¼Œä½¿ç”¨&#x27;evaluation_interval&#x27; å‚æ•°å»æŠ“å–</span></span><br><span class="line"><span class="attr">rule_files:</span></span><br><span class="line">  <span class="comment"># - &quot;first_rules.yml&quot;</span></span><br><span class="line">  <span class="comment"># - &quot;second_rules.yml&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠ“å–é…ç½®åˆ—è¡¨</span></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="comment"># ä»»åŠ¡åç§°</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span></span><br><span class="line">    <span class="comment"># è¦è¢«ç›‘æ§çš„å®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åˆ›å»ºPrometheusçš„ç”¨æˆ·åŠæ•°æ®å­˜å‚¨ç›®å½•</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">groupadd prometheus</span><br><span class="line">useradd -g prometheus -s /sbin/nologin prometheus</span><br><span class="line">mkdir /root/prometheus/data</span><br><span class="line">chown -R prometheus:prometheus /root/prometheus</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>Prometheusçš„å¯åŠ¨å¾ˆç®€å•ï¼Œåªéœ€è¦ç›´æ¥å¯åŠ¨è§£å‹ç›®å½•çš„äºŒè¿›åˆ¶æ–‡ä»¶Prometheuså³å¯ï¼Œä½†æ˜¯ä¸ºäº†æ›´åŠ æ–¹ä¾¿å¯¹Prometheusè¿›è¡Œç®¡ç†ï¼Œè¿™é‡Œç¼–å†™è„šæœ¬æˆ–è€…ä½¿ç”¨screenå·¥å…·æ¥è¿›è¡Œå¯åŠ¨</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /root/prometheus/start.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">prometheus_dir=/root/prometheus</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;prometheus_dir&#125;/prometheus --config.file=<span class="variable">$&#123;prometheus_dir&#125;</span>/prometheus.yml --storage.tsdb.path=<span class="variable">$&#123;prometheus_dir&#125;</span>/data --storage.tsdb.retention.time=24h --web.enable-lifecycle --storage.tsdb.no-lockfile</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--config.file:æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--storage.tsdb.path:æŒ‡å®štsdbè·¯å¾„</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--storage.tsdb.retention.time:æŒ‡å®šæ•°æ®å­˜å‚¨æ—¶é—´</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--web.enable-lifecycle:ç±»ä¼¼nginxçš„reloadåŠŸèƒ½</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--storage.tsdb.no-lockfile:å¦‚æœç”¨k8sçš„deploymentç®¡ç†éœ€åŠ æ­¤é¡¹</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>å¯åŠ¨Prometheusåè®¿é—®</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">nohup</span>è‹±æ–‡å…¨ç§°no hang upï¼ˆä¸æŒ‚èµ·ï¼‰ï¼Œç”¨äºåœ¨ç³»ç»Ÿåå°ä¸æŒ‚æ–­åœ°è¿è¡Œå‘½ä»¤ï¼Œé€€å‡ºç»ˆç«¯ä¸ä¼šå½±å“ç¨‹åºçš„è¿è¡Œã€‚</span></span><br><span class="line">nohup sh start.sh 2&gt;&amp;1 &gt; prometheus.log</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/18/prometheus/Prometheus%E5%AE%89%E8%A3%85%E4%B8%80.png" alt="Prometheuså®‰è£…ä¸€"></p>
<ol start="6">
<li>ç”¨screenå·¥å…·è¿›è¡Œå¯åŠ¨</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yum -y install screen</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥åå°</span></span><br><span class="line">screen</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿è¡Œè„šæœ¬</span></span><br><span class="line">/root/prometheus/prometheus --config.file=/root/prometheus/prometheus.yml --storage.tsdb.path=/root/prometheus/data --storage.tsdb.retention.time=24h --web.enable-lifecycle --storage.tsdb.no-lockfile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¾“å…¥CTRL + A + Dæ’¤å›å‰å°</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹åå°è¿è¡Œçš„è„šæœ¬</span></span><br><span class="line">screen -ls</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿”å›åå°</span></span><br><span class="line">screen -r åå°id</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤åå°</span></span><br><span class="line">screen -S åå°id -X quit</span><br></pre></td></tr></table></figure>

<h3 id="2-2-node-exporterå®‰è£…"><a href="#2-2-node-exporterå®‰è£…" class="headerlink" title="2.2 node exporterå®‰è£…"></a>2.2 node exporterå®‰è£…</h3><p>åœ¨Prometheusæ¶æ„ä¸­ï¼Œexporteræ˜¯è´Ÿè´£æ”¶é›†æ•°æ®å¹¶å°†ä¿¡æ¯æ±‡æŠ¥ç»™Prometheus Serverçš„ç»„ä»¶ã€‚å®˜æ–¹æä¾›äº†node_exporterå†…ç½®äº†å¯¹ä¸»æœºç³»ç»Ÿçš„åŸºç¡€ç›‘æ§ã€‚</p>
<ol>
<li>ä¸‹è½½node exporter</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/prometheus/node_exporter/releases/download/v1.1.2/node_exporter-1.1.2.linux-amd64.tar.gz</span><br><span class="line">tar -xf node_exporter-1.1.2.linux-amd64.tar.gz</span><br><span class="line">mv node_exporter-1.1.2.linux-amd64.tar.gz node_exporter</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åœ¨prometheus.ymlä¸­æ·»åŠ è¢«ç›‘æ§ä¸»æœº</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>,<span class="string">&#x27;localhost:9100&#x27;</span>]</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åå°å¯åŠ¨exporterå’Œé‡å¯prometheus</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">screen</span><br><span class="line">./root/node_exporter/node_exporter</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>é€šè¿‡curlå‘½ä»¤è·å–æ”¶é›†åˆ°çš„æ•°æ®key</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:9100/metrics</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>ç”¨å…¶ä¸­çš„ä¸€ä¸ªkeyåœ¨Prometheusæµ‹è¯•æ˜¯å¦è¢«ç›‘æ§</li>
</ol>
<p><img src="/2024/02/18/prometheus/node_exporter%E6%B5%8B%E8%AF%95.png" alt="node_exporteræµ‹è¯•"></p>
<h2 id="ä¸‰ã€Prometheuså‘½ä»¤è¡Œçš„ä½¿ç”¨"><a href="#ä¸‰ã€Prometheuså‘½ä»¤è¡Œçš„ä½¿ç”¨" class="headerlink" title="ä¸‰ã€Prometheuså‘½ä»¤è¡Œçš„ä½¿ç”¨"></a>ä¸‰ã€Prometheuså‘½ä»¤è¡Œçš„ä½¿ç”¨</h2><h3 id="3-1-è®¡ç®—cpuä½¿ç”¨ç‡"><a href="#3-1-è®¡ç®—cpuä½¿ç”¨ç‡" class="headerlink" title="3.1 è®¡ç®—cpuä½¿ç”¨ç‡"></a>3.1 è®¡ç®—cpuä½¿ç”¨ç‡</h3><p><img src="/2024/02/18/prometheus/%E8%AE%A1%E7%AE%97cpu%E4%BD%BF%E7%94%A8%E7%8E%87%E4%B8%80.png" alt="è®¡ç®—cpuä½¿ç”¨ç‡ä¸€"></p>
<p>é€šè¿‡ä¸Šå›¾å¯ä»¥çŸ¥é“ï¼Œlinuxçš„cpuä½¿ç”¨æ˜¯åˆ†ä¸ºå¾ˆå¤šç§çŠ¶æ€çš„ï¼Œä¾‹å¦‚ç”¨æˆ·æ€userï¼Œç©ºé—²æ€idleã€‚</p>
<p>è¦è®¡ç®—cpuçš„ä½¿ç”¨ç‡æœ‰ä¸¤ç§ç²—ç•¥çš„å…¬å¼ï¼š</p>
<ol>
<li>é™¤å»idleçŠ¶æ€çš„æ‰€æœ‰cpuçŠ¶æ€æ—¶é—´ä¹‹å’Œ &#x2F; cpuæ—¶é—´æ€»å’Œ</li>
<li>100% - ï¼ˆidleçŠ¶æ€ &#x2F; cpuæ—¶é—´æ€»å’Œï¼‰</li>
</ol>
<p>ä½†è¿™ä¸¤ç§æ–¹å¼éƒ½å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>å¦‚ä½•è®¡ç®—æŸä¸€æ—¶é—´æ®µçš„cpuä½¿ç”¨ç‡ï¼Ÿä¾‹å¦‚ç²¾ç¡®åˆ°æ¯ä¸€åˆ†é’Ÿã€‚</li>
<li>å®é™…å·¥ä½œä¸­cpuå¤§å¤šæ•°éƒ½æ˜¯å¤šæ ¸çš„ï¼Œnode exporteræˆªå–åˆ°çš„æ•°æ®ç²¾ç¡®åˆ°äº†æ¯ä¸ªæ ¸ï¼Œå¦‚ä½•ç›‘æ§æ‰€æœ‰æ ¸åŠ èµ·æ¥çš„æ•°æ®ï¼Ÿ</li>
</ol>
<p>Prometheusæä¾›äº†è®¸å¤šçš„å‡½æ•°ï¼Œå…¶ä¸­ increase å’Œ sum å°±å¾ˆå¥½çš„è§£å†³äº†ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜ã€‚</p>
<ol>
<li>æå–cpuçš„keyï¼Œå³node_cpu_seconds_total</li>
<li>æŠŠidleç©ºé—²æ—¶é—´å’Œæ€»æ—¶é—´è¿‡æ»¤å‡ºæ¥ï¼Œåœ¨Prometheusä¸­ä½¿ç”¨{}è¿›è¡Œè¿‡æ»¤</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_cpu_seconds_total&#123;mode=&#x27;idle&#x27;&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ä½¿ç”¨increaseå‡½æ•°å–ä¸€åˆ†é’Ÿå†…çš„å¢é‡</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">increase(node_cpu_seconds_total&#123;mode=&#x27;idle&#x27;&#125;[1m])</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ä½¿ç”¨sumå‡½æ•°å°†æ¯ä¸ªæ ¸çš„æ•°æ•´åˆèµ·æ¥</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(increase(node_cpu_seconds_total&#123;mode=&#x27;idle&#x27;&#125;[1m]))</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œåˆå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œsumå‡½æ•°ä¼šå°†æ‰€æœ‰æ•°æ®æ•´åˆèµ·æ¥ï¼Œä¸å…‰å°†ä¸€å°æœºå™¨çš„æ‰€æœ‰cpuåŠ åˆ°ä¸€èµ·ï¼Œä¹Ÿå°†æ‰€æœ‰æœºå™¨çš„cpuéƒ½åŠ åˆ°äº†ä¸€èµ·ï¼Œæœ€ç»ˆæ˜¾ç¤ºçš„æ˜¯é›†ç¾¤cpuçš„æ€»å¹³å‡å€¼ï¼Œby(instance)å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(increase(node_cpu_seconds_total&#123;mode=&#x27;idle&#x27;&#125;[1m])) by(instance)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¾—åˆ°äº†ç©ºé—²æ—¶cpuçš„æ•°æ®äº†ï¼Œç”¨ä¸Šè¾¹ç¬¬ä¸€ä¸ªå…¬å¼å³å¯å¾—åˆ°å•å°ä¸»æœºcpuåœ¨ä¸€åˆ†é’Ÿå†…çš„ä½¿ç”¨ç‡ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(1 - ((sum(increase(node_cpu_seconds_total&#123;mode=&#x27;idle&#x27;&#125;[1m])) by(instance)) / (sum(increase(node_cpu_seconds_total[1m])) by(instance)))) * 100</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/18/prometheus/%E8%AE%A1%E7%AE%97cpu%E4%BD%BF%E7%94%A8%E7%8E%87%E4%BA%8C.png" alt="è®¡ç®—cpuä½¿ç”¨ç‡äºŒ"></p>
<h3 id="3-2-è®¡ç®—å†…å­˜ä½¿ç”¨ç‡"><a href="#3-2-è®¡ç®—å†…å­˜ä½¿ç”¨ç‡" class="headerlink" title="3.2 è®¡ç®—å†…å­˜ä½¿ç”¨ç‡"></a>3.2 è®¡ç®—å†…å­˜ä½¿ç”¨ç‡</h3><p>å†…å­˜ä½¿ç”¨ç‡å…¬å¼ä¸º &#x3D; (available &#x2F; total) * 100</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/18/prometheus/%E8%AE%A1%E7%AE%97%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E7%8E%87.png" alt="è®¡ç®—å†…å­˜ä½¿ç”¨ç‡"></p>
<h3 id="3-3-rateå‡½æ•°"><a href="#3-3-rateå‡½æ•°" class="headerlink" title="3.3 rateå‡½æ•°"></a>3.3 rateå‡½æ•°</h3><p>rateå‡½æ•°æ˜¯ä¸“é—¨æ­é…counterç±»å‹æ•°æ®ä½¿ç”¨çš„å‡½æ•°ï¼ŒåŠŸèƒ½æ˜¯æŒ‰ç…§è®¾ç½®çš„ä¸€ä¸ªæ—¶é—´æ®µï¼Œå–counteråœ¨è¿™ä¸ªæ—¶é—´æ®µä¸­å¹³å‡æ¯ç§’çš„å¢é‡ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ï¼Œå‡è®¾æˆ‘ä»¬è¦å–ens33è¿™ä¸ªç½‘å¡åœ¨ä¸€åˆ†é’Ÿå†…å­—èŠ‚çš„æ¥å—æ•°é‡ï¼Œå‡å¦‚ä¸€åˆ†é’Ÿå†…æ¥æ”¶åˆ°çš„æ˜¯1000bytesï¼Œé‚£ä¹ˆå¹³å‡æ¯ç§’æ¥æ”¶åˆ°å°±æ˜¯1000bytes &#x2F; 1m * 60s â‰ˆ 16bytes&#x2F;sã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(node_network_receive_bytes_total&#123;device=&#x27;ens33&#x27;&#125;[1m])</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯äº”åˆ†é’Ÿçš„è¯å³ä¸º5000bytes &#x2F; 5m * 60s â‰ˆ 16bytes&#x2F;sï¼Œç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ›²çº¿å›¾å°±ä¸ä¸€æ ·äº†ï¼Œä¸Šå›¾ä¸ºä¸€åˆ†é’Ÿï¼Œä¸‹å›¾ä¸ºäº”åˆ†é’Ÿï¼Œå› ä¸ºäº”åˆ†é’Ÿçš„å¯†åº¦è¦æ›´åº•ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°äº”åˆ†é’Ÿçš„æ›²çº¿å›¾æ›´åŠ å¹³ç¼“ã€‚</p>
<p><img src="/2024/02/18/prometheus/rate%E5%87%BD%E6%95%B0%E4%B8%80.png" alt="rateå‡½æ•°ä¸€"></p>
<p><img src="/2024/02/18/prometheus/rate%E5%87%BD%E6%95%B0%E4%BA%8C.png" alt="rateå‡½æ•°äºŒ"></p>
<p>rateå’Œincreaseçš„æ¦‚å¿µæœ‰äº›ç±»ä¼¼ï¼Œä½†rateå–çš„æ˜¯ä¸€æ®µæ—¶é—´å¢é‡çš„å¹³å‡æ¯ç§’æ•°é‡ï¼Œincreaseå–çš„æ˜¯ä¸€æ®µæ—¶é—´å¢é‡çš„æ€»é‡ï¼Œå³ï¼š</p>
<ul>
<li>rate(1m)ï¼šæ€»é‡ &#x2F; 60s</li>
<li>increase(1m)ï¼šæ€»é‡</li>
</ul>
<h3 id="3-4-sumå‡½æ•°"><a href="#3-4-sumå‡½æ•°" class="headerlink" title="3.4 sumå‡½æ•°"></a>3.4 sumå‡½æ•°</h3><p>sumå‡½æ•°å°±æ˜¯å°†æ”¶åˆ°çš„æ•°æ®å…¨éƒ¨è¿›è¡Œæ•´åˆã€‚</p>
<p>å‡å¦‚ä¸€ä¸ªé›†ç¾¤é‡Œæœ‰20å°æœåŠ¡å™¨ï¼Œåˆ†åˆ«ä¸º5å°webæœåŠ¡å™¨ï¼Œ10å°dbæœåŠ¡å™¨ï¼Œè¿˜æœ‰5å°å…¶ä»–æœåŠ¡çš„æœåŠ¡å™¨ï¼Œè¿™æ—¶å€™sumå°±å¯ä»¥åˆ†ä¸ºä¸‰æ¡æ›²çº¿æ¥ä»£è¡¨ä¸åŒåŠŸèƒ½æœåŠ¡å™¨çš„æ€»å’Œæ•°æ®ã€‚</p>
<h3 id="3-5-topkå‡½æ•°"><a href="#3-5-topkå‡½æ•°" class="headerlink" title="3.5 topkå‡½æ•°"></a>3.5 topkå‡½æ•°</h3><p>topkå‡½æ•°çš„ä½œç”¨å°±æ˜¯å–å‰å‡ ä½çš„æœ€é«˜å€¼ã€‚</p>
<p><img src="/2024/02/18/prometheus/topk%E5%87%BD%E6%95%B0%E4%B8%80.png" alt="topkå‡½æ•°ä¸€"></p>
<h3 id="3-6-countå‡½æ•°"><a href="#3-6-countå‡½æ•°" class="headerlink" title="3.6 countå‡½æ•°"></a>3.6 countå‡½æ•°</h3><p>countå‡½æ•°çš„ä½œç”¨æ˜¯æŠŠç¬¦åˆæ¡ä»¶çš„æ•°å€¼è¿›è¡Œæ•´åˆã€‚</p>
<p>å‡å¦‚æˆ‘ä»¬è¦æŸ¥çœ‹é›†ç¾¤ä¸­cpuä½¿ç”¨ç‡è¶…è¿‡80%çš„ä¸»æœºæ•°é‡çš„è¯</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count((1 - ((sum(increase(node_cpu_seconds_total&#123;mode=&#x27;idle&#x27;&#125;[1m])) by(instance)) / (sum(increase(node_cpu_seconds_total[1m])) by(instance)))) * 100 &gt; 80)</span><br></pre></td></tr></table></figure>



<h2 id="å››ã€Push-gateway"><a href="#å››ã€Push-gateway" class="headerlink" title="å››ã€Push gateway"></a>å››ã€Push gateway</h2><p>Push gatewayå®é™…ä¸Šå°±æ˜¯ä¸€ç§è¢«åŠ¨æ¨é€æ•°æ®çš„æ–¹å¼ï¼Œä¸exporterä¸»åŠ¨è·å–ä¸åŒã€‚</p>
<h3 id="4-1-Push-gatewayå®‰è£…"><a href="#4-1-Push-gatewayå®‰è£…" class="headerlink" title="4.1 Push gatewayå®‰è£…"></a>4.1 Push gatewayå®‰è£…</h3><ol>
<li>ä¸‹è½½å®‰è£…Push gateway</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/prometheus/pushgateway/releases/download/v1.4.0/pushgateway-1.4.0.linux-amd64.tar.gz</span><br><span class="line">tar -xf pushgateway-1.4.0.linux-amd64.tar.gz</span><br><span class="line">mv pushgateway-1.4.0.linux-amd64 pushgateway</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åå°è¿è¡ŒPush gateway</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">screen</span><br><span class="line">./root/pushgateway/pushgateway</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åœ¨prometheus.ymlä¸­åŠ ä¸Š</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- job_name: &#x27;pushgateway&#x27;</span><br><span class="line">  static_configs:</span><br><span class="line">  - targets: [&#x27;localhost:9091&#x27;]</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/18/prometheus/%E6%B7%BB%E5%8A%A0pushgateway.png" alt="æ·»åŠ pushgateway"></p>
<h3 id="4-2-è‡ªå®šä¹‰ç¼–å†™è„šæœ¬"><a href="#4-2-è‡ªå®šä¹‰ç¼–å†™è„šæœ¬" class="headerlink" title="4.2 è‡ªå®šä¹‰ç¼–å†™è„šæœ¬"></a>4.2 è‡ªå®šä¹‰ç¼–å†™è„šæœ¬</h3><p>ç”±äºPush gatewayè‡ªå·±æœ¬èº«æ˜¯æ²¡æœ‰ä»»ä½•æŠ“å–æ•°æ®çš„åŠŸèƒ½çš„ï¼Œæ‰€ä»¥ç”¨æˆ·éœ€è¦è‡ªè¡Œç¼–å†™è„šæœ¬æ¥æŠ“å–æ•°æ®ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šç¼–å†™è„šæœ¬æŠ“å– TCP waiting_connection çš„æ•°é‡</p>
<ol>
<li>ç¼–å†™è‡ªå®šä¹‰è„šæœ¬</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–ç›‘æ§ä¸»æœºå</span></span><br><span class="line">instance_name=`hostname -f | cut -d&#x27;.&#x27; -f1`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœä¸»æœºåä¸ºlocalhostï¼Œåˆ™é€€å‡º</span></span><br><span class="line">if [ $instance_name == &quot;localhost&quot; ]</span><br><span class="line">then</span><br><span class="line">        echo &quot;ä¸èƒ½ç›‘æ§ä¸»æœºåä¸ºlocalhostçš„ä¸»æœº&quot;</span><br><span class="line">        exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">---</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–TCP CONNECTEDæ•°é‡</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ“å–TCP CONNECTEDæ•°é‡ï¼Œå®šä¹‰ä¸ºä¸€ä¸ªæ–°key</span></span><br><span class="line">lable_tcp_connected=&quot;count_netstat_connected_connections&quot;</span><br><span class="line">count_netstat_connected_connections=`netstat -an | grep &#x27;CONNECTED&#x27; | wc -l`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸Šä¼ è‡³pushgateway</span></span><br><span class="line">echo &quot;$lable_tcp_connected $count_netstat_connected_connections&quot; | curl --data-binary @- http://localhost:9091/metrics/job/pushgateway/instance/$instance_name</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">---</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¯¥è„šæœ¬æ˜¯é€šè¿‡postçš„æ–¹å¼å°†keyæ¨é€ç»™pushgateway</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">http://localhost:9091 å³æ¨é€ç»™å“ªå°pushgatewayä¸»æœº</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">job/pushgateway å³æ¨é€ç»™prometheus.ymlä¸­å®šä¹‰çš„jobä¸ºpushgatewayçš„ä¸»æœº</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">instance/<span class="variable">$instance_name</span> æ¨é€åæ˜¾ç¤ºçš„ä¸»æœºå</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å› ä¸ºè„šæœ¬éƒ½æ˜¯è¿è¡Œä¸€æ¬¡åå°±ç»“æŸäº†ï¼Œå¯ä»¥é…åˆcrontabåå¤è¿è¡Œ</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡è„šæœ¬</span></span><br><span class="line">* * * * * sh /root/pushgateway/node_exporter_shell.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¯10sæ‰§è¡Œä¸€æ¬¡è„šæœ¬</span></span><br><span class="line">* * * * * sh /root/pushgateway/node_exporter_shell.sh</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/18/prometheus/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BC%96%E5%86%99%E8%84%9A%E6%9C%AC.png" alt="è‡ªå®šä¹‰ç¼–å†™è„šæœ¬"></p>
<h3 id="4-3-ç¼–å†™æŠ“å–pingä¸¢åŒ…å’Œå»¶è¿Ÿæ—¶é—´æ•°æ®"><a href="#4-3-ç¼–å†™æŠ“å–pingä¸¢åŒ…å’Œå»¶è¿Ÿæ—¶é—´æ•°æ®" class="headerlink" title="4.3 ç¼–å†™æŠ“å–pingä¸¢åŒ…å’Œå»¶è¿Ÿæ—¶é—´æ•°æ®"></a>4.3 ç¼–å†™æŠ“å–pingä¸¢åŒ…å’Œå»¶è¿Ÿæ—¶é—´æ•°æ®</h3><p>åœ¨node_exporter_shell.shä¸­åŠ å…¥</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">---</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–pingæŸç½‘ç«™ä¸¢åŒ…ç‡å’Œå»¶è¿Ÿæ—¶é—´</span></span><br><span class="line"></span><br><span class="line">site_address=&quot;www.baidu.com&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–ä¸¢åŒ…ç‡å’Œå»¶è¿Ÿæ—¶é—´ï¼Œå®šä¹‰ä¸ºä¸¤ä¸ªæ–°key</span></span><br><span class="line">lable_ping_packet_loss=&quot;ping_packet_loss&quot;</span><br><span class="line">ping_packet_loss_test=`ping -c3 $site_address | awk &#x27;NR==7&#123;print $6&#125;&#x27;`</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å­—ç¬¦ä¸²æˆªå–ï¼Œ%?ä¸ºå»é™¤æœ€åä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">ping_packet_loss=`echo $&#123;ping_packet_loss_test%?&#125;`</span><br><span class="line"></span><br><span class="line">lable_ping_time=&quot;ping_time&quot;</span><br><span class="line">ping_time_test=`ping -c3 $site_address | awk &#x27;NR==7&#123;print $10&#125;&#x27;`</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å­—ç¬¦ä¸²æˆªå–ï¼Œ%??ä¸ºå»é™¤æœ€åä¸¤ä¸ªå­—ç¬¦</span></span><br><span class="line">ping_time=`echo $&#123;ping_time_test%??&#125;`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸Šä¼ è‡³push_ping_timegateway</span></span><br><span class="line">echo &quot;$lable_ping_packet_loss $ping_packet_loss&quot; | curl --data-binary @- http://localhost:9091/metrics/job/pushgateway/instance/$instance_name</span><br><span class="line"></span><br><span class="line">echo &quot;$lable_ping_time $ping_time&quot; | curl --data-binary @- http://localhost:9091/metrics/job/pushgateway/instance/$instance_name</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">---</span></span><br></pre></td></tr></table></figure>



<h2 id="äº”ã€Grafanaçš„ä½¿ç”¨"><a href="#äº”ã€Grafanaçš„ä½¿ç”¨" class="headerlink" title="äº”ã€Grafanaçš„ä½¿ç”¨"></a>äº”ã€Grafanaçš„ä½¿ç”¨</h2><p>Grafanaæ˜¯ä¸€æ¬¾ç”¨Goè¯­è¨€å¼€å‘çš„å¼€æºæ•°æ®å¯è§†åŒ–å·¥å…·ï¼Œå¯ä»¥åšæ•°æ®ç›‘æ§å’Œæ•°æ®ç»Ÿè®¡ï¼Œå¸¦æœ‰å‘Šè­¦åŠŸèƒ½ã€‚</p>
<h3 id="5-1-Grafanaå®‰è£…"><a href="#5-1-Grafanaå®‰è£…" class="headerlink" title="5.1 Grafanaå®‰è£…"></a>5.1 Grafanaå®‰è£…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.grafana.com/oss/release/grafana-7.5.1-1.x86_64.rpm</span><br><span class="line">yum -y install grafana-7.5.1-1.x86_64.rpm</span><br><span class="line">systemctl start grafana-server</span><br><span class="line">systemctl enable grafana-server</span><br></pre></td></tr></table></figure>

<h3 id="5-2-è®¾ç½®æ•°æ®æº"><a href="#5-2-è®¾ç½®æ•°æ®æº" class="headerlink" title="5.2 è®¾ç½®æ•°æ®æº"></a>5.2 è®¾ç½®æ•°æ®æº</h3><ol>
<li>Grafana -&gt; Configuration -&gt; Date Sources -&gt; Prometheus</li>
</ol>
<p><img src="/2024/02/18/prometheus/Grafana%E5%AE%89%E8%A3%85%E4%B8%80.png" alt="Grafanaå®‰è£…ä¸€"></p>
<ol start="2">
<li>New dashboard</li>
</ol>
<p><img src="/2024/02/18/prometheus/Grafana%E5%AE%89%E8%A3%85%E4%BA%8C.png" alt="Grafanaå®‰è£…äºŒ"></p>
<ol start="3">
<li>æ·»åŠ ä¸€ä¸ªç›‘æ§å’ŒCPUå†…å­˜ä½¿ç”¨ç‡çš„ä»ªè¡¨ç›˜</li>
</ol>
<p><img src="/2024/02/18/prometheus/Grafana%E5%AE%89%E8%A3%85%E4%B8%89.png" alt="Grafanaå®‰è£…ä¸‰"></p>
<p><img src="/2024/02/18/prometheus/Grafana%E5%AE%89%E8%A3%85%E5%9B%9B.png" alt="Grafanaå®‰è£…å››"></p>
<h3 id="5-3-jsonå¤‡ä»½å’Œè¿˜åŸ"><a href="#5-3-jsonå¤‡ä»½å’Œè¿˜åŸ" class="headerlink" title="5.3 jsonå¤‡ä»½å’Œè¿˜åŸ"></a>5.3 jsonå¤‡ä»½å’Œè¿˜åŸ</h3><ol>
<li>å¤‡ä»½ï¼šdashboard -&gt; Settings -&gt; JSON Modelï¼Œå°†é‡Œé¢å†…å®¹ä¿å­˜ä¸ºjsonæ–‡ä»¶</li>
</ol>
<p><img src="/2024/02/18/prometheus/JSON%E5%A4%87%E4%BB%BD.png" alt="JSONå¤‡ä»½"></p>
<ol start="2">
<li>æ¢å¤ï¼šCreate -&gt; import</li>
</ol>
<p><img src="/2024/02/18/prometheus/JSON%E8%BF%98%E5%8E%9F.png" alt="JSONè¿˜åŸ"></p>
<h3 id="5-4-Grafanaå®ç°æŠ¥è­¦åŠŸèƒ½"><a href="#5-4-Grafanaå®ç°æŠ¥è­¦åŠŸèƒ½" class="headerlink" title="5.4 Grafanaå®ç°æŠ¥è­¦åŠŸèƒ½"></a>5.4 Grafanaå®ç°æŠ¥è­¦åŠŸèƒ½</h3><ol>
<li>é…ç½®Grafanaæ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£…ä¾èµ–å’Œå›¾å½¢æ˜¾ç¤ºæ’ä»¶</span></span><br><span class="line">yum -y install libatk-bridge* libXss* libgtk*</span><br><span class="line">grafana-cli plugins install grafana-image-renderer</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹é…ç½®</span></span><br><span class="line">vim /etc/grafana/grafana.ini</span><br><span class="line">enabled = true</span><br><span class="line">host = smtp.163.com:25</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‘é€æŠ¥è­¦é‚®ä»¶çš„é‚®ç®±</span></span><br><span class="line">user = chenqiming13@163.com</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æˆæƒç </span></span><br><span class="line">password = QXQALYMTRYRWIOOS</span><br><span class="line">skip_verify = true</span><br><span class="line">from_address = chenqiming13@163.com</span><br><span class="line">from_name = Grafana</span><br><span class="line">systemctl restart grafana-server</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åˆ›å»ºæŠ¥è­¦è§„åˆ™</li>
</ol>
<p><img src="/2024/02/18/prometheus/Grafana%E5%AE%9E%E7%8E%B0%E6%8A%A5%E8%AD%A6%E5%8A%9F%E8%83%BD%E4%B8%80.png" alt="Grafanaå®ç°æŠ¥è­¦åŠŸèƒ½ä¸€"></p>
<p><img src="/2024/02/18/prometheus/Grafana%E5%AE%9E%E7%8E%B0%E6%8A%A5%E8%AD%A6%E5%8A%9F%E8%83%BD%E4%BA%8C.png" alt="Grafanaå®ç°æŠ¥è­¦åŠŸèƒ½äºŒ"></p>
<ol start="3">
<li>é’ˆå¯¹å…·ä½“ç›‘æ§é¡¹ï¼Œè®¾ç½®å‘é€é‚®ä»¶é˜ˆå€¼ç­‰ï¼Œè¿™é‡Œè®¾ç½®ä¸ºå‘ç°è¶…è¿‡é˜ˆå€¼èµ·5åˆ†é’Ÿåè§¦å‘æŠ¥è­¦</li>
</ol>
<p><img src="/2024/02/18/prometheus/Grafana%E5%AE%9E%E7%8E%B0%E6%8A%A5%E8%AD%A6%E5%8A%9F%E8%83%BD%E4%B8%89.png" alt="Grafanaå®ç°æŠ¥è­¦åŠŸèƒ½ä¸‰"></p>
<p><img src="/2024/02/18/prometheus/Grafana%E5%AE%9E%E7%8E%B0%E6%8A%A5%E8%AD%A6%E5%8A%9F%E8%83%BD%E5%9B%9B.png" alt="Grafanaå®ç°æŠ¥è­¦åŠŸèƒ½å››"></p>
<p><img src="/2024/02/18/prometheus/Grafana%E5%AE%9E%E7%8E%B0%E6%8A%A5%E8%AD%A6%E5%8A%9F%E8%83%BD%E4%BA%94.png" alt="Grafanaå®ç°æŠ¥è­¦åŠŸèƒ½äº”"></p>
<p><img src="/2024/02/18/prometheus/Grafana%E5%AE%9E%E7%8E%B0%E6%8A%A5%E8%AD%A6%E5%8A%9F%E8%83%BD%E5%85%AD.png" alt="Grafanaå®ç°æŠ¥è­¦åŠŸèƒ½å…­"></p>
<p>![Grafanaå®ç°æŠ¥è­¦åŠŸèƒ½ä¸ƒ](Grafanaå®ç°æŠ¥è­¦åŠŸèƒ½ä¸ƒ.png</p>
<h2 id="å…­ã€Prometheus-Grafanaå®é™…æ¡ˆä¾‹"><a href="#å…­ã€Prometheus-Grafanaå®é™…æ¡ˆä¾‹" class="headerlink" title="å…­ã€Prometheus + Grafanaå®é™…æ¡ˆä¾‹"></a>å…­ã€Prometheus + Grafanaå®é™…æ¡ˆä¾‹</h2><h3 id="6-1-predict-linearå‡½æ•°å®ç°ç¡¬ç›˜ç›‘æ§"><a href="#6-1-predict-linearå‡½æ•°å®ç°ç¡¬ç›˜ç›‘æ§" class="headerlink" title="6.1 predict_linearå‡½æ•°å®ç°ç¡¬ç›˜ç›‘æ§"></a>6.1 predict_linearå‡½æ•°å®ç°ç¡¬ç›˜ç›‘æ§</h3><p>ç¡¬ç›˜ä½¿ç”¨ç‡å…¬å¼ä¸ºï¼šï¼ˆï¼ˆæ€»å®¹é‡ - å‰©ä½™å®¹é‡ï¼‰&#x2F;  æ€»å®¹é‡ï¼‰* 100ï¼Œåœ¨Prometheusä¸­è¡¨ç¤ºä¸º</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((node_filesystem_size_bytes - node_filesystem_free_bytes) / node_filesystem_size_bytes) * 100</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡df -må¯ä»¥çœ‹å‡ºè®¡ç®—å‡ºæ¥çš„å€¼æ˜¯æ­£ç¡®çš„</p>
<p><img src="/2024/02/18/prometheus/%E8%AE%A1%E7%AE%97%E7%A1%AC%E7%9B%98%E4%BD%BF%E7%94%A8%E7%8E%87%E4%B8%80.png" alt="è®¡ç®—ç¡¬ç›˜ä½¿ç”¨ç‡ä¸€"></p>
<p>Prometheusæä¾›äº†ä¸€ä¸ªpredict_linearå‡½æ•°å¯ä»¥é¢„è®¡å¤šé•¿æ—¶é—´ç£ç›˜çˆ†æ»¡ï¼Œä¾‹å¦‚å½“å‰è¿™1ä¸ªå°æ—¶çš„ç£ç›˜å¯ç”¨ç‡æ€¥å‰§ä¸‹é™ï¼Œè¿™ç§æƒ…å†µå¯èƒ½å¯¼è‡´ç£ç›˜å¾ˆå¿«è¢«å†™æ»¡ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°ï¼Œç”¨å½“å‰1å°æ—¶çš„æ•°æ®å»é¢„æµ‹æœªæ¥å‡ ä¸ªå°æ—¶çš„çŠ¶æ€ï¼Œå®ç°æå‰æŠ¥è­¦ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¯¥å¼å­è¡¨ç¤ºç”¨å½“å‰1å°æ—¶çš„å€¼æ¥é¢„æµ‹æœªæ¥4å°æ—¶åå¦‚æœæ ¹ç›®å½•ä¸‹å®¹é‡å°äº0åˆ™è§¦å‘æŠ¥è­¦</span></span><br><span class="line">predict_linear(node_filesystem_free_bytes &#123;mountpoint =&quot;/&quot;&#125;[1h], 4*3600) &lt; 0</span><br></pre></td></tr></table></figure>

<p>åœ¨Grafanaæ·»åŠ ç›‘æ§ç¡¬ç›˜ä½¿ç”¨ç‡å’Œé¢„æµ‹ç¡¬ç›˜ä½¿ç”¨ç‡çš„ä»ªè¡¨ç›˜</p>
<p><img src="/2024/02/18/prometheus/%E8%AE%A1%E7%AE%97%E7%A1%AC%E7%9B%98%E4%BD%BF%E7%94%A8%E7%8E%87%E4%BA%8C.png" alt="è®¡ç®—ç¡¬ç›˜ä½¿ç”¨ç‡äºŒ"></p>
<h3 id="6-2-ç›‘æ§ç¡¬ç›˜IO"><a href="#6-2-ç›‘æ§ç¡¬ç›˜IO" class="headerlink" title="6.2 ç›‘æ§ç¡¬ç›˜IO"></a>6.2 ç›‘æ§ç¡¬ç›˜IO</h3><p>å…¬å¼ä¸ºï¼šï¼ˆè¯»å–æ—¶é—´ &#x2F; å†™å…¥æ—¶é—´ï¼‰&#x2F; 1024 &#x2F; 1024ï¼Œç”¨rateå‡½æ•°å–ä¸€åˆ†é’Ÿå†…è¯»å’Œå†™çš„å­—èŠ‚å¢é•¿ç‡æ¥è®¡ç®—ï¼Œç”¨Prometheusè¡¨ç¤ºä¸º</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((rate(node_disk_read_bytes_total[1m]) + rate(node_disk_written_bytes_total[1m])) / 1024 / 1024) &gt; 0</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/18/prometheus/%E7%9B%91%E6%8E%A7IO%E7%8A%B6%E6%80%81.png" alt="ç›‘æ§IOçŠ¶æ€"></p>
<h3 id="6-3-ç›‘æ§TCP-WAITçŠ¶æ€çš„æ•°é‡"><a href="#6-3-ç›‘æ§TCP-WAITçŠ¶æ€çš„æ•°é‡" class="headerlink" title="6.3 ç›‘æ§TCP_WAITçŠ¶æ€çš„æ•°é‡"></a>6.3 ç›‘æ§TCP_WAITçŠ¶æ€çš„æ•°é‡</h3><p>åœ¨è¢«ç›‘æ§ä¸»æœºä¸Šç¼–å†™ç›‘æ§è„šæœ¬</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–ç›‘æ§ä¸»æœºå</span></span><br><span class="line">instance_name=`hostname -f | cut -d&#x27;.&#x27; -f1`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœä¸»æœºåä¸ºlocalhostï¼Œåˆ™é€€å‡º</span></span><br><span class="line">if [ $instance_name == &quot;localhost&quot; ]</span><br><span class="line">then</span><br><span class="line">        echo &quot;ä¸èƒ½ç›‘æ§ä¸»æœºåä¸ºlocalhostçš„ä¸»æœº&quot;</span><br><span class="line">        exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">---</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–TCP WAITæ•°é‡</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŠ“å–TCP WAITæ•°é‡ï¼Œå®šä¹‰ä¸ºä¸€ä¸ªæ–°key</span></span><br><span class="line">lable_tcp_wait=&quot;count_netstat_wait_connections&quot;</span><br><span class="line">count_netstat_wait_connections=`netstat -an | grep &#x27;WAIT&#x27; | wc -l`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸Šä¼ è‡³pushgateway</span></span><br><span class="line">echo &quot;$lable_tcp_wait $count_netstat_wait_connections&quot; | curl --data-binary @- http://localhost:9091/metrics/job/pushgateway/instance/$instance_name</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">---</span></span><br></pre></td></tr></table></figure>

<h3 id="6-4-ç›‘æ§æ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨ç‡"><a href="#6-4-ç›‘æ§æ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨ç‡" class="headerlink" title="6.4 ç›‘æ§æ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨ç‡"></a>6.4 ç›‘æ§æ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨ç‡</h3><p>åœ¨linuxä¸­ï¼Œæ¯å½“è¿›ç¨‹æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿå°±ä¼šä¸ºå…¶åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æ•´å‹æ–‡ä»¶æè¿°ç¬¦ï¼Œç”¨æ¥æ ‡è¯†è¿™ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªè¿›ç¨‹é»˜è®¤æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«ä¸ºæ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯ï¼Œå³stdinã€stoutã€steerï¼Œç”¨æ–‡ä»¶æè¿°ç¬¦æ¥è¡¨ç¤ºä¸º0ã€1ã€2ã€‚</p>
<p>ç”¨å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç›®å‰ç³»ç»Ÿçš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼Œä¸€èˆ¬é»˜è®¤è®¾ç½®æ˜¯1024ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ulimit -n</span><br></pre></td></tr></table></figure>

<p>æ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨ç‡å…¬å¼ä¸ºï¼šï¼ˆå·²åˆ†é…çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ &#x2F; æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°é‡ï¼‰* 100ï¼Œåœ¨Prometheusä¸­åˆ™è¡¨ç¤ºä¸º</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(node_filefd_allocated / node_filefd_maximum) * 100</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/18/prometheus/%E7%9B%91%E6%8E%A7%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%BD%BF%E7%94%A8%E7%8E%87.png" alt="ç›‘æ§æ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨ç‡"></p>
<h3 id="6-5-ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…ç‡ç›‘æ§"><a href="#6-5-ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…ç‡ç›‘æ§" class="headerlink" title="6.5 ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…ç‡ç›‘æ§"></a>6.5 ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…ç‡ç›‘æ§</h3><p>å‰é¢æˆ‘ä»¬é‡‡ç”¨çš„éƒ½æ˜¯ç®€å•çš„ping + ipåœ°å€æ¥è¿›è¡Œæµ‹è¯•ï¼Œå®é™…ä¸Šè¿™æ ·æµ‹è¯•å‘å‡ºå»çš„icmpæ•°æ®åŒ…æ˜¯éå¸¸å°çš„ï¼Œåªé€‚åˆç”¨æ¥æµ‹è¯•ç½‘ç»œæ˜¯å¦è¿é€šï¼Œå› æ­¤ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è¿›è¡Œä¼˜åŒ–ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ping -q ipåœ°å€ -s 500 -W 1000 -c 100</span><br><span class="line">-q:ä¸æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼Œå¼€å¤´å’Œç»“å°¾çš„ç›¸å…³ä¿¡æ¯é™¤å¤–ã€‚</span><br><span class="line">-s:è®¾ç½®æ•°æ®åŒ…çš„å¤§å°ã€‚</span><br><span class="line">-W:åœ¨ç­‰å¾… timeout ç§’åå¼€å§‹æ‰§è¡Œã€‚</span><br><span class="line">-c:è®¾ç½®å®Œæˆè¦æ±‚å›åº”çš„æ¬¡æ•°ã€‚</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/18/prometheus/%E7%BD%91%E7%BB%9C%E5%BB%B6%E8%BF%9F%E5%92%8C%E4%B8%A2%E5%8C%85%E7%8E%87%E7%9B%91%E6%8E%A7.png" alt="ç½‘ç»œå»¶è¿Ÿå’Œä¸¢åŒ…ç‡ç›‘æ§"></p>
<h3 id="6-6-ä½¿ç”¨Pagedutyå®ç°æŠ¥è­¦"><a href="#6-6-ä½¿ç”¨Pagedutyå®ç°æŠ¥è­¦" class="headerlink" title="6.6 ä½¿ç”¨Pagedutyå®ç°æŠ¥è­¦"></a>6.6 ä½¿ç”¨Pagedutyå®ç°æŠ¥è­¦</h3><p>Pagerdutyæ˜¯ä¸€å¥—ä»˜è´¹ç›‘æ§æŠ¥è­¦ç³»ç»Ÿï¼Œç»å¸¸ä½œä¸ºSRE&#x2F;è¿ç»´äººå‘˜çš„ç›‘æ§æŠ¥è­¦å·¥å…·ï¼Œå¯ä»¥å’Œå¸‚é¢ä¸Šå¸¸è§çš„ç›‘æ§å·¥å…·ç›´æ¥æ•´åˆã€‚</p>
<ol>
<li>åˆ›å»ºæ–°service</li>
</ol>
<p><img src="/2024/02/18/prometheus/pateduty%E5%AE%9E%E7%8E%B0%E6%8A%A5%E8%AD%A6%E4%B8%80.png" alt="patedutyå®ç°æŠ¥è­¦ä¸€"><img src="/2024/02/18/prometheus/pateduty%E5%AE%9E%E7%8E%B0%E6%8A%A5%E8%AD%A6%E4%BA%8C.png" alt="patedutyå®ç°æŠ¥è­¦äºŒ"></p>
<ol start="2">
<li>åœ¨Grafanaæ–°å»ºæŠ¥è­¦æ¸ é“ï¼Œå¹¶åœ¨ä»ªè¡¨ç›˜ä¸­è®¾ç½®ä¸ºPagedutyæŠ¥è­¦</li>
</ol>
<p><img src="/2024/02/18/prometheus/pateduty%E5%AE%9E%E7%8E%B0%E6%8A%A5%E8%AD%A6%E4%B8%89.png" alt="patedutyå®ç°æŠ¥è­¦ä¸‰"></p>
<ol start="3">
<li>è®¾ç½®æŠ¥è­¦ä¿¡æ¯</li>
</ol>
<p><img src="/2024/02/18/prometheus/pateduty%E5%AE%9E%E7%8E%B0%E6%8A%A5%E8%AD%A6%E5%9B%9B.png" alt="patedutyå®ç°æŠ¥è­¦å››"></p>
<ol start="4">
<li>æŸ¥çœ‹æ˜¯å¦æ”¶åˆ°æŠ¥è­¦</li>
</ol>
<p><img src="/2024/02/18/prometheus/pateduty%E5%AE%9E%E7%8E%B0%E6%8A%A5%E8%AD%A6%E4%BA%94.png" alt="patedutyå®ç°æŠ¥è­¦äº”"></p>
<ol start="5">
<li>å½“é—®é¢˜è§£å†³å¯ä»¥ç‚¹å‡»å·²è§£å†³</li>
</ol>
<p><img src="/2024/02/18/prometheus/pateduty%E5%AE%9E%E7%8E%B0%E6%8A%A5%E8%AD%A6%E5%85%AD.png" alt="patedutyå®ç°æŠ¥è­¦å…­"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-02-18T08:06:41.000Z" title="2/18/2024, 4:06:41 PM">2024-02-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-18T11:01:00.205Z" title="2/18/2024, 7:01:00 PM">2024-02-18</time></span><span class="level-item">28 minutes read (About 4127 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/02/18/redis/">Redis</a></p><div class="content"><h2 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h2><p>REmote DIctionary Serverï¼ˆRedisï¼‰æ˜¯ä¸€ä¸ªç”± Salvatore Sanfilippo å†™çš„ key-value å­˜å‚¨ç³»ç»Ÿï¼Œæ˜¯è·¨å¹³å°çš„éå…³ç³»å‹æ•°æ®åº“ã€‚</p>
<p><img src="/2024/02/18/redis/redis_logo.jpeg" alt="redis_logo"></p>
<p>Redis å°±æ˜¯ä¸€æ¬¾ NoSQLï¼Œè€Œ NoSQL å°±æ˜¯æŒ‡éå…³ç³»å‹æ•°æ®åº“ï¼Œä¸»è¦åˆ†ä¸ºå››ç§ï¼š</p>
<ol>
<li>é”®å€¼å‹ï¼šRedis</li>
<li>æ–‡æ¡£å‹ï¼šElasticSearchã€Mongdb</li>
<li>é¢å‘åˆ—ï¼šHbase</li>
<li>å›¾å½¢åŒ–ï¼šNeo4j</li>
</ol>
<h2 id="äºŒã€RedisåŸºç¡€"><a href="#äºŒã€RedisåŸºç¡€" class="headerlink" title="äºŒã€RedisåŸºç¡€"></a>äºŒã€RedisåŸºç¡€</h2><h3 id="2-1-Rediså®‰è£…"><a href="#2-1-Rediså®‰è£…" class="headerlink" title="2.1 Rediså®‰è£…"></a>2.1 Rediså®‰è£…</h3><ol>
<li>é€šè¿‡ docker-compose å®‰è£… redis</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">6379</span><span class="string">:6379</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è¿›å…¥å®¹å™¨å†…éƒ¨æµ‹è¯• redis</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿æ¥redis</span></span><br><span class="line">redis-cli</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">set</span>æ–°å»ºé”®å€¼å¯¹</span></span><br><span class="line">set key value</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">getè·å–é”®å€¼</span></span><br><span class="line">get key</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Rediså¸¸ç”¨å‘½ä»¤"><a href="#2-2-Rediså¸¸ç”¨å‘½ä»¤" class="headerlink" title="2.2 Rediså¸¸ç”¨å‘½ä»¤"></a>2.2 Rediså¸¸ç”¨å‘½ä»¤</h3><p>redis çš„æ•°æ®å­˜å‚¨ç»“æ„æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>key-stringï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šä¸€ä¸ª key å¯¹åº”ä¸€ä¸ªå€¼</li>
<li>key-hashï¼ˆå“ˆå¸Œï¼‰ï¼šä¸€ä¸ª key å¯¹åº”ä¸€ä¸ª map</li>
<li>key-listï¼ˆåˆ—è¡¨ï¼‰ï¼šä¸€ä¸ª key å¯¹åº”ä¸€ä¸ªåˆ—è¡¨</li>
<li>key-setï¼ˆé›†åˆï¼‰ï¼šä¸€ä¸ª key å¯¹åº”ä¸€ä¸ªé›†åˆ</li>
<li>key-zsetï¼ˆæœ‰åºé›†åˆï¼‰ï¼šä¸€ä¸ª key å¯¹åº”ä¸€ä¸ªæœ‰åºçš„é›†åˆ</li>
</ul>
<p><img src="/2024/02/18/redis/redis%E4%B8%80.png" alt="redisä¸€"></p>
<h4 id="2-2-1-stringå¸¸ç”¨å‘½ä»¤"><a href="#2-2-1-stringå¸¸ç”¨å‘½ä»¤" class="headerlink" title="2.2.1 stringå¸¸ç”¨å‘½ä»¤"></a>2.2.1 stringå¸¸ç”¨å‘½ä»¤</h4><ol>
<li>è®¾ç½®å€¼</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set key value</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å–å€¼</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get key</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æ‰¹é‡æ“ä½œ</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mset key1 value1 key2 value2 ...</span><br><span class="line">mget key1 key2 ... </span><br></pre></td></tr></table></figure>

<ol start="4">
<li>è‡ªå¢</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incr key</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>è‡ªå‡</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">decr key</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>è‡ªå¢è‡ªå‡æŒ‡å®šæ•°é‡</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">incrby key number</span><br><span class="line">decrby key number</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>è®¾ç½®å€¼çš„åŒæ—¶æŒ‡å®šç”Ÿå­˜æ—¶é—´</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setex key seconds value</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>è®¾ç½®å€¼ï¼Œå¦‚æœå½“å‰ key ä¸å­˜åœ¨å¦‚åŒ setï¼Œå¦‚æœå­˜åœ¨åˆ™è¯´æ˜éƒ½ä¸åš</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setex key value</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>åœ¨ key å¯¹åº”çš„ value åè¿½åŠ å†…å®¹</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">append key value</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>æŸ¥çœ‹ value å­—ç¬¦ä¸²é•¿åº¦</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strlen key</span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-hashå¸¸ç”¨å‘½ä»¤"><a href="#2-2-2-hashå¸¸ç”¨å‘½ä»¤" class="headerlink" title="2.2.2 hashå¸¸ç”¨å‘½ä»¤"></a>2.2.2 hashå¸¸ç”¨å‘½ä»¤</h4><ol>
<li>å­˜å‚¨æ•°æ®</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hset key field value</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è·å–æ•°æ®</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hget key field</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æ‰¹é‡æ“ä½œ</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hmset key1 field1 value1 field2 value2 ...</span><br><span class="line">hmget key1 firle1 field2 ...</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æŒ‡å®šè‡ªå¢</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hincrby key field number</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>è®¾ç½®å€¼ï¼Œå¦‚æœå½“å‰ key ä¸å­˜åœ¨å¦‚åŒ setï¼Œå¦‚æœå­˜åœ¨åˆ™è¯´æ˜éƒ½ä¸åš</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hsetnx key field value</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>æ£€æŸ¥ field æ˜¯å¦å­˜åœ¨</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexists key field</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>åˆ é™¤æŸä¸ª field</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdel key field1 field2 ...</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>è·å–å½“å‰ hash ç»“æ„ä¸­çš„å…¨éƒ¨ field å’Œ value</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgetall key</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>è·å–å½“å‰ hash ç»“æ„ä¸­çš„å…¨éƒ¨ field</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hkeys key</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>è·å–å½“å‰ hash ç»“æ„ä¸­çš„å…¨éƒ¨ value</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hvals key</span><br></pre></td></tr></table></figure>

<ol start="11">
<li>è·å–å½“å‰ hash ä¸­ field çš„æ•°é‡</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hlen key</span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-listå¸¸ç”¨å‘½ä»¤"><a href="#2-2-3-listå¸¸ç”¨å‘½ä»¤" class="headerlink" title="2.2.3 listå¸¸ç”¨å‘½ä»¤"></a>2.2.3 listå¸¸ç”¨å‘½ä»¤</h4><ol>
<li>å­˜å‚¨æ•°æ®</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä»å·¦ä¾§æ’å…¥æ•°æ®</span></span><br><span class="line">lpush key value1 value2 ...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä»å³ä¾§æ’å…¥æ•°æ®</span></span><br><span class="line">rpush key value1 value2 ...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœkeyä¸å­˜åœ¨ï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œå¦‚æœkeyå­˜åœ¨ä½†ä¸æ˜¯listç»“æ„ï¼Œä¹Ÿä»€ä¹ˆéƒ½ä¸åš</span></span><br><span class="line">lpushx key value1 value2 ...</span><br><span class="line">rpushx key value1 value2 ...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€šè¿‡ç´¢å¼•ä½ç½®æ·»åŠ value</span></span><br><span class="line">lset key index value</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è·å–æ•°æ®</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å·¦ä¾§å¼¹å‡ºæ•°æ®å¹¶ç§»é™¤</span></span><br><span class="line">lpop key</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å³ä¾§å¼¹å‡ºæ•°æ®å¹¶ç§»é™¤</span></span><br><span class="line">rpop key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–ä¸€å®šèŒƒå›´çš„æ•°æ®ï¼Œstartä»0å¼€å§‹ï¼Œstopä¸º-1æ—¶ä¸ºæœ€åä¸€ä¸ªvalueï¼Œ-2æ—¶ä¸ºå€’æ•°ç¬¬äºŒä¸ªvalue</span></span><br><span class="line">lrange key start stop</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¹æ®ç´¢å¼•ä½ç½®è·å–value</span></span><br><span class="line">lindex key index</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–æ•´ä¸ªlistçš„é•¿åº¦</span></span><br><span class="line">llen key</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åˆ é™¤æ•°æ®</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤listä¸­countä¸ªvalueçš„å€¼ï¼Œå½“count&gt;0ï¼Œä»å·¦å‘å³åˆ é™¤ï¼Œä½†count&lt;0ï¼Œä»å³å‘å·¦åˆ é™¤ï¼Œä½†count==0ï¼Œå…¨éƒ¨åˆ é™¤</span></span><br><span class="line">lrem key count value</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿ç•™åˆ—è¡¨ä¸­æŒ‡å®šèŒƒå›´å†…çš„æ•°æ®ï¼Œè¶…å‡ºè¿™ä¸ªèŒƒå›´çš„éƒ½ä¼šè¢«ç§»é™¤</span></span><br><span class="line">ltrim start stop</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†list1ä¸­çš„æœ€åä¸€ä¸ªæ•°æ®å¼¹å‡ºï¼Œæ’å…¥åˆ°list2ä¸­çš„ç¬¬ä¸€ä¸ªä½ç½®</span></span><br><span class="line">rpoplpush key1 key2</span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-setå¸¸ç”¨å‘½ä»¤"><a href="#2-2-4-setå¸¸ç”¨å‘½ä»¤" class="headerlink" title="2.2.4 setå¸¸ç”¨å‘½ä»¤"></a>2.2.4 setå¸¸ç”¨å‘½ä»¤</h4><ol>
<li>å­˜å‚¨æ•°æ®</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">valueä¸å…è®¸é‡å¤ï¼Œä¸”æ•°æ®æ— åºæ’åˆ—</span></span><br><span class="line">sadd key value1 value2 ...</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è·å–æ•°æ®</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å…¨éƒ¨æ•°æ®</span></span><br><span class="line">smembers key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">éšæœºè·å–æ•°æ®ï¼Œå¹¶ç§»é™¤ï¼Œå¯åŠ å¼¹å‡ºæ•°é‡</span></span><br><span class="line">spop key number</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å–å¤šä¸ª<span class="built_in">set</span>çš„äº¤é›†</span></span><br><span class="line">sinter key1 key2 ...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å–å¤šä¸ª<span class="built_in">set</span>çš„å¹¶é›†</span></span><br><span class="line">sunion key1 key2 ...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å–å¤šä¸ª<span class="built_in">set</span>çš„å·®é›†</span></span><br><span class="line">sdiff key1 key2 ...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å½“å‰<span class="built_in">set</span>æ˜¯å¦åŒ…å«æŸä¸ªå€¼</span></span><br><span class="line">sismember key value</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åˆ é™¤æ•°æ®</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srem key value1 value2 ...</span><br></pre></td></tr></table></figure>

<h4 id="2-2-5-zsetå¸¸ç”¨å‘½ä»¤"><a href="#2-2-5-zsetå¸¸ç”¨å‘½ä»¤" class="headerlink" title="2.2.5 zsetå¸¸ç”¨å‘½ä»¤"></a>2.2.5 zsetå¸¸ç”¨å‘½ä»¤</h4><ol>
<li>å­˜å‚¨æ•°æ®</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">scoreå¿…é¡»æ˜¯æ•°å€¼ï¼Œvalueä¸å…è®¸é‡å¤</span></span><br><span class="line">zadd key score1 value1 score2 value2 ...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹scoreï¼Œå¦‚æœvalueå­˜åœ¨åˆ™å¢åŠ åˆ†æ•°ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ç›¸å½“äºzadd</span></span><br><span class="line">zincrby key number value</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è·å–æ•°æ®</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æŒ‡å®švalueçš„åˆ†æ•°</span></span><br><span class="line">zscore key value</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–valueæ•°é‡</span></span><br><span class="line">zcard key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¹æ®scoreèŒƒå›´æŸ¥è¯¢valueæ•°é‡</span></span><br><span class="line">zcount key min max</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¹æ®åˆ†æ•°ä»å°åˆ°å¤§æ’åºï¼Œè·å–æŒ‡å®šèŒƒå›´å†…çš„æ•°æ®ï¼Œæ·»åŠ äº†withscoreså‚æ•°ä¼šè¿”å›valueçš„å…·ä½“score</span></span><br><span class="line">zrange key start stop withscores</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä»å¤§åˆ°å°</span></span><br><span class="line">zrevrange key start stop withscores</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¹æ®åˆ†æ•°çš„èŒƒå›´è·å–æ•°æ®ï¼Œå¦‚æœä¸å¸Œæœ›åŒ…æ‹¬minå’Œmaxçš„å€¼å¯ä»¥ç”¨(min max)çš„æ–¹å¼ï¼Œæœ€å¤§æœ€å°å€¼ç”¨Â±infè¡¨ç¤º</span></span><br><span class="line">zrangebyscore key min max withscores [limit,offset,count]</span><br><span class="line">zrevrangebyscore key max min withscores [limit,offset,count]</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åˆ é™¤æ•°æ®</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zrem key value1 value2 ...</span><br></pre></td></tr></table></figure>

<h4 id="2-2-6-keyå¸¸ç”¨å‘½ä»¤"><a href="#2-2-6-keyå¸¸ç”¨å‘½ä»¤" class="headerlink" title="2.2.6 keyå¸¸ç”¨å‘½ä»¤"></a>2.2.6 keyå¸¸ç”¨å‘½ä»¤</h4><ol>
<li>æŸ¥çœ‹æ‰€æœ‰key</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keys *</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æŸ¥çœ‹æŸä¸ªkeyæ˜¯å¦å­˜åœ¨</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exists key</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åˆ é™¤key</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">del key</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>è®¾ç½®keyçš„ç”Ÿå­˜æ—¶é—´</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å•ä½ä¸ºs</span></span><br><span class="line">expire key seconds</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å•ä½ä¸ºms</span></span><br><span class="line">pexpire key milliseconds</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŒ‡å®šç”Ÿå­˜åˆ°æŸä¸ªæ—¶é—´ç‚¹</span></span><br><span class="line">expireat key timestamp</span><br><span class="line">pexpireat key millseconds</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹keyçš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ï¼Œè¿”å›-2åˆ™keyä¸å­˜åœ¨ï¼Œ-1åˆ™æ²¡è®¾ç½®ç”Ÿå­˜æ—¶é—´</span></span><br><span class="line">ttl key</span><br><span class="line">pttl key</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç§»é™¤ç”Ÿå­˜æ—¶é—´</span></span><br><span class="line">persist key</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>é€‰æ‹©æ“ä½œçš„åº“</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">redisé»˜è®¤æœ‰16ä¸ªåº“</span></span><br><span class="line">select 0~15</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç§»åŠ¨keyåˆ°å¦ä¸€ä¸ªåº“ä¸­</span></span><br><span class="line">move key db</span><br></pre></td></tr></table></figure>

<h4 id="2-2-7-åº“çš„å¸¸ç”¨å‘½ä»¤"><a href="#2-2-7-åº“çš„å¸¸ç”¨å‘½ä»¤" class="headerlink" title="2.2.7 åº“çš„å¸¸ç”¨å‘½ä»¤"></a>2.2.7 åº“çš„å¸¸ç”¨å‘½ä»¤</h4><ol>
<li>æ¸…ç©ºå½“å‰æ‰€åœ¨æ•°æ®åº“</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flushdb</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flushdball</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æŸ¥çœ‹å½“å‰åº“æœ‰å¤šå°‘key</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbsize</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æŸ¥çœ‹æœ€åä¸€æ¬¡æ“ä½œçš„æ—¶é—´</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lastsave</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>å®æ—¶ç›‘æ§redisæ¥æ”¶åˆ°çš„å‘½ä»¤</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">monitor</span><br></pre></td></tr></table></figure>



<h2 id="ä¸‰ã€Redisé…ç½®"><a href="#ä¸‰ã€Redisé…ç½®" class="headerlink" title="ä¸‰ã€Redisé…ç½®"></a>ä¸‰ã€Redisé…ç½®</h2><h3 id="3-1-Redisçš„AUTH"><a href="#3-1-Redisçš„AUTH" class="headerlink" title="3.1 Redisçš„AUTH"></a>3.1 Redisçš„AUTH</h3><ol>
<li>docker-compose.yaml</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">6379</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è®¾ç½® Redis è¿æ¥å¯†ç </li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim redis.conf</span><br><span class="line">requirepass toortoor</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è¿›å…¥ Redis ä¹‹åéƒ½éœ€è¦è¾“å…¥å¯†ç æ‰å¯ä»¥åˆ›å»º key</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br><span class="line">auth toortoor</span><br></pre></td></tr></table></figure>

<h3 id="3-2-Redisçš„äº‹åŠ¡"><a href="#3-2-Redisçš„äº‹åŠ¡" class="headerlink" title="3.2 Redisçš„äº‹åŠ¡"></a>3.2 Redisçš„äº‹åŠ¡</h3><p>Redis äº‹åŠ¡å¯ä»¥ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œ å¹¶ä¸”å¸¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªé‡è¦çš„ä¿è¯ï¼š</p>
<ul>
<li>æ‰¹é‡æ“ä½œåœ¨å‘é€ EXEC å‘½ä»¤å‰è¢«æ”¾å…¥é˜Ÿåˆ—ç¼“å­˜</li>
<li>æ”¶åˆ° EXEC å‘½ä»¤åè¿›å…¥äº‹åŠ¡æ‰§è¡Œï¼Œäº‹åŠ¡ä¸­ä»»æ„å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶ä½™çš„å‘½ä»¤ä¾ç„¶è¢«æ‰§è¡Œ</li>
<li>åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤è¯·æ±‚ä¸ä¼šæ’å…¥åˆ°äº‹åŠ¡æ‰§è¡Œå‘½ä»¤åºåˆ—ä¸­</li>
</ul>
<p>ä¸€ä¸ªäº‹åŠ¡ä»å¼€å§‹åˆ°æ‰§è¡Œä¼šç»å†ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>å¼€å§‹äº‹åŠ¡ï¼šmulti</li>
<li>å‘½ä»¤å…¥é˜Ÿï¼šâ€¦â€¦</li>
<li>æ‰§è¡Œäº‹åŠ¡ï¼šexec</li>
<li>å–æ¶ˆäº‹åŠ¡ï¼šdiscard</li>
<li>ç›‘å¬ï¼šåœ¨å¼€å¯äº‹åŠ¡ä¹‹å‰ï¼Œå…ˆé€šè¿‡ watch ç›‘å¬äº‹åŠ¡ä¸­è¦æ“ä½œçš„ keyï¼Œå¦‚æœåœ¨äº‹åŠ¡è¿‡ç¨‹ä¸­æœ‰å…¶ä»–çš„å®¢æˆ·ç«¯ä¿®æ”¹äº† keyï¼Œé‚£ä¹ˆäº‹åŠ¡å°†ä¼šè¢«å–æ¶ˆ</li>
</ul>
<p>äº‹åŠ¡å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ‰“åŒ…çš„æ‰¹é‡æ‰§è¡Œè„šæœ¬ï¼Œä½†æ‰¹é‡æŒ‡ä»¤å¹¶éåŸå­åŒ–çš„æ“ä½œï¼Œä¸­é—´æŸæ¡æŒ‡ä»¤çš„å¤±è´¥ä¸ä¼šå¯¼è‡´å‰é¢å·²åšæŒ‡ä»¤çš„å›æ»šï¼Œä¹Ÿä¸ä¼šé€ æˆåç»­çš„æŒ‡ä»¤ä¸åšã€‚</p>
<ol>
<li>ç›‘å¬</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch name age gander</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å¼€å§‹äº‹åŠ¡</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">multi</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å‘½ä»¤å…¥é˜Ÿ</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set name cqm</span><br><span class="line">set age 22</span><br><span class="line">set gander male</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æ‰§è¡Œäº‹åŠ¡&#x2F;å–æ¶ˆäº‹åŠ¡</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec/discard</span><br></pre></td></tr></table></figure>

<h3 id="3-3-Redisçš„æŒä¹…åŒ–"><a href="#3-3-Redisçš„æŒä¹…åŒ–" class="headerlink" title="3.3 Redisçš„æŒä¹…åŒ–"></a>3.3 Redisçš„æŒä¹…åŒ–</h3><h4 id="3-3-1-RDBæŒä¹…åŒ–"><a href="#3-3-1-RDBæŒä¹…åŒ–" class="headerlink" title="3.3.1 RDBæŒä¹…åŒ–"></a>3.3.1 RDBæŒä¹…åŒ–</h4><p>Redis çš„é…ç½®æ–‡ä»¶ä½äº Redis å®‰è£…ç›®å½•,	ROB æ˜¯é»˜è®¤çš„æŒä¹…åŒ–æœºåˆ¶ã€‚</p>
<ol>
<li>docker-compose.yaml</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">6379</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/data</span></span><br><span class="line">    <span class="comment"># åŠ è½½redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>redis.conf</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vim</span> <span class="string">redis.conf</span></span><br><span class="line"><span class="comment"># åœ¨900ç§’å†…æœ‰1ä¸€ä¸ª key å‘ç”Ÿäº†å˜åŒ–ï¼Œå°±æ‰§è¡Œ RDB æŒä¹…åŒ–</span></span><br><span class="line"><span class="string">save</span> <span class="number">900</span> <span class="number">1</span></span><br><span class="line"><span class="string">save</span> <span class="number">300</span> <span class="number">10</span></span><br><span class="line"><span class="string">save</span> <span class="number">60</span> <span class="number">10000</span></span><br><span class="line"><span class="comment"># å¼€å¯RDBæŒä¹…åŒ–</span></span><br><span class="line"><span class="string">rdbchecksum</span> <span class="literal">yes</span></span><br><span class="line"><span class="comment"># RDBæŒä¹…åŒ–åç§°</span></span><br><span class="line"><span class="string">dbfilename</span> <span class="string">dump.rdb</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æµ‹è¯•æŒä¹…åŒ–</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set name cqm</span><br><span class="line">set age 22</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…³é—­rediså¹¶ä¿å­˜</span></span><br><span class="line">shutdown save</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>å¯ä»¥çœ‹åˆ° data ç›®å½•ä¸‹å¤šäº†ä¸ª rdb æ–‡ä»¶ï¼Œå³ä½¿ redis å®¹å™¨é‡å¯ä¹Ÿä¸ä¼šé€ æˆ key çš„ä¸¢å¤±</li>
</ol>
<p><img src="/2024/02/18/redis/redis%E4%BA%8C.png" alt="redisäºŒ"></p>
<h4 id="3-3-2-AOFæŒä¹…åŒ–"><a href="#3-3-2-AOFæŒä¹…åŒ–" class="headerlink" title="3.3.2 AOFæŒä¹…åŒ–"></a>3.3.2 AOFæŒä¹…åŒ–</h4><p>AOF æ¯”èµ· RDB æœ‰æ›´é«˜çš„æ•°æ®å®‰å…¨æ€§ï¼Œå¦‚æœåŒæ—¶å¼€å¯äº† AOF å’Œ RDBï¼Œé‚£ä¹ˆå‰è€…æ¯”åè€…çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œä¸”å¦‚æœå…ˆå¼€å¯äº† RDB åœ¨å¼€å¯ AOFï¼Œé‚£ä¹ˆ RDB ä¸­çš„å†…å®¹ä¼šè¢« AOF çš„å†…å®¹è¦†ç›–ã€‚</p>
<ol>
<li>redis.conf</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¼€å¯AOFæŒä¹…åŒ–</span></span><br><span class="line">appendonly yes</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">AOFæ–‡ä»¶å</span></span><br><span class="line">appendfilename appendonly.aof</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">AOFæŒä¹…åŒ–æ‰§è¡Œç­–ç•¥</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">always:æ¯æ¬¡æ‰§è¡Œå†™æ“ä½œéƒ½è°ƒç”¨fsync</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">everysec:æœ€å¤šæ¯ç§’è°ƒç”¨ä¸€æ¬¡fsync</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">no:æ ¹æ®ç¯å¢ƒçš„ä¸åŒåœ¨ä¸ç¡®å®šçš„æ—¶é—´è°ƒç”¨fsync</span></span><br><span class="line">appendfsync always|everysec|no</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>é‡å¯ docker-compose æµ‹è¯•</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set gander male</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸RDBæŒä¹…åŒ–</span></span><br><span class="line">shutdown nosave</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å¯ä»¥çœ‹åˆ° data ç›®å½•ä¸‹å¤šäº†ä¸ª aof æ–‡ä»¶ï¼Œå³ AOF æŒä¹…åŒ–ç”Ÿæˆçš„æ–‡ä»¶</li>
</ol>
<p><img src="/2024/02/18/redis/redis%E4%B8%89.png" alt="redisä¸‰"></p>
<h3 id="3-4-Redisä¸»ä»æ¶æ„"><a href="#3-4-Redisä¸»ä»æ¶æ„" class="headerlink" title="3.4 Redisä¸»ä»æ¶æ„"></a>3.4 Redisä¸»ä»æ¶æ„</h3><p>Redis çš„ä¸»ä»æ¶æ„æ˜¯æŒ‡ Master èŠ‚ç‚¹è´Ÿè´£å†™æ“ä½œï¼Œè€Œå…¶ä½™çš„ Slave èŠ‚ç‚¹è´Ÿè´£è¯»æ“ä½œã€‚</p>
<p><img src="/2024/02/18/redis/redis%E5%9B%9B.png" alt="rediså››"></p>
<ol>
<li>docker-compose.yaml</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis-master:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-master</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7001</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis1.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data1:/data</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis-slave1:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-slave1</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7002</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis2.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data2:/data</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">    <span class="comment"># è¿æ¥redis-masterå®¹å™¨ï¼Œå¹¶å°†è¯¥å®¹å™¨ipåœ°å€æ˜ å°„ä¸ºmaster</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-master:master</span></span><br><span class="line">  <span class="attr">redis-slave2:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-slave2</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7003</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis3.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data3:/data</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-master:master</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ä»èŠ‚ç‚¹ redis.conf</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">slaveof &lt;ä¸»èŠ‚ç‚¹åœ°å€&gt; &lt;ç«¯å£&gt;</span></span><br><span class="line">slaveof master 6379</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å¯åŠ¨åè¿›å…¥å®¹å™¨å†…éƒ¨é€šè¿‡ <code>info</code> å¯çœ‹åˆ°èŠ‚ç‚¹ä¿¡æ¯</li>
</ol>
<p><img src="/2024/02/18/redis/redis%E4%BA%94.png" alt="redisäº”"></p>
<h3 id="3-5-Rediså“¨å…µæ¨¡å¼"><a href="#3-5-Rediså“¨å…µæ¨¡å¼" class="headerlink" title="3.5 Rediså“¨å…µæ¨¡å¼"></a>3.5 Rediså“¨å…µæ¨¡å¼</h3><p>Redis çš„ä¸»ä»æ¶æ„æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼Œå°±æ˜¯å½“ Master èŠ‚ç‚¹å‡ºç°é—®é¢˜å®•æœºåï¼Œé‚£ä¹ˆ Redis é›†ç¾¤å°±æ²¡æœ‰å¯ä»¥è¿›è¡Œå†™æ“ä½œçš„ Redis äº†ï¼Œè€Œå“¨å…µå°±å¯ä»¥è§£å†³è¯¥é—®é¢˜ã€‚</p>
<p>åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­éƒ½ä¼šæœ‰ä¸ªå“¨å…µä¸ Redis è¿›è¡Œè¿æ¥ï¼Œä¸”å“¨å…µä¸å“¨å…µä¹‹é—´ä¹Ÿä¼šè¿›è¡Œè¿æ¥ï¼Œå¦‚æœ Master èŠ‚ç‚¹å‡ºç°æ•…éšœå®•æœºäº†ï¼Œé‚£ä¹ˆå“¨å…µä»¬å°±ä¼šé€‰å‡ºä¸€ä¸ª Slave æ¥ä½œä¸ºæ–°çš„ Master æ¥æä¾›å†™çš„æ“ä½œã€‚</p>
<p><img src="/2024/02/18/redis/redis%E5%85%AD.png" alt="rediså…­"></p>
<ol>
<li>docker-compose.yaml</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis-master:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-master</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7001</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis1.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data1:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./sentinel1.conf:/data/sentinel.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis-slave1:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-slave1</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7002</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis2.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data2:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./sentinel2.conf:/data/sentinel.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-master:master</span></span><br><span class="line">  <span class="attr">redis-slave2:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-slave2</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7003</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis3.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data3:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./sentinel3.conf:/data/sentinel.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis-master:master</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Master èŠ‚ç‚¹ sentinel.conf</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œredis</span></span><br><span class="line">daemonize yes</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŒ‡å®šMasterèŠ‚ç‚¹ï¼Œsentinel monitor &lt;åç§°&gt; &lt;ip&gt; &lt;ç«¯å£&gt; &lt;Slaveä¸ªæ•°&gt;</span></span><br><span class="line">sentinel monitor master localhost 6379 2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŒ‡å®šå“¨å…µæ¯éš”å¤šä¹…æ£€æµ‹ä¸€æ¬¡redisä¸»ä»æ¶æ„</span></span><br><span class="line">sentinel down-after-milliseconds master 10000</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Slave èŠ‚ç‚¹ sentinel.conf</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br><span class="line">sentinel monitor master master 6379 2</span><br><span class="line">sentinel down-after-milliseconds master 10000</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>è¿›å…¥å®¹å™¨å¯åŠ¨å“¨å…µï¼Œå½“ Master èŠ‚ç‚¹å‡ºç°é—®é¢˜åï¼Œå°±ä¼šåœ¨ä¸¤ä¸ª Slave ä¸­é€‰å‡ºä¸€ä¸ªä½œä¸ºæ–°çš„ Masterï¼Œè€Œæ—§çš„ Master å¯åŠ¨åå°±ä¼šå˜ä¸ºæ–°çš„ Slave</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-sentinel /data/sentinel.conf</span><br></pre></td></tr></table></figure>

<h3 id="3-6-Redisé›†ç¾¤"><a href="#3-6-Redisé›†ç¾¤" class="headerlink" title="3.6 Redisé›†ç¾¤"></a>3.6 Redisé›†ç¾¤</h3><p>Redis é›†ç¾¤åœ¨ä¿è¯ä¸»ä»å’Œå“¨å…µçš„åŸºæœ¬åŠŸèƒ½ä¹‹å¤–ï¼Œè¿˜èƒ½æé«˜ Redis å­˜å‚¨æ•°æ®çš„èƒ½åŠ›ï¼Œä¸»è¦çš„ç‰¹ç‚¹å¦‚ä¸‹</p>
<ul>
<li>Redis é›†ç¾¤æ˜¯æ— ä¸­å¿ƒçš„</li>
<li>Redis é›†ç¾¤æœ‰ping-pangçš„æœºåˆ¶</li>
<li>æŠ•ç¥¨æœºåˆ¶ï¼Œé›†ç¾¤èŠ‚ç‚¹çš„æ•°é‡å¿…é¡»æ˜¯ 2n+1</li>
<li>åˆ†é…äº† 16484 ä¸ª hash æ§½ï¼Œåœ¨å­˜å‚¨æ•°æ®æ—¶ï¼Œä¼šå¯¹ key è¿›è¡Œ crc16 çš„ç®—æ³•ï¼Œå¹¶å¯¹ 16384 è¿›è¡Œå–ä½™ï¼Œé€šè¿‡ç»“æœåˆ†é…åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰è‡ªå·±ç»´æŠ¤çš„ hash æ§½</li>
<li>æ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½è¦è·Ÿä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œä½†è¿™é‡Œçš„ä»èŠ‚ç‚¹åªç®¡å¤‡ä»½ï¼Œä¸ç®¡æŸ¥è¯¢</li>
<li>é›†ç¾¤ä¸­åŠæ•°çš„èŠ‚ç‚¹å®•æœºåï¼Œé‚£ä¹ˆé›†ç¾¤å°±ç˜«ç—ª</li>
</ul>
<p><img src="/2024/02/18/redis/redis%E4%B8%83.png" alt="redisä¸ƒ"></p>
<ol>
<li>docker-compose.yaml</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis1:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis1</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7001</span><span class="string">:7001</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">17001</span><span class="string">:17001</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf.d/redis1.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis2:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis2</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7002</span><span class="string">:7002</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">17002</span><span class="string">:17002</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf.d/redis2.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis3:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis3</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7003</span><span class="string">:7003</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">17003</span><span class="string">:17003</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf.d/redis3.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis4:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis4</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7004</span><span class="string">:7004</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">17004</span><span class="string">:17004</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf.d/redis4.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis5:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis5</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7005</span><span class="string">:7005</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">17005</span><span class="string">:17005</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf.d/redis5.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br><span class="line">  <span class="attr">redis6:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis6</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/redis:5.0.9</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7006</span><span class="string">:7006</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">17006</span><span class="string">:17006</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf.d/redis6.conf:/usr/local/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;/usr/local/redis/redis.conf&quot;</span>]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>redis{1..6}.confï¼Œx ä¸º {1..6}</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šredisç«¯å£</span></span><br><span class="line"><span class="string">port</span> <span class="string">700x</span></span><br><span class="line"><span class="comment"># å¼€å¯é›†ç¾¤</span></span><br><span class="line"><span class="string">cluster-enabled</span> <span class="literal">yes</span></span><br><span class="line"><span class="comment"># é›†ç¾¤ä¿¡æ¯æ–‡ä»¶</span></span><br><span class="line"><span class="string">cluster-config-file</span> <span class="string">nodes-700x.conf</span></span><br><span class="line"><span class="comment"># é›†ç¾¤å¯¹å¤–ip</span></span><br><span class="line"><span class="string">cluster-announce-ip</span> <span class="number">192.168</span><span class="number">.88</span><span class="number">.135</span></span><br><span class="line"><span class="comment"># é›†ç¾¤å¯¹å¤–ç«¯å£</span></span><br><span class="line"><span class="string">cluster-announce-port</span> <span class="string">700x</span></span><br><span class="line"><span class="comment"># é›†ç¾¤æ€»çº¿ç«¯å£</span></span><br><span class="line"><span class="string">cluster-announce-bus-port</span> <span class="string">1700x</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è¿›å…¥ä»»æ„ reids å®¹å™¨åˆ›å»ºé›†ç¾¤</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--cluster-replicas:æ¯ä¸ªä¸»èŠ‚ç‚¹åˆ†é…çš„ä»èŠ‚ç‚¹ä¸ªæ•°</span></span><br><span class="line">redis-cli --cluster create 192.168.88.135:7001 192.168.88.135:7002 192.168.88.135:7003 192.168.88.135:7004 192.168.88.135:7005 192.168.88.135:7006 --cluster-replicas 1</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ç”±äºæ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½è¢«åˆ†é…äº†ä¸åŒçš„ hash æ§½ï¼Œæ‰€ä»¥è¦åœ¨å®¹å™¨å†…ä»»æ„åˆ‡æ¢ä¸åŒçš„ redis èŠ‚ç‚¹éœ€è¦åŠ å‚æ•° <code>-c</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 192.168.88.135 -p 7001 -c</span><br></pre></td></tr></table></figure>



<h2 id="å››ã€Rediså¸¸è§é—®é¢˜"><a href="#å››ã€Rediså¸¸è§é—®é¢˜" class="headerlink" title="å››ã€Rediså¸¸è§é—®é¢˜"></a>å››ã€Rediså¸¸è§é—®é¢˜</h2><h3 id="4-1-Redisçš„åˆ é™¤ç­–ç•¥"><a href="#4-1-Redisçš„åˆ é™¤ç­–ç•¥" class="headerlink" title="4.1 Redisçš„åˆ é™¤ç­–ç•¥"></a>4.1 Redisçš„åˆ é™¤ç­–ç•¥</h3><p>å½“ key çš„ç”Ÿå­˜æ—¶é—´åˆ°äº†ï¼ŒRedis å¹¶ä¸ä¼šç«‹å³åˆ é™¤è¯¥ keyï¼Œè€Œæ˜¯éµå®ˆä»¥ä¸‹åˆ é™¤ç­–ç•¥æ¥è¿›è¡Œåˆ é™¤</p>
<ul>
<li>å®šæœŸåˆ é™¤ï¼šRedis æ¯éš”ä¸€æ®µæ—¶é—´å°±å›å»æŸ¥çœ‹è®¾ç½®äº†ç”Ÿå­˜æ—¶é—´çš„ keyï¼Œé»˜è®¤æ˜¯ 100ms æŸ¥çœ‹ 3 ä¸ª key</li>
<li>æƒ°æ€§åˆ é™¤ï¼šå½“ç”¨æˆ·å»æŸ¥è¯¢å·²ç»è¶…è¿‡äº†ç”Ÿå­˜æ—¶é—´çš„ keyï¼ŒRedis ä¼šå…ˆæŸ¥çœ‹è¯¥ key æ˜¯å¦å·²ç»è¶…è¿‡äº†ç”Ÿå­˜æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡ï¼Œé‚£ä¹ˆ Redis ä¼šå°†è¯¥ key åˆ é™¤å¹¶ç»™ç”¨æˆ·è¿”å›ä¸€ä¸ªç©ºå€¼</li>
</ul>
<h3 id="4-2-Redisçš„æ·˜æ±°æœºåˆ¶"><a href="#4-2-Redisçš„æ·˜æ±°æœºåˆ¶" class="headerlink" title="4.2 Redisçš„æ·˜æ±°æœºåˆ¶"></a>4.2 Redisçš„æ·˜æ±°æœºåˆ¶</h3><p>å½“ Redis å†…å­˜æ»¡çš„æ—¶å€™æ·»åŠ äº†ä¸€ä¸ªæ–°çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œ Redis çš„æ·˜æ±°æœºåˆ¶ï¼Œé€šè¿‡ <code>maxmemory-policy</code> æ¥è®¾ç½®ï¼Œå‚æ•°å¦‚ä¸‹</p>
<ol>
<li><p>volatile-lruï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šåˆ é™¤ä¸€ä¸ªè®¾ç½®äº†ç”Ÿå­˜æ—¶é—´ä¸”æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ key</p>
</li>
<li><p>allkeys-lruï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šåˆ é™¤ä¸€ä¸ªè®¾ç½®äº†æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ key</p>
</li>
<li><p>volatile-lfuï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šåˆ é™¤ä¸€ä¸ªè®¾ç½®äº†ç”Ÿå­˜æ—¶é—´ä¸”æœ€è¿‘ä½¿ç”¨é¢‘ç‡æœ€ä½çš„ key</p>
</li>
<li><p>allkeys-lfuï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šåˆ é™¤ä¸€ä¸ªè®¾ç½®äº†æœ€è¿‘ä½¿ç”¨é¢‘ç‡æœ€ä½çš„ key</p>
</li>
<li><p>volatile-randomï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šéšæœºåˆ é™¤ä¸€ä¸ªè®¾ç½®äº†ç”Ÿå­˜æ—¶é—´çš„ key</p>
</li>
<li><p>allkeys-randomï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šéšæœºåˆ é™¤ä¸€ä¸ª key</p>
</li>
<li><p>volatile-ttlï¼šå½“å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šåˆ é™¤ä¸€ä¸ªç”Ÿå­˜æ—¶é—´æœ€å°‘çš„ key</p>
</li>
<li><p>noevictionï¼šå†…å­˜ä¸è¶³æ—¶ï¼Œç›´æ¥æŠ¥é”™</p>
</li>
</ol>
<h3 id="4-3-ç¼“å­˜é—®é¢˜"><a href="#4-3-ç¼“å­˜é—®é¢˜" class="headerlink" title="4.3 ç¼“å­˜é—®é¢˜"></a>4.3 ç¼“å­˜é—®é¢˜</h3><p><strong>ç¼“å­˜ç©¿é€</strong></p>
<p>å½“å®¢æˆ·æŸ¥è¯¢çš„æ•°æ® Redis ä¸­æ²¡æœ‰ï¼Œæ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰ï¼Œä¸”è¯·æ±‚é‡ç‰¹åˆ«å¤§æ—¶ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®åº“çš„å‹åŠ›è¿‡å¤§ï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹</p>
<ul>
<li>æ ¹æ® id æŸ¥è¯¢æ—¶ï¼Œå¦‚æœ id æ˜¯è‡ªå¢çš„ï¼Œé‚£ä¹ˆå¯ä»¥å°†æœ€å¤§çš„ id æ”¾åˆ° Reids ä¸­ï¼Œå½“æŸ¥è¯¢æ•°æ®æ—¶ç›´æ¥å¯¹æ¯” id å³å¯</li>
<li>å¦‚æœ id ä¸æ˜¯ int å‹ï¼Œé‚£ä¹ˆå¯ä»¥å°†å…¨éƒ¨çš„ id æ”¾å…¥ set ä¸­ï¼Œç”¨æˆ·æŸ¥è¯¢ä¹‹å‰å¯ä»¥å…ˆåˆ° set æŸ¥çœ‹æ˜¯å¦æœ‰è¯¥ id</li>
<li>è·å–ç”¨æˆ·çš„ ip åœ°å€ï¼Œå¯¹è¯¥åœ°å€è¿›è¡Œè®¿é—®é™åˆ¶</li>
</ul>
<p><strong>ç¼“å­˜å‡»ç©¿</strong></p>
<p>å½“ç”¨æˆ·æŸ¥è¯¢çš„æ˜¯çƒ­ç‚¹æ•°æ®æ—¶ï¼Œé‚£ä¹ˆå¹¶å‘é‡è‚¯å®šæ˜¯å¾ˆé«˜çš„ï¼Œå½“ Redis ä¸­çš„çƒ­ç‚¹æ•°æ®è¿‡æœŸäº†ï¼Œé‚£ä¹ˆæ•°æ®åº“çš„å‹åŠ›å°±ä¼šå¾ˆå¤§ï¼Œç”šè‡³å®•æœºï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹</p>
<ul>
<li>åœ¨è®¿é—®çƒ­ç‚¹æ•°æ®æ—¶ï¼Œç¼“å­˜ä¸­æ²¡æœ‰çš„æ—¶å€™ï¼Œå¯ä»¥æ·»åŠ ä¸€æŠŠé”ï¼Œè®©å‡ ä¸ªè¯·æ±‚å»è®¿é—®æ•°æ®åº“ï¼Œé¿å…æ•°æ®åº“å®•æœº</li>
<li>æŠŠçƒ­ç‚¹æ•°æ®çš„ç”Ÿå­˜æ—¶é—´å»æ‰</li>
</ul>
<p><strong>ç¼“å­˜é›ªå´©</strong></p>
<p>å½“å¤§é‡ç¼“å­˜åŒæ—¶åˆ°æœŸæ—¶ï¼Œå¯¼è‡´è¯·æ±‚éƒ½å»åˆ°äº†æ•°æ®åº“ï¼Œä¹Ÿå¾ˆå®¹æ˜“å¯¼è‡´æ•°æ®åº“å®•æœºï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹</p>
<ul>
<li>å¯¹ç¼“å­˜ä¸­çš„æ•°æ®è®¾ç½®ä¸€ä¸ªéšæœºçš„ç”Ÿå­˜æ—¶é—´ï¼Œé¿å…åŒæ—¶è¿‡æœŸ</li>
</ul>
<p><strong>ç¼“å­˜å€¾æ–œ</strong></p>
<p>å¦‚æœå°†çƒ­ç‚¹æ•°æ®æ”¾åœ¨é›†ç¾¤ä¸­çš„æŸä¸€ Redis èŠ‚ç‚¹ä¸Šæ—¶ï¼Œé‚£ä¹ˆå¤§é‡çš„æ•°æ®éƒ½ä¼šå»åˆ°è¯¥ Redis èŠ‚ç‚¹ï¼Œå¯¼è‡´èŠ‚ç‚¹å®•æœºï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹</p>
<ul>
<li>ä¸»ä»æ¶æ„ï¼Œå‡†å¤‡å¤§é‡çš„ä»èŠ‚ç‚¹</li>
<li>åœ¨ Tomcat ä¸­åš JVM ç¼“å­˜ï¼Œåœ¨æŸ¥è¯¢ Redis å‰å…ˆæŸ¥è¯¢ JVM ç¼“å­˜</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-02-18T08:06:41.000Z" title="2/18/2024, 4:06:41 PM">2024-02-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-18T11:02:58.270Z" title="2/18/2024, 7:02:58 PM">2024-02-18</time></span><span class="level-item">18 minutes read (About 2754 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/02/18/zookeeper/">Zookeeper</a></p><div class="content"><p><img src="/2024/02/18/zookeeper/logo.jpg" alt="logo"></p>
<p>ZooKeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ï¼Œå¼€æ”¾æºç çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ï¼Œæ˜¯ Hadoop å’Œ Hbase çš„é‡è¦ç»„ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„è½¯ä»¶ï¼Œæä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šé…ç½®ç»´æŠ¤ã€åŸŸåæœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ç­‰ã€‚</p>
<h2 id="ä¸€ã€ZookeeperåŸºç¡€"><a href="#ä¸€ã€ZookeeperåŸºç¡€" class="headerlink" title="ä¸€ã€ZookeeperåŸºç¡€"></a>ä¸€ã€ZookeeperåŸºç¡€</h2><h3 id="1-1-ä½¿ç”¨åœºæ™¯"><a href="#1-1-ä½¿ç”¨åœºæ™¯" class="headerlink" title="1.1 ä½¿ç”¨åœºæ™¯"></a>1.1 ä½¿ç”¨åœºæ™¯</h3><ul>
<li>åˆ†å¸ƒå¼åè°ƒç»„ä»¶ï¼šé€šè¿‡ watch æœºåˆ¶å¯ä»¥åè°ƒå¥½èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§</li>
<li>åˆ†å¸ƒå¼é”ï¼šé€šè¿‡åˆ†å¸ƒå¼é”å¯ä»¥åšåˆ°å¼ºä¸€è‡´æ€§</li>
<li>æ— çŠ¶æ€åŒ–å®ç°</li>
<li>è´Ÿè½½å‡è¡¡</li>
<li>æ•°æ®å‘å¸ƒ&#x2F;è®¢é˜…</li>
<li>å‘½åæœåŠ¡</li>
</ul>
<h3 id="1-2-éƒ¨ç½²"><a href="#1-2-éƒ¨ç½²" class="headerlink" title="1.2 éƒ¨ç½²"></a>1.2 éƒ¨ç½²</h3><p><strong>docker-compose.yaml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">zookeeper:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zk01</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper:3.7.0</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">zk01</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2181</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zk01:2888:3888;2181</span></span><br></pre></td></tr></table></figure>

<p><strong>zoo.cfg</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/data</span><br><span class="line">dataLogDir=/datalog</span><br><span class="line"><span class="comment"># åŸºæœ¬æ—¶é—´é…ç½®ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line">tickTime=2000</span><br><span class="line"><span class="comment"># åˆå§‹åŒ–è¿æ¥åˆ°leaderçš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ä¸ºå€æ•°ï¼Œå³åˆå§‹åŒ–æ—¶é—´ä¸ºtickTime * initLimit</span></span><br><span class="line">initLimit=5</span><br><span class="line"><span class="comment"># followerä¸leaderæ•°æ®åŒæ­¥çš„æœ€å¤§æ—¶é•¿</span></span><br><span class="line">syncLimit=2</span><br><span class="line"><span class="comment"># ä¿å­˜æ•°æ®çš„å¿«ç…§æ•°é‡</span></span><br><span class="line">autopurge.snapRetainCount=3</span><br><span class="line"><span class="comment"># è‡ªåŠ¨è§¦å‘æ¸…é™¤ä»»åŠ¡æ—¶é—´é—´éš”ï¼Œä»¥å°æ—¶ä¸ºå•ä½ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ä¸æ¸…é™¤</span></span><br><span class="line">autopurge.purgeInterval=0</span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯ä¸zkçš„æœ€å¤§å¹¶å‘è¿æ¥æ•°</span></span><br><span class="line">maxClientCnxns=60</span><br><span class="line"><span class="comment"># å¼€å¯standaloneEnabledæ¨¡å¼ï¼Œå³ç‹¬ç«‹éƒ¨ç½²</span></span><br><span class="line">standaloneEnabled=<span class="literal">true</span></span><br><span class="line"><span class="comment"># å¼€å¯adminServer</span></span><br><span class="line">admin.enableServer=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 2181æ˜¯ä¸ºå®¢æˆ·ç«¯æä¾›çš„ç«¯å£</span></span><br><span class="line">server.1=zk01:2888:3888;2181</span><br></pre></td></tr></table></figure>

<h3 id="1-3-åŸºæœ¬å‘½ä»¤"><a href="#1-3-åŸºæœ¬å‘½ä»¤" class="headerlink" title="1.3 åŸºæœ¬å‘½ä»¤"></a>1.3 åŸºæœ¬å‘½ä»¤</h3><ol>
<li>å¯åŠ¨|å…³é—­|æŸ¥çœ‹çŠ¶æ€</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zkServer.sh start|stop|status</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è¿›å…¥ zk</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zkCli.sh</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æŸ¥çœ‹å†…éƒ¨æ•°æ®ç»“æ„</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls [path]</span><br></pre></td></tr></table></figure>



<h2 id="äºŒã€å†…éƒ¨æ•°æ®ç»“æ„"><a href="#äºŒã€å†…éƒ¨æ•°æ®ç»“æ„" class="headerlink" title="äºŒã€å†…éƒ¨æ•°æ®ç»“æ„"></a>äºŒã€å†…éƒ¨æ•°æ®ç»“æ„</h2><h3 id="2-1-æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„"><a href="#2-1-æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„" class="headerlink" title="2.1 æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„"></a>2.1 æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„</h3><p>Zookeeper ä¸­çš„æ•°æ®æ˜¯ä¿å­˜åœ¨èŠ‚ç‚¹ä¸Šçš„ï¼Œå³ znodeï¼Œå¤šä¸ª znode å°±æ„æˆä¸€ä¸ªæ ‘çš„ç»“æ„ã€‚</p>
<p><img src="/2024/02/18/zookeeper/zk%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png" alt="zkæ•°æ®å­˜å‚¨ç»“æ„"></p>
<p>å¦‚å›¾ï¼Œa å’Œ b å°±æ˜¯ Zookeeper çš„ znodeï¼Œåˆ›å»º znode æ–¹å¼å¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create /[znode_name]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºèŠ‚ç‚¹å¹¶åˆ›å»ºä¸€ä¸ªæ•°æ®</span></span><br><span class="line">create /[znode_name] [data_name]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–æ•°æ®</span></span><br><span class="line">get [znode_name]</span><br></pre></td></tr></table></figure>

<h3 id="2-2-znodeç»“æ„"><a href="#2-2-znodeç»“æ„" class="headerlink" title="2.2 znodeç»“æ„"></a>2.2 znodeç»“æ„</h3><p>Zookeeper ä¸­çš„ zonodeï¼ŒåŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>dataï¼šä¿å­˜æ•°æ®</li>
<li>aclï¼šæƒé™<ul>
<li>cï¼šåˆ›å»ºæƒé™</li>
<li>wï¼šå†™æƒé™</li>
<li>rï¼šè¯»æƒé™</li>
<li>dï¼šåˆ é™¤æƒé™</li>
<li>aï¼šadmin ç®¡ç†è€…æƒé™</li>
</ul>
</li>
<li>statï¼šæè¿°å½“å‰ znode çš„å…ƒæ•°æ®</li>
<li>childï¼šå½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹znodeè¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">get -s /[znode_name]</span><br><span class="line">cZxid:åˆ›å»ºèŠ‚ç‚¹çš„äº‹åŠ¡ID</span><br><span class="line">ctime:åˆ›å»ºèŠ‚ç‚¹æ—¶é—´</span><br><span class="line">mZxid:ä¿®æ”¹èŠ‚ç‚¹çš„äº‹åŠ¡ID</span><br><span class="line">mtime:ä¿®æ”¹èŠ‚ç‚¹æ—¶é—´</span><br><span class="line">pZxid:æ·»åŠ å’Œåˆ é™¤å­èŠ‚ç‚¹çš„äº‹åŠ¡ID</span><br><span class="line">cversion:å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ç‰ˆæœ¬å·ï¼Œåˆå§‹å€¼ä¸º-1ï¼Œæ¯å¯¹è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹è¿›è¡Œæ“ä½œï¼Œè¿™ä¸ªcversionéƒ½ä¼šè‡ªåŠ¨å¢åŠ </span><br><span class="line">dataVersion:æ•°æ®ç‰ˆæœ¬åˆè¯†ç‰ˆæœ¬ä¸º0ï¼Œæ¯å¯¹è¯¥èŠ‚ç‚¹çš„æ•°æ®è¿›è¡Œæ“ä½œï¼Œè¿™ä¸ªdataVersionéƒ½ä¼šè‡ªåŠ¨å¢åŠ </span><br><span class="line">aclVersion:æƒé™ç‰ˆæœ¬</span><br><span class="line">ephemeralOwne:å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œè¯¥å€¼æ˜¯å½“å‰èŠ‚ç‚¹çš„session idï¼Œå¦‚æœä¸æ˜¯ä¸´æ—¶èŠ‚ç‚¹åˆ™ä¸º0</span><br><span class="line">dataLength:æ•°æ®é•¿åº¦</span><br><span class="line">numChildren:è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•°</span><br></pre></td></tr></table></figure>

<h3 id="2-3-znodeç±»å‹"><a href="#2-3-znodeç±»å‹" class="headerlink" title="2.3 znodeç±»å‹"></a>2.3 znodeç±»å‹</h3><ul>
<li>æŒä¹…èŠ‚ç‚¹ï¼šåœ¨ä¼šè¯ç»“æŸåä»ä¼šå­˜åœ¨</li>
<li>æŒä¹…åºå·èŠ‚ç‚¹ï¼šæ ¹æ®å…ˆåé¡ºåºï¼Œä¼šåœ¨ç»“ç‚¹ä¹‹åå¸¦ä¸Šä¸€ä¸ªæ•°å€¼ï¼Œé€‚ç”¨äºåˆ†å¸ƒå¼é”çš„åœºæ™¯ï¼ˆå•è°ƒé€’å¢ï¼‰</li>
<li>ä¸´æ—¶èŠ‚ç‚¹ï¼šä¼šè¯ç»“æŸåä¼šè‡ªåŠ¨åˆ é™¤ï¼Œé€‚ç”¨äºæ³¨å†Œä¸æœåŠ¡å‘ç°çš„åœºæ™¯</li>
<li>ä¸´æ—¶åºå·èŠ‚ç‚¹ï¼šè·ŸæŒä¹…åºå·èŠ‚ç‚¹ç›¸åŒï¼Œé€‚ç”¨äºåˆ†å¸ƒå¼é”çš„åœºæ™¯</li>
<li>å®¹å™¨èŠ‚ç‚¹ï¼šå½“å®¹å™¨èŠ‚ç‚¹ä¸­æ²¡æœ‰ä»»ä½•å­èŠ‚ç‚¹æ—¶ï¼Œè¯¥å®¹å™¨èŠ‚ç‚¹ä¼šè¢«å®šæœŸåˆ é™¤ï¼ˆ60sï¼‰</li>
<li>TTL èŠ‚ç‚¹ï¼šå¯ä»¥æŒ‡å®šèŠ‚ç‚¹çš„åˆ°æœŸæ—¶é—´</li>
</ul>
<p><strong>æŒä¹…åºå·èŠ‚ç‚¹åˆ›å»º</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create -s /[znode_name]</span><br></pre></td></tr></table></figure>

<p><strong>ä¸´æ—¶èŠ‚ç‚¹åˆ›å»º</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create -e /[znode_name]</span><br></pre></td></tr></table></figure>

<p><strong>ä¸´æ—¶åºå·èŠ‚ç‚¹åˆ›å»º</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create -e -s /[znode_name]</span><br></pre></td></tr></table></figure>

<p><strong>å®¹å™¨èŠ‚ç‚¹åˆ›å»º</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create -c /[znode_name]</span><br></pre></td></tr></table></figure>

<p><strong>TTL èŠ‚ç‚¹åˆ›å»º</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é€šè¿‡ç³»ç»Ÿé…ç½®å¼€å¯</span></span><br><span class="line">zookeeper.extendedTypesEnabled=true</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/18/zookeeper/%E6%8C%81%E4%B9%85%E4%B8%8E%E4%B8%B4%E6%97%B6%E8%8A%82%E7%82%B9.png" alt="æŒä¹…ä¸ä¸´æ—¶èŠ‚ç‚¹"></p>
<p><strong>æŒä¹…èŠ‚ç‚¹</strong></p>
<p>æŒä¹…èŠ‚ç‚¹åœ¨åˆ›å»ºåæœåŠ¡ç«¯ä¼šå‘é€ä¸€ä¸ª <code>session id</code>ï¼Œå¹¶ä¸€ç›´ä¿ç•™ç€ã€‚</p>
<p><strong>ä¸´æ—¶èŠ‚ç‚¹</strong></p>
<p>ä¸´æ—¶èŠ‚ç‚¹åœ¨åˆ›å»ºæ—¶åæœåŠ¡å™¨ä¹Ÿä¼šå‘é€ä¸€ä¸ª <code>session id</code>ï¼Œåœ¨ä¼šè¯æŒç»­çš„è¿‡ç¨‹ä¸­å®¢æˆ·ç«¯ä¼šä¸æ–­å‘æœåŠ¡ç«¯ç»­çº¦ <code>session id</code> çš„æ—¶é—´ï¼Œå½“å®¢æˆ·ç«¯æ²¡æœ‰ç»§ç»­ç»­çº¦ï¼Œè€ŒæœåŠ¡ç«¯å†…éƒ¨çš„è®¡æ—¶å™¨åˆ°æœŸæ—¶ï¼Œå°±ä¼šå°†è¯¥ <code>session id</code> æ‰€å¯¹åº”çš„ znode å…¨éƒ¨åˆ é™¤ã€‚</p>
<h3 id="2-4-æŒä¹…åŒ–æœºåˆ¶"><a href="#2-4-æŒä¹…åŒ–æœºåˆ¶" class="headerlink" title="2.4 æŒä¹…åŒ–æœºåˆ¶"></a>2.4 æŒä¹…åŒ–æœºåˆ¶</h3><p>Zookeeper çš„æ•°æ®æ˜¯è¿è¡Œåœ¨å†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥æä¾›äº†ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ï¼š</p>
<ul>
<li>äº‹åŠ¡æ—¥å¿—ï¼šZookeeper å°†æ‰§è¡Œè¿‡çš„å‘½ä»¤ä»¥æ—¥å¿—çš„å½¢å¼å­˜å‚¨åœ¨ dataLogDir &#x2F; dataDir ä¸­ï¼Œç±»ä¼¼äº redis çš„ AOF</li>
<li>æ•°æ®å¿«ç…§ï¼šåœ¨ä¸€å®šæ—¶é—´é—´éš”å†…åšä¸€æ¬¡æ•°æ®å¿«ç…§ï¼Œå­˜å‚¨åœ¨å¿«ç…§æ–‡ä»¶ä¸­ï¼ˆsnapshotï¼‰ï¼Œç±»ä¼¼äº redis çš„RDB</li>
</ul>
<p>Zookeeper é€šè¿‡è¿™ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ï¼Œåœ¨æ¢å¤æ•°æ®æ—¶å…ˆå°†å¿«ç…§æ–‡ä»¶ä¸­çš„æ•°æ®æ¢å¤åˆ°å†…å­˜ä¸­ï¼Œå†ç”¨æ—¥å¿—æ–‡ä»¶ä¸­çš„æ•°æ®åšå¢é‡æ¢å¤ï¼Œå¯ä»¥å®ç°é«˜æ•ˆçš„æŒä¹…åŒ–ã€‚</p>
<h2 id="ä¸‰ã€zkCliçš„ä½¿ç”¨"><a href="#ä¸‰ã€zkCliçš„ä½¿ç”¨" class="headerlink" title="ä¸‰ã€zkCliçš„ä½¿ç”¨"></a>ä¸‰ã€zkCliçš„ä½¿ç”¨</h2><ol>
<li>é€’å½’æŸ¥è¯¢</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -R /[znode_name]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åˆ é™¤èŠ‚ç‚¹</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deleteall /[znode_name]</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ä¹è§‚é”åˆ é™¤</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete -v [version] /[znode_name]</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ç»™å½“å‰ä¼šè¯æ³¨å†Œç”¨æˆ·ï¼Œå¹¶åˆ›å»ºèŠ‚ç‚¹èµ‹äºˆè¯¥ç”¨æˆ·æƒé™</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">addauth digest [user]:[password]</span><br><span class="line">create /[znode_name] auth:[user]:[password]:[privileges]</span><br></pre></td></tr></table></figure>



<h2 id="å››ã€åˆ†å¸ƒå¼é”"><a href="#å››ã€åˆ†å¸ƒå¼é”" class="headerlink" title="å››ã€åˆ†å¸ƒå¼é”"></a>å››ã€åˆ†å¸ƒå¼é”</h2><p>åœ¨åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸‹ï¼Œå¦‚æœåœ¨ä¸€ä¸ªèŠ‚ç‚¹å»ä¸Šäº†ä¸ªé”ï¼Œå½“è¯·æ±‚è¢«è´Ÿè½½å‡è¡¡åˆ†é…åˆ°äº†å…¶å®ƒèŠ‚ç‚¹ï¼Œé‚£ä¹ˆé”å°±æ— æ³•å½¢æˆäº’æ–¥ï¼Œæ‰€ä»¥èŠ‚ç‚¹ä¹‹é—´ä½¿ç”¨ Zookeeperï¼Œåšä¸€ä¸ªåè°ƒä¸­å¿ƒï¼Œå°†é”ä¸Šä¼ åˆ° Zookeeperï¼Œå…¶å®ƒèŠ‚ç‚¹è¦ç”¨åˆ°å°±å» Zookeeper æ‹¿è¿™ä¸ªé”ï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”ã€‚</p>
<p>Zookeeper é”çš„åˆ†ç±»ï¼š</p>
<ul>
<li>è¯»é”ï¼šå¤§å®¶éƒ½å¯ä»¥è¯»ï¼Œå‰ææ˜¯ä¹‹å‰æ²¡æœ‰å†™é”ã€‚ï¼ˆè¯»é”æ¯”å–»æˆçº¦ä¼šï¼Œå¤§å®¶éƒ½æœ‰æœºä¼šå’Œå¥³ç¥çº¦ä¼šï¼Œçº¦ä¼šå‰ææ˜¯å¥³ç¥æ²¡ç»“å©šï¼‰</li>
<li>å†™é”ï¼šåªæœ‰å†™é”æ‰èƒ½å†™ï¼Œå‰ææ˜¯ä¸èƒ½æœ‰ä»»ä½•é”ã€‚ï¼ˆå†™é”æ¯”å–»æˆç»“å©šï¼Œç»“å©šååªæœ‰è€å…¬èƒ½å’Œå¥³ç¥çº¦ä¼šï¼Œç»“å©šå‰ææ˜¯å¥³ç¥å’Œå…¶ä»–äººçš„å…³ç³»æ–­å¹²å‡€äº†ï¼‰</li>
</ul>
<h3 id="4-1-ä¸Šè¯»é”"><a href="#4-1-ä¸Šè¯»é”" class="headerlink" title="4.1 ä¸Šè¯»é”"></a>4.1 ä¸Šè¯»é”</h3><ul>
<li>åˆ›å»ºä¸€ä¸ªä¸´æ—¶åºå·èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹æ•°æ®æ˜¯ readï¼Œè¡¨ç¤ºä¸ºè¯»é”</li>
<li>è·å–å½“å‰ Zookeeper ä¸­åºå·æ¯”è‡ªå·±å°çš„æ‰€æœ‰èŠ‚ç‚¹</li>
<li>åˆ¤æ–­æœ€å°èŠ‚ç‚¹æ˜¯å¦ä¸ºè¯»é”ï¼š<ul>
<li>å¦‚æœæ˜¯è¯»é”ï¼šåˆ™ä¸Šé”å¤±è´¥ï¼Œå› ä¸ºå¦‚æœæœ€å°èŠ‚ç‚¹æ˜¯è¯»é”ï¼Œé‚£ä¹ˆåé¢å°±ä¸å¯èƒ½æœ‰å†™é”ï¼Œæ¥ç€ä¸ºæœ€å°èŠ‚ç‚¹è®¾ç½®ç›‘å¬ï¼ŒZookeeper çš„ watch æœºåˆ¶ä¼šåœ¨æœ€å°èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥å½“å‰èŠ‚ç‚¹ï¼Œå†è¿›è¡Œåé¢çš„æ­¥éª¤ï¼Œè¢«ç§°ä¸ºé˜»å¡ç­‰å¾…</li>
<li>å¦‚æœä¸æ˜¯è¯»é”ï¼šåˆ™ä¸Šé”æˆåŠŸ</li>
</ul>
</li>
</ul>
<h3 id="4-2-ä¸Šå†™é”"><a href="#4-2-ä¸Šå†™é”" class="headerlink" title="4.2 ä¸Šå†™é”"></a>4.2 ä¸Šå†™é”</h3><ul>
<li>åˆ›å»ºä¸€ä¸ªä¸´æ—¶åºå·èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹æ•°æ®æ˜¯ writeï¼Œè¡¨ç¤ºä¸ºå†™é”</li>
<li>è·å– Zookeeper ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹</li>
<li>åˆ¤æ–­è‡ªå·±æ˜¯å¦ä¸ºæœ€å°èŠ‚ç‚¹ï¼š<ul>
<li>å¦‚æœæ˜¯ï¼šä¸Šé”æˆåŠŸ</li>
<li>å¦‚æœä¸æ˜¯ï¼šè¯´æ˜å‰é¢è¿˜æœ‰é”ï¼Œæ‰€ä»¥ä¸Šé”å¤±è´¥ï¼Œæ¥ç€ç›‘å¬æœ€å°èŠ‚ç‚¹ï¼Œå¦‚æœæœ€å°èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œåˆ™é‡æ–°è¿›è¡Œç¬¬äºŒæ­¥</li>
</ul>
</li>
</ul>
<p><strong>ç¾Šç¾¤æ•ˆåº”</strong></p>
<p>å‡è®¾æœ‰ä¸€ç™¾ä¸ªè¯·æ±‚éƒ½æ˜¯è¦å»å†™é”ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ä¸€ç™¾ä¸ªè¯·æ±‚å»ç›‘å¬æœ€å°èŠ‚ç‚¹ï¼Œé‚£ä¹ˆ Zookeeper çš„å‹åŠ›å°±ä¼šéå¸¸å¤§ï¼Œè§£å†³æ–¹æ³•æ˜¯å°†è¿™ä¸€ç™¾ä¸ªè¯·æ±‚æŒ‰è¯·æ±‚é¡ºåºæ’åˆ—ï¼Œåä¸€ä¸ªè¯·æ±‚å»ç›‘å¬å‰ä¸€ä¸ªè¯·æ±‚å³å¯ï¼Œå®ç°é“¾å¼ç›‘å¬ã€‚</p>
<h3 id="4-3-watchæœºåˆ¶"><a href="#4-3-watchæœºåˆ¶" class="headerlink" title="4.3 watchæœºåˆ¶"></a>4.3 watchæœºåˆ¶</h3><p>Zookeeper çš„ watch å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè§¦å‘å™¨ï¼Œå½“ç›‘æ§çš„ znode å‘ç”Ÿæ”¹å˜ï¼Œå°±ä¼šè§¦å‘ znode ä¸Šæ³¨å†Œçš„å¯¹åº”äº‹ä»¶ï¼Œè¯·æ±‚ watch çš„å®¢æˆ·ç«¯å°±ä¼šæ¥æ”¶åˆ°å¼‚æ­¥é€šçŸ¥ã€‚</p>
<p><strong>zkCli.sh ä¸­ä½¿ç”¨ watch</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create /test</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸€æ¬¡æ€§ç›‘å¬ï¼Œç›‘å¬èŠ‚ç‚¹å†…å®¹</span></span><br><span class="line">get -w /test</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç›‘å¬ç›®å½•ï¼Œä½†æ‰€ç›‘å¬èŠ‚ç‚¹ä¸‹åˆ›å»ºå’Œåˆ é™¤å­èŠ‚ç‚¹ä¸ä¼šè§¦å‘ç›‘å¬</span></span><br><span class="line">ls -w /test</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸ä¸Šé¢ç›¸å¯¹ï¼Œéƒ½ä¼šè§¦å‘ç›‘å¬</span></span><br><span class="line">ls -R -w /test</span><br></pre></td></tr></table></figure>



<h2 id="äº”ã€é›†ç¾¤éƒ¨ç½²"><a href="#äº”ã€é›†ç¾¤éƒ¨ç½²" class="headerlink" title="äº”ã€é›†ç¾¤éƒ¨ç½²"></a>äº”ã€é›†ç¾¤éƒ¨ç½²</h2><p>Zookeeper çš„é›†ç¾¤è§’è‰²æœ‰ä¸‰ä¸ªï¼š</p>
<ul>
<li>Leaderï¼šå¤„ç†é›†ç¾¤æ‰€æœ‰äº‹åŠ¡çš„è¯·æ±‚ï¼Œé›†ç¾¤åªæœ‰ä¸€ä¸ª Leader</li>
<li>Followerï¼šåªå¤„ç†è¯»è¯·æ±‚ï¼Œå‚ä¸ Leader é€‰ä¸¾</li>
<li>Observerï¼šåªå¤„ç†è¯»è¯·æ±‚ï¼Œæå‡é›†ç¾¤çš„æ€§èƒ½ï¼Œä½†ä¸èƒ½å‚ä¸ Leader é€‰ä¸¾</li>
</ul>
<p><strong>docker-compose.yaml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">zk01:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zk01</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper:3.7.0</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">zk01</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2181</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">1</span></span><br><span class="line">      <span class="comment"># 2888:ç”¨äºé›†ç¾¤å†…zkä¹‹é—´çš„é€šä¿¡</span></span><br><span class="line">      <span class="comment"># 3888:ç”¨äºé€‰ä¸¾æŠ•ç¥¨</span></span><br><span class="line">      <span class="comment"># 2181:å®¢æˆ·ç«¯ä½¿ç”¨</span></span><br><span class="line">      <span class="comment"># è¦åˆ›å»ºobserveråˆ™åœ¨2181ç«¯å£ååŠ :observer</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zk01:2888:3888;2181</span> <span class="string">server.2=zk02:2888:3888;2181</span> <span class="string">server.3=zk03:2888:3888;2181</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">zk02:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zk02</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper:3.7.0</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">zk02</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2182</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">2</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zk01:2888:3888;2181</span> <span class="string">server.2=zk02:2888:3888;2181</span> <span class="string">server.3=zk03:2888:3888;2181</span></span><br><span class="line">      </span><br><span class="line">  <span class="attr">zk03:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zk03</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper:3.7.0</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">zk03</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2183</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zk01:2888:3888;2181</span> <span class="string">server.2=zk02:2888:3888;2181</span> <span class="string">server.3=zk03:2888:3888;2181</span></span><br></pre></td></tr></table></figure>

<p><strong>é€šè¿‡å‘½ä»¤æŸ¥çœ‹èŠ‚ç‚¹è§’è‰²</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zkServer.sh status</span><br><span class="line">Mode: leader</span><br></pre></td></tr></table></figure>

<p><strong>è¿æ¥é›†ç¾¤</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zkCli.sh -server zk01:2181,zk02:2181,zk03:2181</span><br></pre></td></tr></table></figure>

<h3 id="5-1-ZABåè®®"><a href="#5-1-ZABåè®®" class="headerlink" title="5.1 ZABåè®®"></a>5.1 ZABåè®®</h3><p>ZABï¼ˆZookeeper Atomic Broadcastï¼‰å³ Zookeeper åŸå­å¹¿æ’­åè®®ï¼Œé€šè¿‡è¿™ä¸ªåè®®è§£å†³äº†é›†ç¾¤æ•°æ®ä¸€è‡´æ€§å’Œå´©æºƒæ¢å¤çš„é—®é¢˜ã€‚</p>
<p><strong>ZAB åè®®ä¸­èŠ‚ç‚¹çš„å››ç§çŠ¶æ€</strong></p>
<ul>
<li>Lookingï¼šé€‰ä¸¾çŠ¶æ€</li>
<li>Following</li>
<li>Leading</li>
<li>Observing</li>
</ul>
<p><strong>åˆå§‹åŒ–é›†ç¾¤æ—¶ leader çš„é€‰ä¸¾</strong></p>
<ul>
<li>å½“é›†ç¾¤ä¸­ä¸¤å°èŠ‚ç‚¹å¯åŠ¨æ—¶ï¼Œå°±ä¼šå¼€å§‹ leader çš„é€‰ä¸¾ï¼Œé€‰ç¥¨çš„æ ¼å¼ä¸º <code>(myid,zXid)</code></li>
<li>ç¬¬ä¸€è½®æŠ•ç¥¨æ—¶ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šç”Ÿæˆè‡ªå·±çš„é€‰ç¥¨ï¼Œå³è‡ªå·±çš„ <code>(myid,zXid)</code>ï¼Œç„¶åå°†é€‰ç¥¨ç»™åˆ°å¯¹æ–¹ï¼Œè¿™æ—¶å€™æ¯ä¸ªèŠ‚ç‚¹å°±ä¼šæœ‰ä¸¤å¼ é€‰ç¥¨ï¼Œå³è‡ªå·±çš„å’Œå¯¹æ–¹èŠ‚ç‚¹çš„</li>
<li>æ¥ç€å°±ä¼šæ¯”è¾ƒä¸¤å¼ é€‰ç¥¨çš„ <code>zXid</code>ï¼Œå¦‚æœéƒ½ç›¸åŒå°±å¯¹æ¯” <code>myid</code>ï¼Œå°†å¤§çš„ä¸€ç¥¨æŠ•åˆ°æŠ•ç¥¨ç®±ä¸­</li>
<li>ç¬¬äºŒè½®æŠ•ç¥¨æ—¶ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šå°†ä¸Šä¸€è½®æŠ•å‡ºå»çš„é€‰ç¥¨ç»™åˆ°å…¶å®ƒèŠ‚ç‚¹ï¼Œç„¶åå†å¯¹æ¯” <code>(myid,zXid)</code>ï¼Œå°†å¤§çš„ä¸€ç¥¨æŠ•å‡ºå»ï¼Œå°±èƒ½å¤Ÿé€‰å‡º leader</li>
<li>åæ¥æ–°å¯åŠ¨çš„èŠ‚ç‚¹ä¼šå‘ç°å·²ç»æœ‰ leaderäº†ï¼Œå°±ä¸ç”¨åšé€‰ä¸¾çš„è¿‡ç¨‹äº†</li>
<li>å¯ä»¥çœ‹å‡ºåˆå§‹åŒ–é›†ç¾¤æ—¶ï¼Œleader çš„é€‰ä¸¾ä¸»è¦çœ‹ <code>myid</code></li>
</ul>
<p><strong>å´©æºƒæ¢å¤æ—¶çš„ leader é€‰ä¸¾</strong></p>
<p>åœ¨ leader ç¡®å®šäº†ä¹‹åï¼Œleader ä¼šå‘¨æœŸæ€§åœ°å‘ follower å‘é€å¿ƒè·³åŒ…ï¼Œå½“ follower æ²¡æœ‰æ”¶åˆ° leader å‘é€è¿‡æ¥çš„å¿ƒè·³åŒ…ï¼Œå°±ä¼šè¿›å…¥é€‰ä¸¾è¿‡ç¨‹ï¼Œè¿™æ—¶å€™é›†ç¾¤ä¸èƒ½å¯¹å¤–æä¾›æœåŠ¡ã€‚</p>
<ul>
<li>å½“ leader æŒ‚äº†ä¹‹åï¼Œfollower çš„çŠ¶æ€ä¼šå˜æˆ looking</li>
<li>æ¥ç€å°±è¿›è¡Œé€‰ä¸¾æŠ•ç¥¨ï¼Œè¿‡ç¨‹å’Œåˆå§‹åŒ–é›†ç¾¤æ—¶ä¸€æ ·</li>
</ul>
<h3 id="5-2-ä¸»ä»åŒæ­¥åŸç†"><a href="#5-2-ä¸»ä»åŒæ­¥åŸç†" class="headerlink" title="5.2 ä¸»ä»åŒæ­¥åŸç†"></a>5.2 ä¸»ä»åŒæ­¥åŸç†</h3><p><img src="/2024/02/18/zookeeper/%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E5%8E%9F%E7%90%86.png" alt="ä¸»ä»åŒæ­¥åŸç†"></p>
<h3 id="5-3-NIOå’ŒBIO"><a href="#5-3-NIOå’ŒBIO" class="headerlink" title="5.3 NIOå’ŒBIO"></a>5.3 NIOå’ŒBIO</h3><p><strong>NIO</strong></p>
<p>ç”¨äºè¢«å®¢æˆ·ç«¯è¿æ¥çš„ 2181 ç«¯å£ï¼Œä½¿ç”¨çš„å°±æ˜¯ NIO çš„è¿æ¥æ¨¡å¼ï¼›å®¢æˆ·ç«¯å¼€å¯ watch æ—¶ï¼Œä½¿ç”¨çš„ä¹Ÿæ˜¯ NIOã€‚</p>
<p><strong>BIO</strong></p>
<p>é›†ç¾¤åœ¨è¿›è¡Œé€‰ä¸¾æ—¶ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ç«¯å£ï¼Œä½¿ç”¨çš„æ˜¯ BIO çš„è¿æ¥æ¨¡å¼ã€‚</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-02-18T08:06:41.000Z" title="2/18/2024, 4:06:41 PM">2024-02-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-18T08:31:44.427Z" title="2/18/2024, 4:31:44 PM">2024-02-18</time></span><span class="level-item">2 hours read (About 13895 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/">linuxåŸºç¡€ç½‘ç»œæœåŠ¡</a></p><div class="content"><h2 id="ä¸€ã€DHCPæœåŠ¡"><a href="#ä¸€ã€DHCPæœåŠ¡" class="headerlink" title="ä¸€ã€DHCPæœåŠ¡"></a>ä¸€ã€DHCPæœåŠ¡</h2><h3 id="1-1-DHCPæœåŠ¡ä»‹ç»"><a href="#1-1-DHCPæœåŠ¡ä»‹ç»" class="headerlink" title="1.1 DHCPæœåŠ¡ä»‹ç»"></a>1.1 DHCPæœåŠ¡ä»‹ç»</h3><p>DHCPæœåŠ¡å³åŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼Œè¢«è¿ç”¨åœ¨å±€åŸŸç½‘ä¸­ï¼Œä¸»è¦çš„ä½œç”¨æ˜¯åˆ†é…IPåœ°å€ã€‚</p>
<p>DHCPæœåŠ¡é‡‡ç”¨çš„æ˜¯UDPåè®®ï¼Œå‘é€é‡‡ç”¨UDP67ç«¯å£ï¼Œæ¥å—åˆ™é‡‡ç”¨UDP68ç«¯å£ã€‚</p>
<h3 id="1-2-DHCPæœåŠ¡éƒ¨ç½²"><a href="#1-2-DHCPæœåŠ¡éƒ¨ç½²" class="headerlink" title="1.2 DHCPæœåŠ¡éƒ¨ç½²"></a>1.2 DHCPæœåŠ¡éƒ¨ç½²</h3><ol>
<li>å®‰è£…DHCP</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install dhcp</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>DHCPé…ç½®æ–‡ä»¶è¯¦è§£</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/doc/dhcp*/dhcpd.conf.example /etc/dhcp/dhcpd.conf</span><br><span class="line">cat /etc/dhcp/dhcpd.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">DHCPæœåŠ¡é…ç½®æ–‡ä»¶åˆ†ä¸ºå…¨å±€é…ç½®å’Œä½œç”¨åŸŸé…ç½®ï¼Œå¾ˆå¥½åŒºåˆ†ï¼šsubnetçš„å°±æ˜¯ä½œç”¨åŸŸ ä¸åœ¨subneté‡Œé¢çš„å°±æ˜¯å…¨å±€è®¾ç½®ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dhcpd.conf</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Sample configuration file for ISC dhcpd</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># DNSå…¨å±€é€‰é¡¹ï¼ŒæŒ‡å®šDNSæœåŠ¡å™¨çš„åœ°å€ï¼Œå¯ä»¥æ˜¯IPï¼Œä¹Ÿå¯ä»¥æ˜¯åŸŸåã€‚</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">option definitions common to all supported networks...</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">DNSçš„åŸŸå</span></span><br><span class="line">option domain-name &quot;example.org&quot;;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…·ä½“çš„DNSæœåŠ¡å™¨</span></span><br><span class="line">option domain-name-servers ns1.example.org, ns2.example.org;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç§Ÿçº¦è®¾ç½®ï¼Œé»˜è®¤ç§Ÿçº¦ä¸º600s</span></span><br><span class="line">default-lease-time 600;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç§Ÿçº¦è®¾ç½®ï¼Œæœ€å¤§ç§Ÿçº¦ä¸º7200sï¼Œå½“å®¢æˆ·ç«¯æœªè¯·æ±‚æ˜ç¡®çš„ç§Ÿçº¦æ—¶é—´ã€‚</span></span><br><span class="line">max-lease-time 7200;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŠ¨æ€DNSæ›´æ–°æ–¹å¼(none:ä¸æ”¯æŒï¼›interim:äº’åŠ¨æ›´æ–°æ¨¡å¼ï¼›ad-hoc:ç‰¹æ®Šæ›´æ–°æ¨¡å¼)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Use this to enble / <span class="built_in">disable</span> dynamic dns updates globally.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ddns-update-style none;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœè¯¥DHCPæœåŠ¡å™¨æ˜¯æœ¬åœ°å®˜æ–¹DHCPå°±å°†æ­¤é€‰é¡¹æ‰“å¼€ï¼Œé¿å…å…¶ä»–DHCPæœåŠ¡å™¨çš„å¹²æ‰°ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å½“ä¸€ä¸ªå®¢æˆ·ç«¯è¯•å›¾è·å¾—ä¸€ä¸ªä¸æ˜¯è¯¥DHCPæœåŠ¡å™¨åˆ†é…çš„IPä¿¡æ¯ï¼ŒDHCPå°†å‘é€ä¸€ä¸ªæ‹’ç»æ¶ˆæ¯ï¼Œè€Œä¸ä¼šç­‰å¾…è¯·æ±‚è¶…æ—¶ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å½“è¯·æ±‚è¢«æ‹’ç»ï¼Œå®¢æˆ·ç«¯ä¼šé‡æ–°å‘å½“å‰DHCPå‘é€IPè¯·æ±‚è·å¾—æ–°åœ°å€ã€‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿è¯IPæ˜¯è‡ªå·±å‘å‡ºå»çš„</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># If this DHCP server is the official DHCP server for the local</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">network, the authoritative directive should be uncommented.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¼€å¯æ­¤é¡¹è¡¨æƒå¨DHCP</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">authoritative;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Use this to send dhcp <span class="built_in">log</span> messages to a different <span class="built_in">log</span> file (you also</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">have to hack syslog.conf to complete the redirection).</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ—¥å¿—çº§åˆ«</span></span><br><span class="line">log-facility local7;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">No service will be given on this subnet, but declaring it helps the</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">DHCP server to understand the network topology.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä½œç”¨åŸŸç›¸å…³è®¾ç½®æŒ‡ä»¤</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">subnet å®šä¹‰ä¸€ä¸ªä½œç”¨åŸŸ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">netmask å®šä¹‰ä½œç”¨åŸŸçš„æ©ç </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">range å…è®¸å‘æ”¾çš„IPèŒƒå›´</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">option routers æŒ‡å®šç½‘å…³åœ°å€</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">option domain-name-servers æŒ‡å®šDNSæœåŠ¡å™¨åœ°å€</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">option broadcast-address å¹¿æ’­åœ°å€</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¡ˆä¾‹:å®šä¹‰ä¸€ä¸ªä½œç”¨åŸŸ ç½‘æ®µä¸º10.152.187.0 æ©ç ä¸º255.255.255.0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ­¤ä½œç”¨åŸŸä¸æä¾›ä»»ä½•æœåŠ¡</span></span><br><span class="line">subnet 10.152.187.0 netmask 255.255.255.0 &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This is a very basic subnet declaration.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¡ˆä¾‹:å®šä¹‰ä¸€ä¸ªåŸºæœ¬çš„ä½œç”¨åŸŸ</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç½‘æ®µ10.254.239.0 æ©ç 255.255.255.224</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ†å‘èŒƒå›´10.254.239.10-20</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç½‘å…³ä¸ºrtr-239-0-1.example.org, rtr-239-0-2.example.org</span></span><br><span class="line">subnet 10.254.239.0 netmask 255.255.255.224 &#123;</span><br><span class="line">  range 10.254.239.10 10.254.239.20;</span><br><span class="line">  option routers rtr-239-0-1.example.org, rtr-239-0-2.example.org;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This declaration allows BOOTP clients to get dynamic addresses,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">which</span> we don<span class="string">&#x27;t really recommend.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">æ¡ˆä¾‹:å…è®¸é‡‡ç”¨bootpåè®®çš„å®¢æˆ·ç«¯åŠ¨æ€è·å¾—åœ°å€</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">bootp DHCPçš„å‰èº«</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">BOOTPç”¨äºæ— ç›˜å·¥ä½œç«™çš„å±€åŸŸç½‘ä¸­ï¼Œå¯ä»¥è®©æ— ç›˜å·¥ä½œç«™ä»ä¸€ä¸ªä¸­å¿ƒæœåŠ¡å™¨ä¸Šè·å¾—IPåœ°å€ã€‚é€šè¿‡BOOTPåè®®å¯ä»¥ä¸ºå±€åŸŸç½‘ä¸­çš„æ— ç›˜å·¥ä½œç«™åˆ†é…åŠ¨æ€IPåœ°å€ï¼Œ</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">è¿™æ ·å°±ä¸éœ€è¦ç®¡ç†å‘˜å»ä¸ºæ¯ä¸ªç”¨æˆ·å»è®¾ç½®é™æ€IPåœ°å€ã€‚</span></span></span><br><span class="line">subnet 10.254.239.32 netmask 255.255.255.224 &#123;</span><br><span class="line">  range dynamic-bootp 10.254.239.40 10.254.239.60;</span><br><span class="line">  option broadcast-address 10.254.239.31;</span><br><span class="line">  option routers rtr-239-32-1.example.org;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">æ¡ˆä¾‹:ä¸€ä¸ªç®€å•çš„ä½œç”¨åŸŸæ¡ˆä¾‹</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">A slightly different configuration for an internal subnet.</span></span></span><br><span class="line">subnet 10.5.5.0 netmask 255.255.255.224 &#123;</span><br><span class="line">  range 10.5.5.26 10.5.5.30;</span><br><span class="line">  option domain-name-servers ns1.internal.example.org;</span><br><span class="line">  option domain-name &quot;internal.example.org&quot;;</span><br><span class="line">  option routers 10.5.5.1;</span><br><span class="line">  option broadcast-address 10.5.5.31;</span><br><span class="line">  default-lease-time 600;</span><br><span class="line">  max-lease-time 7200;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Hosts which require special configuration options can be listed in</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">host statements.   If no address is specified, the address will be</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">allocated dynamically (if possible), but the host-specific information</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">will still come from the host declaration.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># ä¿ç•™åœ°å€:å¯ä»¥å°†æŒ‡å®šçš„IPåˆ†å‘ç»™æŒ‡å®šçš„æœºå™¨ï¼Œæ ¹æ®ç½‘å¡çš„MACåœ°å€æ¥åšè§¦å‘</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">host: å¯ç”¨ä¿ç•™ã€‚</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">hardware:æŒ‡å®šå®¢æˆ·ç«¯çš„macåœ°å€</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">filename:æŒ‡å®šæ–‡ä»¶å</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">server-name:æŒ‡å®šä¸‹ä¸€è·³æœåŠ¡å™¨åœ°å€</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">fixed-address: æŒ‡å®šä¿ç•™IPåœ°å€</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">æ¡ˆä¾‹:è¿™ä¸ªæ¡ˆä¾‹ä¸­åˆ†å‘ç»™å®¢æˆ·ç«¯çš„ä¸æ˜¯IPåœ°å€ä¿¡æ¯ï¼Œè€Œæ˜¯å‘Šè¯‰å®¢æˆ·ç«¯å»æ‰¾toccata.fugue.comæœåŠ¡å™¨ï¼Œå¹¶ä¸”ä¸‹è½½vmunix.passacagliaæ–‡ä»¶</span></span></span><br><span class="line">host passacaglia &#123;</span><br><span class="line">  hardware ethernet 0:0:c0:5d:bd:95;</span><br><span class="line">  filename &quot;vmunix.passacaglia&quot;;</span><br><span class="line">  server-name &quot;toccata.fugue.com&quot;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Fixed IP addresses can also be specified for hosts.   These addresses</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">should not also be listed as being available for dynamic assignment.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Hosts for which fixed IP addresses have been specified can boot using</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">BOOTP or DHCP.   Hosts for which no fixed address is specified can only</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">be booted with DHCP, unless there is an address range on the subnet</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">to which a BOOTP client is connected which has the dynamic-bootp flag</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">set.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">æ¡ˆä¾‹:ä¿ç•™åœ°å€ï¼Œå°†æŒ‡å®šIP(fantasia.fugue.comå¯¹åº”çš„IP)åˆ†ç»™æŒ‡å®šå®¢æˆ·ç«¯ç½‘å¡(MAC:08:00:07:26:c0:a5)</span></span></span><br><span class="line">host fantasia &#123;</span><br><span class="line">  hardware ethernet 08:00:07:26:c0:a5;</span><br><span class="line">  fixed-address fantasia.fugue.com;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">è¶…çº§ä½œç”¨åŸŸ</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">è¶…çº§ä½œç”¨åŸŸæ˜¯DHCPæœåŠ¡ä¸­çš„ä¸€ç§ç®¡ç†åŠŸèƒ½ï¼Œä½¿ç”¨è¶…çº§ä½œç”¨åŸŸï¼Œå¯ä»¥å°†å¤šä¸ªä½œç”¨åŸŸç»„åˆä¸ºå•ä¸ªç®¡ç†å®ä½“ã€‚</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">You can declare a class of clients and then do address allocation</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">based on that.   The example below shows a case where all clients</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">in a certain class get addresses on the 10.17.224/24 subnet, and all</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">other clients get addresses on the 10.0.29/24 subnet.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">åœ¨å±€åŸŸç½‘ä¸­ï¼Œå¯ä»¥é…ç½®ç­–ç•¥æ ¹æ®å„ä¸ªæœºå™¨çš„å…·ä½“ä¿¡æ¯åˆ†é…IPåœ°å€å’Œå…¶ä»–çš„ç½‘ç»œå‚æ•°ï¼Œå®¢æˆ·æœºçš„å…·ä½“ä¿¡æ¯ï¼šå®¢æˆ·æœºèƒ½å¤Ÿç»™dhcpæœåŠ¡æä¾›çš„ä¿¡æ¯ç”±ä¸¤ä¸ªï¼Œ</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ç¬¬ä¸€ä¸ªå°±æ˜¯ç½‘å¡çš„dhcp-client-identifierï¼ˆmacåœ°å€ï¼‰ï¼Œ</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ç¬¬äºŒä¸ªå°±æ˜¯è®¾å¤‡çš„vendor-class-identifierã€‚</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ç®¡ç†å‘˜å¯ä»¥æ ¹æ®è¿™ä¸¤ä¸ªä¿¡æ¯ç»™ä¸åŒçš„æœºå™¨åˆ†ç»„ã€‚</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">æ¡ˆä¾‹:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">æŒ‰clientæŸç§ç±»å‹åˆ†ç»„DHCP,è€Œä¸æ˜¯æŒ‰ç‰©ç†æ¥å£ç½‘æ®µ</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ä¾‹å­: SUNW åˆ†é…åœ°å€æ®µ10.17.224.0/24</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">     éSUNWçš„ä¸»æœº,åˆ†é…åœ°å€æ®µ10.0.29.0/24</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">å®šä¹‰ä¸€ä¸ªdhcpç±»:foo</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">requestå¹¿æ’­ä¸­vendor-class-identifierå­—æ®µå¯¹åº”çš„å€¼å‰å››ä¸ªå­—èŠ‚å¦‚æœæ˜¯&quot;SUNW&quot;,åˆ™è§†åˆæ³•å®¢æˆ·ç«¯.</span></span></span><br><span class="line">class &quot;foo&quot; &#123;</span><br><span class="line">  match if substring (option vendor-class-identifier, 0, 4) = &quot;SUNW&quot;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">å®šä¹‰ä¸€ä¸ªè¶…çº§ä½œç”¨åŸŸ: 224-29</span></span></span><br><span class="line">shared-network 224-29 &#123;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">å®šä¹‰ç¬¬ä¸€ä¸ªä½œç”¨åŸŸ</span></span></span><br><span class="line">  subnet 10.17.224.0 netmask 255.255.255.0 &#123;</span><br><span class="line">    option routers rtr-224.example.org;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">å®šä¹‰ç¬¬äºŒä¸ªä½œç”¨åŸŸ</span></span></span><br><span class="line">  subnet 10.0.29.0 netmask 255.255.255.0 &#123;</span><br><span class="line">    option routers rtr-29.example.org;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">å…³è¿æ± ,å¦‚æœå®¢æˆ·ç«¯åŒ¹é…fooç±»ï¼Œå°†è·å¾—è¯¥æ± åœ°å€</span></span></span><br><span class="line">  pool &#123;</span><br><span class="line">    allow members of &quot;foo&quot;;</span><br><span class="line">    range 10.17.224.10 10.17.224.250;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">å…³è¿æ± ,å¦‚æœå®¢æˆ·ç«¯é…ç½®fooç±»ï¼Œåˆ™æ‹’ç»è·å¾—è¯¥æ®µåœ°å€</span></span></span><br><span class="line">  pool &#123;</span><br><span class="line">    deny members of &quot;foo&quot;;</span><br><span class="line">    range 10.0.29.10 10.0.29.230;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-é…ç½®ä½œç”¨åŸŸ"><a href="#1-3-é…ç½®ä½œç”¨åŸŸ" class="headerlink" title="1.3 é…ç½®ä½œç”¨åŸŸ"></a>1.3 é…ç½®ä½œç”¨åŸŸ</h3><ol>
<li>é…ç½®ä½œç”¨åŸŸ</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">subnet 192.168.88.0 netmask 255.255.255.0 &#123;</span><br><span class="line">    range 192.168.88.150 192.168.88.160; # å‘æ”¾åœ°å€èŒƒå›´</span><br><span class="line">    option routers 192.168.88.0; # ç½‘å…³</span><br><span class="line">    option broadcast-address 192.168.88.255; # å¹¿æ’­åœ°å€</span><br><span class="line">    option domain-name-servers 8.8.8.8, 114.114.114.114; # è®¾ç½®DNS</span><br><span class="line">    default-lease-time 7200; # é»˜è®¤ç§Ÿçº¦2å°æ—¶</span><br><span class="line">    max-lease-time 10800; # æœ€å¤§ç§Ÿçº¦3å°æ—¶</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å°†å¦ä¸€å°ä¸»æœºç½‘å¡è®¾ç½®ä¸ºDHCPæ¨¡å¼</li>
</ol>
<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/DHCP%E4%B8%80.png" alt="DHCPä¸€"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯ç½‘ç»œæœåŠ¡</span></span><br><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ç”¨dhclientå‘½ä»¤è¿›è¡Œæµ‹è¯•</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡Šæ”¾IP</span></span><br><span class="line">dhclient -r ens33</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–IP</span></span><br><span class="line">dhclient -d ens33</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/DHCP%E4%BA%8C.png" alt="DHCPäºŒ"></p>
<ol start="4">
<li>æŸ¥çœ‹æ˜¯å¦è·å–äº†150-160ç½‘æ®µå†…çš„åœ°å€</li>
</ol>
<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/DHCP%E4%B8%89.png" alt="DHCPä¸‰"></p>
<h3 id="1-4-ä¿ç•™åœ°å€"><a href="#1-4-ä¿ç•™åœ°å€" class="headerlink" title="1.4 ä¿ç•™åœ°å€"></a>1.4 ä¿ç•™åœ°å€</h3><p>å½“ç§Ÿçº¦åˆ°æœŸçš„æ—¶å€™ï¼Œclientç«¯åªèƒ½ä¹–ä¹–äº¤å‡ºIPåœ°å€ï¼Œä¸‹ä¸€æ¬¡è·å–å°±æœªå¿…æ˜¯åŒæ ·çš„åœ°å€äº†ï¼Œä½†å…¬å¸ä¸­å¾€å¾€æœ‰äº›æœºå™¨è¦ç”¨å›ºå®šçš„åœ°å€ï¼Œä¾‹å¦‚æ‰“å°æœºã€æ–‡ä»¶æœåŠ¡å™¨ç­‰ç­‰ï¼Œæ‰€ä»¥åœ¨DHCPä¸­å¯ä»¥è®¾ç½®ä¿ç•™åœ°å€ä¸ºå…¶ä½¿ç”¨ã€‚</p>
<p>DHCPæ˜¯æ ¹æ®ä¸»æœºç½‘å¡çš„MACåœ°å€æ¥åšåŒ¹é…ï¼Œå°†ä¿ç•™çš„IPåœ°å€åˆ†ç»™ç›¸åº”çš„ä¸»æœºç½‘å¡MACåœ°å€ã€‚</p>
<ol>
<li>è·å–ç½‘å¡MACåœ°å€</li>
</ol>
<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/DHCP%E5%9B%9B.png" alt="DHCPå››"></p>
<ol start="2">
<li>æ·»åŠ ä¿ç•™åœ°å€é…ç½®</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/dhcp/dhcpd.conf</span><br><span class="line">host fantasia &#123;</span><br><span class="line">    hardware ethernet 00:0c:29:6c:6f:0d;</span><br><span class="line">    fixed-address 192.168.88.155;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æŸ¥çœ‹æ˜¯å¦è·å–ç›¸åº”åœ°å€</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dhclient -r ens37</span><br><span class="line">dhclient -d ens37</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/DHCP%E4%BA%94.png" alt="DHCPäº”"></p>
<h3 id="1-5-è¶…çº§ä½œç”¨åŸŸ"><a href="#1-5-è¶…çº§ä½œç”¨åŸŸ" class="headerlink" title="1.5 è¶…çº§ä½œç”¨åŸŸ"></a>1.5 è¶…çº§ä½œç”¨åŸŸ</h3><p>è¶…çº§ä½œç”¨åŸŸç®€å•æ¥è¯´å°±æ˜¯å°†ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„ä¸åŒç½‘æ®µçš„ä½œç”¨åŸŸåˆæˆä¸€ä¸ªä½œç”¨åŸŸã€‚</p>
<ol>
<li>æ·»åŠ è¶…çº§ä½œç”¨åŸŸ</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ·»åŠ ä½œç”¨åŸŸä¹‹å‰DHCPå¿…é¡»æ‹¥æœ‰ä¸¤ä¸ªç½‘æ®µçš„ç½‘å¡</span></span><br><span class="line">shared-network supernet &#123;</span><br><span class="line"></span><br><span class="line">   subnet 192.168.88.0 netmask 255.255.255.0 &#123;</span><br><span class="line">       range 192.168.88.150 192.168.88.160;</span><br><span class="line">       option routers 192.168.88.2;</span><br><span class="line">       option broadcast-address 192.168.88.255;</span><br><span class="line">       option domain-name-servers 8.8.8.8, 114.114.114.114;</span><br><span class="line">       default-lease-time 7200;</span><br><span class="line">       max-lease-time 10800;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   subnet 192.168.99.0 netmask 255.255.255.0 &#123;</span><br><span class="line">       range 192.168.99.150 192.168.99.160;</span><br><span class="line">       option routers 192.168.99.0;</span><br><span class="line">       option broadcast-address 192.168.99.255;</span><br><span class="line">       option domain-name-servers 8.8.8.8, 114.114.114.114;</span><br><span class="line">       default-lease-time 7200;</span><br><span class="line">       max-lease-time 10800;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="äºŒã€DNSæœåŠ¡"><a href="#äºŒã€DNSæœåŠ¡" class="headerlink" title="äºŒã€DNSæœåŠ¡"></a>äºŒã€DNSæœåŠ¡</h2><h3 id="2-1-DNSæœåŠ¡ä»‹ç»"><a href="#2-1-DNSæœåŠ¡ä»‹ç»" class="headerlink" title="2.1 DNSæœåŠ¡ä»‹ç»"></a>2.1 DNSæœåŠ¡ä»‹ç»</h3><p>DNSå³åŸŸåç³»ç»Ÿï¼Œåœ¨äº’è”ç½‘ä¸­ä¸ºåŸŸåå’ŒIPåœ°å€è¿›è¡Œç›¸äº’æ˜ å°„çš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ã€‚</p>
<p>DNSé‡‡ç”¨UDPåè®®ï¼Œä½¿ç”¨UDP53ç«¯å£è¿›è¡Œä¼ è¾“ã€‚</p>
<p>DNSè®°å½•ç±»å‹ï¼š</p>
<ul>
<li>Aï¼šipv4 è®°å½•ï¼Œå°†åŸŸåæ˜ å°„åˆ° ipv4 åœ°å€</li>
<li>AAAAï¼šipv6 è®°å½•ï¼Œå°†åŸŸåæ˜ å°„åˆ° ipv6 åœ°å€</li>
<li>CNAMEï¼šåˆ«åè®°å½•ï¼Œå°†åŸŸåæ˜ å°„åˆ°å¦ä¸€ä¸ªåŸŸå</li>
<li>MXï¼šç”µé‚®äº¤äº’è®°å½•ï¼Œå°†åŸŸåæ˜ å°„åˆ°é‚®ä»¶æœåŠ¡å™¨åœ°å€</li>
<li>TXTï¼šæ–‡æœ¬è®°å½•ï¼Œæ˜¯ä»»æ„å¯è¯»çš„æ–‡æœ¬ DNS è®°å½•</li>
<li>SRVï¼šæœåŠ¡å™¨èµ„æºè®°å½•ï¼Œç”¨æ¥æ ‡è¯†æŸä¸ªæœåŠ¡å™¨ä½¿ç”¨äº†æŸä¸ªæœåŠ¡ï¼Œåˆ›å»ºäºå¾®è½¯ç³»ç»Ÿçš„ç›®å½•ç®¡ç†</li>
<li>NSï¼šåç§°æœåŠ¡å™¨è®°å½•ï¼Œæ”¯æŒå°†å­åŸŸåå§”æ‰˜ç»™å…¶ä»– DNS æœåŠ¡å•†è§£æ</li>
<li>CAAï¼šCAA èµ„æºè®°å½•ï¼Œå¯ä»¥é™å®šåŸŸåé¢å‘è¯ä¹¦å’Œ CA ä¹‹é—´çš„å…³ç³»</li>
</ul>
<h3 id="2-2-DNSæœåŠ¡éƒ¨ç½²"><a href="#2-2-DNSæœåŠ¡éƒ¨ç½²" class="headerlink" title="2.2 DNSæœåŠ¡éƒ¨ç½²"></a>2.2 DNSæœåŠ¡éƒ¨ç½²</h3><ol>
<li>å®‰è£…DNS</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install bind bind-chroot</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bind-chrootæ˜¯<span class="built_in">bind</span>çš„ä¸€ä¸ªåŠŸèƒ½,ä½¿<span class="built_in">bind</span>å¯ä»¥åœ¨ä¸€ä¸ª<span class="built_in">chroot</span>çš„æ¨¡å¼ä¸‹è¿è¡Œ.ä¹Ÿå°±æ˜¯è¯´,<span class="built_in">bind</span>è¿è¡Œæ—¶çš„/(æ ¹)ç›®å½•,å¹¶ä¸æ˜¯ç³»ç»ŸçœŸæ­£çš„/(æ ¹)ç›®å½•,åªæ˜¯ç³»ç»Ÿä¸­çš„ä¸€ä¸ªå­ç›®å½•è€Œå·².è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†æé«˜å®‰å…¨æ€§.å› ä¸ºåœ¨<span class="built_in">chroot</span>çš„æ¨¡å¼ä¸‹,<span class="built_in">bind</span>å¯ä»¥è®¿é—®çš„èŒƒå›´ä»…é™äºè¿™ä¸ªå­ç›®å½•çš„èŒƒå›´é‡Œ,æ— æ³•è¿›ä¸€æ­¥æå‡,è¿›å…¥åˆ°ç³»ç»Ÿçš„å…¶ä»–ç›®å½•ä¸­ã€‚<span class="built_in">bind</span>çš„é»˜è®¤å¯åŠ¨æ–¹å¼å°±æ˜¯<span class="built_in">chroot</span>æ–¹å¼ã€‚</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å°†é…ç½®æ–‡ä»¶å’ŒåŒºåŸŸæ•°æ®åº“æ–‡ä»¶æ‹·è´åˆ°chrootç›®å½•ä¸‹</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp -p /etc/named.conf /var/named/chroot/etc/</span><br><span class="line">cp -pr /var/named/name* /var/named/chroot/var/named/</span><br><span class="line">chown -R named:named /var/named/chroot/*</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½®æ–‡ä»¶ /var/named/chroot/etc/named.conf</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŒºåŸŸæ•°æ®åº“æ–‡ä»¶ /var/named/chroot/var/named/</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>é…ç½®æ–‡ä»¶è¯¦è§£</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> Sample named.conf BIND DNS server &#x27;named&#x27; configuration file</span><br><span class="line"> for the Red Hat BIND distribution.</span><br><span class="line"> See the BIND Administrator&#x27;s Reference Manual (ARM) for details about the</span><br><span class="line"> configuration located in /usr/share/doc/bind-&#123;version&#125;/Bv9ARM.html</span><br><span class="line">*/</span><br><span class="line">options</span><br><span class="line">&#123;</span><br><span class="line">    // Put files that named is allowed to write in the data/ directory:</span><br><span class="line">        #æŒ‡å®šåŒºåŸŸæ•°æ®åº“æ–‡ä»¶çš„è·¯å¾„ç›®å½•</span><br><span class="line">    directory         &quot;/var/named&quot;;        // &quot;Working&quot; directory</span><br><span class="line">    #CACHEæ–‡ä»¶è·¯å¾„,æŒ‡å®šæœåŠ¡å™¨åœ¨æ”¶åˆ°rndc dumpå‘½ä»¤æ—¶ï¼Œè½¬å‚¨æ•°æ®åˆ°æ–‡ä»¶çš„è·¯å¾„ã€‚é»˜è®¤named_dump.db</span><br><span class="line">    dump-file         &quot;data/cache_dump.db&quot;;</span><br><span class="line">    #é™æ€æ–‡ä»¶è·¯å¾„,æŒ‡å®šæœåŠ¡å™¨åœ¨æ”¶åˆ°rndc statså‘½ä»¤æ—¶ï¼Œè¿½åŠ ç»Ÿè®¡æ•°æ®çš„æ–‡ä»¶è·¯å¾„ã€‚é»˜è®¤named.stats</span><br><span class="line">        statistics-file     &quot;data/named_stats.txt&quot;;</span><br><span class="line">    #å†…å­˜é™æ€æ–‡ä»¶è·¯å¾„,æœåŠ¡å™¨åœ¨é€€å‡ºæ—¶ï¼Œå°†å†…å­˜ç»Ÿè®¡å†™åˆ°æ–‡ä»¶çš„è·¯å¾„ã€‚é»˜è®¤named.memstats</span><br><span class="line">        memstatistics-file     &quot;data/named_mem_stats.txt&quot;;</span><br><span class="line">    # æŒ‡å®šæœåŠ¡å™¨åœ¨é€šè¿‡rndc recursingå‘½ä»¤æŒ‡å®šè½¬å‚¨å½“å‰é€’å½’è¯·æ±‚åˆ°çš„æ–‡ä»¶è·¯å¾„ã€‚é»˜è®¤named.recursing</span><br><span class="line">    recursing-file        &quot;data/named.recursing&quot;;</span><br><span class="line">    #åœ¨æ”¶åˆ°rndc secrootsæŒ‡ä»¤åï¼ŒæœåŠ¡å™¨è½¬å‚¨å®‰å…¨æ ¹çš„ç›®çš„æ–‡ä»¶çš„è·¯å¾„åã€‚é»˜è®¤named.secroots</span><br><span class="line">    secroots-file        &quot;data/named.secroots&quot;;</span><br><span class="line">    /*</span><br><span class="line">      Specify listenning interfaces. You can use list of addresses (&#x27;;&#x27; is</span><br><span class="line">      delimiter) or keywords &quot;any&quot;/&quot;none&quot;</span><br><span class="line">    */</span><br><span class="line">    #IPV4ç›‘å¬ç«¯å£ä¸º53,å…è®¸ä»»ä½•äººè¿æ¥</span><br><span class="line">    //listen-on port 53    &#123; any; &#125;;</span><br><span class="line">    #IPv4ç›‘å¬ç«¯å£ä¸º53ï¼Œåªå…è®¸æœ¬æœºè¿æ¥</span><br><span class="line">    listen-on port 53    &#123; 127.0.0.1; &#125;;</span><br><span class="line">    #IPV6ç›‘å¬ç«¯å£ä¸º53,å…è®¸ä»»ä½•äººè¿æ¥</span><br><span class="line">    //listen-on-v6 port 53    &#123; any; &#125;;</span><br><span class="line">    #IPv6ç›‘å¬ç«¯å£ä¸º53ï¼Œåªå…è®¸æœ¬æœºè¿æ¥</span><br><span class="line">    listen-on-v6 port 53    &#123; ::1; &#125;;</span><br><span class="line">    /*</span><br><span class="line">      è®¿é—®æ§åˆ¶</span><br><span class="line">      Access restrictions</span><br><span class="line">          ä¸¤ä¸ªé‡è¦é€‰é¡¹</span><br><span class="line">      There are two important options:</span><br><span class="line">        allow-query &#123; argument; &#125;;</span><br><span class="line">          - allow queries for authoritative data</span><br><span class="line">        å…è®¸æŸ¥è¯¢æ¥è‡ªæƒå¨æ•°æ®</span><br><span class="line">        allow-query-cache &#123; argument; &#125;;</span><br><span class="line">          - allow queries for non-authoritative data (mostly cached data)</span><br><span class="line">        å…è®¸æŸ¥è¯¢æ¥è‡ªéæƒå¨æ•°æ®</span><br><span class="line">      You can use address, network address or keywords &quot;any&quot;/&quot;localhost&quot;/&quot;none&quot; as argument</span><br><span class="line">      å¤§æ‹¬å·ä¸­å¯ä»¥ä½¿ç”¨IPåœ°å€ã€ç½‘æ®µã€æˆ–è€…å…³é”®å­— anyä»»ä½•äºº   localhostæœ¬æœº  noneä»»ä½•äººä¸å…è®¸</span><br><span class="line">      Examples:</span><br><span class="line">        allow-query &#123; localhost; 10.0.0.1; 192.168.1.0/8; &#125;;</span><br><span class="line">        allow-query-cache &#123; ::1; fe80::5c63:a8ff:fe2f:4526; 10.0.0.1; &#125;;</span><br><span class="line">    */</span><br><span class="line">    #æŒ‡å®šå…è®¸å“ªäº›ä¸»æœºå¯ä»¥è¿›è¡Œæ™®é€šçš„DNSæŸ¥è¯¢,å¯ä»¥æ˜¯å…³é”®å­—:any/localhost/none,ä¹Ÿå¯ä»¥æ˜¯IPV4,IPV6åœ°å€</span><br><span class="line">    allow-query        &#123; localhost; &#125;;</span><br><span class="line">    #æŒ‡å®šå…è®¸å“ªäº›ä¸»æœºå¯ä»¥å¯¹ç¼“å­˜çš„è®¿é—®</span><br><span class="line">    allow-query-cache    &#123; localhost; &#125;;</span><br><span class="line">    /* Enable/disable recursion - recursion yes/no;</span><br><span class="line">        é€’å½’æŸ¥è¯¢å¼€å…³</span><br><span class="line">     - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.</span><br><span class="line">    å‡å¦‚ä½ å»ºç«‹çš„æ˜¯ä¸€ä¸ªæƒå¨DNSä½ ä¸éœ€è¦å¼€å¯é€’å½’</span><br><span class="line">     - If you are building a RECURSIVE (caching) DNS server, you need to enable </span><br><span class="line">       recursion. </span><br><span class="line">    å‡å¦‚ä½ å»ºç«‹çš„æ˜¯ä¸€ä¸ªé€’å½’DNS,ä½ éœ€è¦å¼€å¯é€’å½’æœåŠ¡</span><br><span class="line">     - If your recursive DNS server has a public IP address, you MUST enable access </span><br><span class="line">    å¦‚æœä½ çš„é€’å½’DNSæ˜¯å…·æœ‰å…¬ç½‘IPï¼Œä½ å¿…é¡»è¦è®¾ç½®è®¿é—®æ§åˆ¶æ¥é™åˆ¶å¯¹åˆæ³•ç”¨æˆ·çš„æŸ¥è¯¢.</span><br><span class="line">       control to limit queries to your legitimate users. Failing to do so will</span><br><span class="line">       cause your server to become part of large scale DNS amplification </span><br><span class="line">    å¦è€…ä½ çš„DNSä¼šè¢«å¤§è§„æ¨¡çš„æ”»å‡»</span><br><span class="line">       attacks. Implementing BCP38 within your network would greatly</span><br><span class="line">    åœ¨æ‚¨çš„ç½‘ç»œä¸­å®ç°BCP38å°†éå¸¸é‡è¦å‡å°‘æ­¤ç±»æ”»å‡»é¢</span><br><span class="line">       reduce such attack surface </span><br><span class="line">     */</span><br><span class="line">    #å¼€å¯é€’å½’</span><br><span class="line">    recursion yes;</span><br><span class="line">    #Domain Name System Security Extensions (DNSå®‰å…¨æ‰©å±•ï¼‰</span><br><span class="line">    /* DNSSEC related options. See information about keys (&quot;Trusted keys&quot;, bellow) */</span><br><span class="line">    /* Enable serving of DNSSEC related data - enable on both authoritative</span><br><span class="line">        and recursive servers DNSSEC aware servers */</span><br><span class="line">    #å¼€å¯DNSSECåœ¨æƒå¨æˆ–è€…é€’å½’æœåŠ¡å™¨ä¹‹é—´ä¿¡ä»»æœåŠ¡</span><br><span class="line">    dnssec-enable yes;</span><br><span class="line">    /* Enable DNSSEC validation on recursive servers */</span><br><span class="line">    #å¼€å¯DNSSECéªŒè¯åœ¨é€’å½’æœåŠ¡å™¨</span><br><span class="line">    dnssec-validation yes;</span><br><span class="line">    /* In RHEL-7 we use /run/named instead of default /var/run/named</span><br><span class="line">       so we have to configure paths properly. */</span><br><span class="line">    #PIDæ–‡ä»¶è·¯å¾„</span><br><span class="line">    pid-file &quot;/run/named/named.pid&quot;;</span><br><span class="line">    #session-keyfileæ–‡ä»¶è·¯å¾„</span><br><span class="line">    session-keyfile &quot;/run/named/session.key&quot;;</span><br><span class="line">    #æŒ‡å®šç›®å½•ï¼Œå…¶ä¸­ä¿å­˜ç€è·Ÿè¸ªè¢«ç®¡ç†DNSSECå¯†é’¥æ–‡ä»¶ã€‚é»˜è®¤ä¸ºå·¥ä½œç›®å½•ã€‚</span><br><span class="line">    managed-keys-directory &quot;/var/named/dynamic&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">logging </span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¼€å¯DNSæ—¥å¿—è®°å½•</span></span><br><span class="line">/*      If you want to enable debugging, eg. using the &#x27;rndc trace&#x27; command,</span><br><span class="line"> *      named will try to write the &#x27;named.run&#x27; file in the $directory (/var/named).</span><br><span class="line"> *      By default, SELinux policy does not allow named to modify the /var/named directory,</span><br><span class="line"> *      so put the default debug log file in data/ :</span><br><span class="line"> */</span><br><span class="line">        channel default_debug &#123;</span><br><span class="line">                file &quot;data/named.run&quot;;</span><br><span class="line">                severity dynamic;</span><br><span class="line">        &#125;;</span><br><span class="line">/*</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#æ—¥å¿—åˆ†ä¸ºä¸¤ç§ å‘Šè­¦å’Œè®¿é—®</span></span></span><br><span class="line">logging &#123;</span><br><span class="line">  channel warning &#123;</span><br><span class="line">    file &quot;data/dns_warning&quot; versions 10 size 10m;</span><br><span class="line">    severity warning;</span><br><span class="line">    print-category yes;</span><br><span class="line">    print-severity yes;</span><br><span class="line">    print-time yes;</span><br><span class="line">  &#125;;</span><br><span class="line">  channel general_dns &#123;</span><br><span class="line">    file &quot;data/dns_log&quot; versions 10 size 100m;</span><br><span class="line">    severity info;</span><br><span class="line">    print-category yes;</span><br><span class="line">    print-severity yes;</span><br><span class="line">    print-time yes;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">é»˜è®¤æ—¥å¿— warning</span></span><br><span class="line"> category default &#123;</span><br><span class="line">    warning;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">è®¿é—®æ—¥å¿—çº§åˆ« general_dns info</span></span><br><span class="line">  category queries &#123;</span><br><span class="line">    general_dns;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">*/</span><br><span class="line">&#125;;</span><br><span class="line">/*</span><br><span class="line">é€šè¿‡ViewsæŒ‡ä»¤é…ç½®æ™ºèƒ½æŸ¥è¯¢DNS</span><br><span class="line"> Views let a name server answer a DNS query differently depending on who is asking.</span><br><span class="line"> By default, if named.conf contains no &quot;view&quot; clauses, all zones are in the </span><br><span class="line"> &quot;default&quot; view, which matches all clients.</span><br><span class="line"> Views are processed sequentially. The first match is used so the last view should</span><br><span class="line"> match &quot;any&quot; - it&#x27;s fallback and the most restricted view.</span><br><span class="line"> If named.conf contains any &quot;view&quot; clause, then all zones MUST be in a view.</span><br><span class="line">*/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é…ç½®ä¸€ä¸ªæ˜ç§°ä¸ºlocalhost_resolverçš„æ™ºèƒ½è®¿é—®è§†å›¾</span></span><br><span class="line">view &quot;localhost_resolver&quot;</span><br><span class="line">&#123;</span><br><span class="line">/* This view sets up named to be a localhost resolver ( caching only nameserver ).</span><br><span class="line"> * If all you want is a caching-only nameserver, then you need only define this view:</span><br><span class="line"> */</span><br><span class="line">    #å…è®¸ä½¿ç”¨è¯¥è§†å›¾è§£æçš„å®¢æˆ·ç«¯   localhostæœ¬æœº   any ä»»ä½•æœºå™¨  æˆ–è€…ç½‘æ®µ</span><br><span class="line">    match-clients         &#123; localhost; &#125;;</span><br><span class="line">    #å…è®¸é€’å½’</span><br><span class="line">    recursion yes;</span><br><span class="line">    # all views must contain the root hints zone:</span><br><span class="line">    #æ ¹åŸŸ</span><br><span class="line">    zone &quot;.&quot; IN &#123;</span><br><span class="line">        #åŸŸç±»å‹ä¸ºhint,è¿˜æœ‰master slave forwardç­‰ç±»å‹</span><br><span class="line">            type hint;</span><br><span class="line">        #åŒºåŸŸæ•°æ®åº“æ–‡ä»¶è·¯å¾„</span><br><span class="line">            file &quot;/var/named/named.ca&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">        /* these are zones that contain definitions for all the localhost</span><br><span class="line">         * names and addresses, as recommended in RFC1912 - these names should</span><br><span class="line">     * not leak to the other nameservers:</span><br><span class="line">     */</span><br><span class="line">    #åŒ…å«å­é…ç½®æ–‡ä»¶</span><br><span class="line">    include &quot;/etc/named.rfc1912.zones&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å®šä¹‰è§†å›¾internal</span></span><br><span class="line">view &quot;internal&quot;</span><br><span class="line">&#123;</span><br><span class="line">/* This view will contain zones you want to serve only to &quot;internal&quot; clients</span><br><span class="line">   that connect via your directly attached LAN interfaces - &quot;localnets&quot; .</span><br><span class="line"> */</span><br><span class="line">    match-clients        &#123; localnets; &#125;;</span><br><span class="line">    recursion yes;</span><br><span class="line">    zone &quot;.&quot; IN &#123;</span><br><span class="line">            type hint;</span><br><span class="line">            file &quot;/var/named/named.ca&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">        /* these are zones that contain definitions for all the localhost</span><br><span class="line">         * names and addresses, as recommended in RFC1912 - these names should</span><br><span class="line">     * not leak to the other nameservers:</span><br><span class="line">     */</span><br><span class="line">    include &quot;/etc/named.rfc1912.zones&quot;;</span><br><span class="line">    // These are your &quot;authoritative&quot; internal zones, and would probably</span><br><span class="line">    // also be included in the &quot;localhost_resolver&quot; view above :</span><br><span class="line">    /*</span><br><span class="line">      NOTE for dynamic DNS zones and secondary zones:</span><br><span class="line">      DO NOT USE SAME FILES IN MULTIPLE VIEWS!</span><br><span class="line">      If you are using views and DDNS/secondary zones it is strongly</span><br><span class="line">      recommended to read FAQ on ISC site (www.isc.org), section</span><br><span class="line">      &quot;Configuration and Setup Questions&quot;, questions</span><br><span class="line">      &quot;How do I share a dynamic zone between multIPle views?&quot; and</span><br><span class="line">      &quot;How can I make a server a slave for both an internal and an external</span><br><span class="line">       view at the same time?&quot;</span><br><span class="line">    */</span><br><span class="line">    zone &quot;my.internal.zone&quot; &#123; </span><br><span class="line">        type master;</span><br><span class="line">        file &quot;my.internal.zone.db&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">    zone &quot;my.slave.internal.zone&quot; &#123;</span><br><span class="line">        type slave;</span><br><span class="line">        file &quot;slaves/my.slave.internal.zone.db&quot;;</span><br><span class="line">        masters &#123; /* put master nameserver IPs here */ 127.0.0.1; &#125; ;</span><br><span class="line">        // put slave zones in the slaves/ directory so named can update them</span><br><span class="line">    &#125;;    </span><br><span class="line">    zone &quot;my.ddns.internal.zone&quot; &#123;</span><br><span class="line">        type master;</span><br><span class="line">        allow-update &#123; key ddns_key; &#125;;</span><br><span class="line">        file &quot;dynamic/my.ddns.internal.zone.db&quot;;</span><br><span class="line">        // put dynamically updateable zones in the slaves/ directory so named can update them</span><br><span class="line">    &#125;;            </span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è®¾ç½®DDNS_key</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä¸»ä»å¤åˆ¶åŠ å¯†ä½¿ç”¨</span></span><br><span class="line">key ddns_key</span><br><span class="line">&#123;</span><br><span class="line">    #åŠ å¯†æ–¹å¼ hmac-md5</span><br><span class="line">    algorithm hmac-md5;</span><br><span class="line">    secret &quot;use /usr/sbin/dnssec-keygen to generate TSIG keys&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">view &quot;external&quot;</span><br><span class="line">&#123;</span><br><span class="line">/* This view will contain zones you want to serve only to &quot;external&quot; clients</span><br><span class="line"> * that have addresses that are not match any above view:</span><br><span class="line"> */</span><br><span class="line">    match-clients        &#123; any; &#125;;</span><br><span class="line">    zone &quot;.&quot; IN &#123;</span><br><span class="line">            type hint;</span><br><span class="line">            file &quot;/var/named/named.ca&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">    recursion no;</span><br><span class="line">    // you&#x27;d probably want to deny recursion to external clients, so you don&#x27;t</span><br><span class="line">        // end up providing free DNS service to all takers</span><br><span class="line">    // These are your &quot;authoritative&quot; external zones, and would probably</span><br><span class="line">        // contain entries for just your web and mail servers:</span><br><span class="line">    zone &quot;my.external.zone&quot; &#123; </span><br><span class="line">        type master;</span><br><span class="line">        file &quot;my.external.zone.db&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">/* Trusted keys</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å®šä¹‰ä¿¡ä»»çš„dnssecå¯†é’¥ã€‚</span></span><br><span class="line">  This statement contains DNSSEC keys. If you want DNSSEC aware resolver you</span><br><span class="line">  have to configure at least one trusted key.</span><br><span class="line">  Note that no key written below is valid. Especially root key because root zone</span><br><span class="line">  is not signed yet.</span><br><span class="line">*/</span><br><span class="line">/*</span><br><span class="line">trusted-keys &#123;</span><br><span class="line">// Root Key</span><br><span class="line">&quot;.&quot; 257 3 3 &quot;BNY4wrWM1nCfJ+CXd0rVXyYmobt7sEEfK3clRbGaTwSJxrGkxJWoZu6I7PzJu/</span><br><span class="line">             E9gx4UC1zGAHlXKdE4zYIPRhaBKnvcC2U9mZhkdUpd1Vso/HAdjNe8LmMlnzY3</span><br><span class="line">             zy2Xy4klWOADTPzSv9eamj8V18PHGjBLaVtYvk/ln5ZApjYghf+6fElrmLkdaz</span><br><span class="line">             MQ2OCnACR817DF4BBa7UR/beDHyp5iWTXWSi6XmoJLbG9Scqc7l70KDqlvXR3M</span><br><span class="line">             /lUUVRbkeg1IPJSidmK3ZyCllh4XSKbje/45SKucHgnwU5jefMtq66gKodQj+M</span><br><span class="line">             iA21AfUVe7u99WzTLzY3qlxDhxYQQ20FQ97S+LKUTpQcq27R7AT3/V5hRQxScI</span><br><span class="line">             Nqwcz4jYqZD2fQdgxbcDTClU0CRBdiieyLMNzXG3&quot;;</span><br><span class="line">// Key for forward zone</span><br><span class="line">example.com. 257 3 5 &quot;AwEAAaxPMcR2x0HbQV4WeZB6oEDX+r0QM65KbhTjrW1ZaARmPhEZZe</span><br><span class="line">                      3Y9ifgEuq7vZ/zGZUdEGNWy+JZzus0lUptwgjGwhUS1558Hb4JKUbb</span><br><span class="line">                      OTcM8pwXlj0EiX3oDFVmjHO444gLkBO UKUf/mC7HvfwYH/Be22GnC</span><br><span class="line">                      lrinKJp1Og4ywzO9WglMk7jbfW33gUKvirTHr25GL7STQUzBb5Usxt</span><br><span class="line">                      8lgnyTUHs1t3JwCY5hKZ6CqFxmAVZP20igTixin/1LcrgX/KMEGd/b</span><br><span class="line">                      iuvF4qJCyduieHukuY3H4XMAcR+xia2 nIUPvm/oyWR8BW/hWdzOvn</span><br><span class="line">                      SCThlHf3xiYleDbt/o1OTQ09A0=&quot;;</span><br><span class="line">// Key for reverse zone.</span><br><span class="line">2.0.192.IN-ADDRPA.NET. 257 3 5 &quot;AQOnS4xn/IgOUpBPJ3bogzwcxOdNax071L18QqZnQQQA</span><br><span class="line">                                VVr+iLhGTnNGp3HoWQLUIzKrJVZ3zggy3WwNT6kZo6c0</span><br><span class="line">                                tszYqbtvchmgQC8CzKojM/W16i6MG/ea fGU3siaOdS0</span><br><span class="line">                                yOI6BgPsw+YZdzlYMaIJGf4M4dyoKIhzdZyQ2bYQrjyQ</span><br><span class="line">                                4LB0lC7aOnsMyYKHHYeRv PxjIQXmdqgOJGq+vsevG06</span><br><span class="line">                                zW+1xgYJh9rCIfnm1GX/KMgxLPG2vXTD/RnLX+D3T3UL</span><br><span class="line">                                7HJYHJhAZD5L59VvjSPsZJHeDCUyWYrvPZesZDIRvhDD</span><br><span class="line">                                52SKvbheeTJUm6EhkzytNN2SN96QRk8j/iI8ib&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>é…ç½®ä¸»é…æ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">vim /var/named/chroot/etc/named.conf</span><br><span class="line"></span><br><span class="line">options &#123;</span><br><span class="line">        listen-on port 53 &#123; 192.168.88.132; &#125;;</span><br><span class="line">        #listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class="line">        directory       &quot;/var/named&quot;;</span><br><span class="line">        dump-file       &quot;/var/named/data/cache_dump.db&quot;;</span><br><span class="line">        statistics-file &quot;/var/named/data/named_stats.txt&quot;;</span><br><span class="line">        memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;</span><br><span class="line">        recursing-file  &quot;/var/named/data/named.recursing&quot;;</span><br><span class="line">        secroots-file   &quot;/var/named/data/named.secroots&quot;;</span><br><span class="line">        allow-query     &#123; any; &#125;;</span><br><span class="line"></span><br><span class="line">        recursion yes;</span><br><span class="line"></span><br><span class="line">        dnssec-enable yes;</span><br><span class="line">        dnssec-validation yes;</span><br><span class="line"></span><br><span class="line">        pid-file &quot;/run/named/named.pid&quot;;</span><br><span class="line">        session-keyfile &quot;/run/named/session.key&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone &quot;.&quot; IN &#123;</span><br><span class="line">        type hint;</span><br><span class="line">        file &quot;named.ca&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">include &quot;/etc/named.rfc1912.zones&quot;;</span><br><span class="line">include &quot;/etc/named.root.key&quot;;</span><br><span class="line"></span><br><span class="line">systemctl start named-chroot</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>åŒºåŸŸæ•°æ®åº“æ–‡ä»¶è¯¦è§£</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ­£å‘è§£æ named.localhost</span></span><br><span class="line">;ç¼“å­˜æ—¶é—´</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">TTL 1D</span></span><br><span class="line">;@è¡¨ç¤ºç›¸åº”çš„åŸŸå</span><br><span class="line">@    IN SOA        @ rname.invalid. (</span><br><span class="line">;è§£æçš„åŸŸå   ç±»å‹ æˆæƒåŸŸ    æˆæƒåŸŸåæœåŠ¡å™¨   ç®¡ç†å‘˜é‚®ç®±</span><br><span class="line">                    0    ; serial  åºåˆ—å·,æ¯æ¬¡æ›´æ–°è¯¥æ–‡ä»¶ç³»åˆ—å·éƒ½åº”è¯¥å˜å¤§</span><br><span class="line">                    1D    ; refresh åˆ·æ–°æ—¶é—´,å³è§„å®šä»åŸŸåæœåŠ¡å™¨å¤šé•¿æ—¶é—´æŸ¥è¯¢ä¸€ä¸ªä¸»æœåŠ¡å™¨ï¼Œä»¥ä¿è¯ä»æœåŠ¡å™¨çš„æ•°æ®æ˜¯æœ€æ–°çš„</span><br><span class="line">                    1H    ; retry   é‡è¯•æ—¶é—´,å³å½“ä»æœåŠ¡è¯•å›¾åœ¨ä¸»æœåŠ¡å™¨ä¸ŠæŸ¥è¯¢æ›´æ—¶ï¼Œè€Œè¿æ¥å¤±è´¥äº†ï¼Œåˆ™è¿™ä¸ªå€¼è§„å®šäº†ä»æœåŠ¡å¤šé•¿æ—¶é—´åå†è¯• </span><br><span class="line">                    1W    ; expire  è¿‡æœŸæ—¶é—´,ä»æœåŠ¡å™¨åœ¨å‘ä¸»æœåŠ¡æ›´æ–°å¤±è´¥åå¤šé•¿æ—¶é—´åæ¸…é™¤å¯¹åº”çš„è®°å½•</span><br><span class="line">                    3H )    ; minimum è¿™ä¸ªæ•°æ®ç”¨æ¥è§„å®šç¼“å†²æœåŠ¡å™¨ä¸èƒ½ä¸ä¸»æœåŠ¡è”ç³»ä¸Šåå¤šé•¿æ—¶é—´æ¸…é™¤ç›¸åº”çš„è®°å½•</span><br><span class="line">    NS   @</span><br><span class="line">    ;NS åç§°æœåŠ¡å™¨ï¼Œè¡¨ç¤ºè¿™ä¸ªä¸»æœºä¸ºåŸŸåæœåŠ¡å™¨</span><br><span class="line">    A    127.0.0.1</span><br><span class="line">;ä¸»æœºå¤´  Aè®°å½•   IP</span><br><span class="line">    AAAA    ::1</span><br><span class="line">;   AAAA è§£æä¸ºIPV6åœ°å€</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åå‘è§£æ named.loopback</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">TTL 1D</span></span><br><span class="line">@    IN SOA    @ rname.invalid. (</span><br><span class="line">                    0    ; serial</span><br><span class="line">                    1D    ; refresh</span><br><span class="line">                    1H    ; retry</span><br><span class="line">                    1W    ; expire</span><br><span class="line">                    3H )    ; minimum</span><br><span class="line">    NS    @</span><br><span class="line">    PTR    localhost</span><br><span class="line">;IP åå‘æŒ‡é’ˆ     åŸŸå</span><br><span class="line">;PTR åå‘æŒ‡é’ˆ åè§£</span><br></pre></td></tr></table></figure>

<h3 id="2-3-æ­£å‘è§£æ"><a href="#2-3-æ­£å‘è§£æ" class="headerlink" title="2.3 æ­£å‘è§£æ"></a>2.3 æ­£å‘è§£æ</h3><ol>
<li>ä¿®æ”¹ä¸»é…æ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zone &quot;cqm.com&quot; IN &#123;</span><br><span class="line">	type master;</span><br><span class="line">	file &quot;cqm.com.zone&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åˆ›å»ºåŒºåŸŸæ•°æ®åº“æ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cp /var/named/chroot/var/named/named.localhost /var/named/chroot/var/named/cqm.com.zone</span><br><span class="line">chgrp named cqm.com.zone</span><br><span class="line">vim /var/named/chroot/var/named/cqm.com.zone</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">TTL 1D</span></span><br><span class="line">cqm.com.    IN SOA  dns.cqm.com. rname.invalid. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">A:IPv4è§£æä¸ºåŸŸå</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">PTR:åŸŸåè§£æä¸ºIP</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MX</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CNAME:è®¾ç½®åˆ«å</span></span><br><span class="line">		NS      dns.cqm.com.</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£ædnsä¸º192.168.88.132</span></span><br><span class="line">dns		A		192.168.88.132</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£æwwwä¸º192.168.88.132</span></span><br><span class="line">www     A       192.168.88.132</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç”¨newsè®¿é—®ä¹Ÿè§£æä¸ºwww</span></span><br><span class="line">news    CNAME   www</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æµ‹æ–‡ä»¶æ˜¯å¦æœ‰è¯¯</span></span><br><span class="line">named-checkzone cqm.com cqm.com.zone</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åœ¨å®¢æˆ·ç«¯ä¸Šé…ç½®DNS</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolve.conf</span><br><span class="line">nameserver 192.168.88.132</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>é€šè¿‡hostå‘½ä»¤è¿›è¡Œæµ‹è¯•</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum -y install bind-utils</span><br><span class="line">host www.cqm.com</span><br><span class="line">www.cqm.com has address 192.168.88.132</span><br><span class="line"></span><br><span class="line">host news.cqm.com</span><br><span class="line">news.cqm.com is an alias for www.cqm.com.</span><br><span class="line">www.cqm.com has address 192.168.88.132</span><br></pre></td></tr></table></figure>

<h3 id="2-4-åå‘è§£æ"><a href="#2-4-åå‘è§£æ" class="headerlink" title="2.4 åå‘è§£æ"></a>2.4 åå‘è§£æ</h3><ol>
<li>ä¿®æ”¹ä¸»é…æ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zone &quot;88.168.192.in-addr.arpa&quot; IN &#123;</span><br><span class="line">	type master;</span><br><span class="line">	file &quot;192.168.88.arpa&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åˆ›å»ºåŒºåŸŸæ•°æ®åº“æ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cp /var/named/chroot/var/named/named.loopback /var/named/chroot/var/named/192.168.88.arpa</span><br><span class="line">vim /var/named/chroot/var/named/192.168.88.arpa</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">TTL 1D</span></span><br><span class="line">88.168.192.in-addr.arpa.        IN SOA  dns.cqm.com. rname.invalid. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      dns.cqm.com.</span><br><span class="line">132     PTR     www.cqm.com.</span><br><span class="line"></span><br><span class="line">named-checkzone 88.168.192.in-addr.arpa 192.168.88.arpa</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æµ‹è¯•</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">host 192.168.88.132</span><br><span class="line">132.88.168.192.in-addr.arpa domain name pointer www.cqm.com.</span><br></pre></td></tr></table></figure>

<h3 id="2-5-ä¸»ä»åŒæ­¥"><a href="#2-5-ä¸»ä»åŒæ­¥" class="headerlink" title="2.5 ä¸»ä»åŒæ­¥"></a>2.5 ä¸»ä»åŒæ­¥</h3><p>å³é…ç½®ä¸¤å°DNSæœåŠ¡å™¨ï¼Œç”±äºä¸Šè¾¹æˆ‘ä»¬ä»¥åŠé…ç½®è¿‡ä¸»DNSäº†ï¼Œæ¥ä¸‹æ¥å†é…ç½®ä¸€å°è¾…DNSæœåŠ¡å™¨å³å¯ã€‚</p>
<p>ä¸»DNSæœåŠ¡å™¨IPï¼š192.168.88.132</p>
<p>è¾…DNSæœåŠ¡å™¨IPï¼š192.168.88.135</p>
<ol>
<li>å®‰è£…DNS</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install bind bind-chroot</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>é…ç½®ä¸»é…ç½®æ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">scp root@192.168.88.132:/var/named/chroot/etc/named.conf /var/named/chroot/etc/named.conf</span><br><span class="line">chgrp named /var/named/chroot/etc/named.conf</span><br><span class="line">vim /var/named/chroot/etc/named.conf</span><br><span class="line"></span><br><span class="line">options &#123;</span><br><span class="line">        listen-on port 53 &#123; 192.168.88.135; &#125;;</span><br><span class="line">        #listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class="line">        directory       &quot;/var/named&quot;;</span><br><span class="line">        dump-file       &quot;/var/named/data/cache_dump.db&quot;;</span><br><span class="line">        statistics-file &quot;/var/named/data/named_stats.txt&quot;;</span><br><span class="line">        memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;</span><br><span class="line">        recursing-file  &quot;/var/named/data/named.recursing&quot;;</span><br><span class="line">        secroots-file   &quot;/var/named/data/named.secroots&quot;;</span><br><span class="line">        allow-query     &#123; any; &#125;;</span><br><span class="line">        # ä»ä¸»DNSæœåŠ¡å™¨æ‹·è¿‡æ¥çš„æ•°æ®ä¸è¿›è¡ŒåŠ å¯†</span><br><span class="line">        masterfile-format text;</span><br><span class="line"></span><br><span class="line">        recursion yes;</span><br><span class="line"></span><br><span class="line">        dnssec-enable yes;</span><br><span class="line">        dnssec-validation yes;</span><br><span class="line"></span><br><span class="line">        pid-file &quot;/run/named/named.pid&quot;;</span><br><span class="line">        session-keyfile &quot;/run/named/session.key&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone &quot;.&quot; IN &#123;</span><br><span class="line">        type hint;</span><br><span class="line">        file &quot;named.ca&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone &quot;cqm.com&quot; IN &#123;</span><br><span class="line">        type slave;</span><br><span class="line">        file &quot;cqm.com.zone&quot;;</span><br><span class="line">        masters &#123; 192.168.88.132; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone &quot;88.168.192.in-addr.arpa&quot; IN &#123;</span><br><span class="line">        type slave;</span><br><span class="line">        file &quot;192.168.88.arpa&quot;;</span><br><span class="line">        masters &#123; 192.168.88.132; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">include &quot;/etc/named.rfc1912.zones&quot;;</span><br><span class="line">include &quot;/etc/named.root.key&quot;;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>é…ç½®å’Œä¸»DNSæœåŠ¡å™¨ç›¸åŒçš„åŒºåŸŸæ•°æ®åº“æ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim cqm.com.zone</span><br><span class="line">...</span><br><span class="line">vim 192.168.88.arpa</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>å°†DNSæœåŠ¡å™¨è®¾ä¸ºè‡ªå·±åè¿›è¡Œæµ‹è¯•</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/reslove.comf</span><br><span class="line">nameserver 192.168.88.135</span><br><span class="line">host www.cqm.com</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="2-6-æ™ºèƒ½è§£æ"><a href="#2-6-æ™ºèƒ½è§£æ" class="headerlink" title="2.6 æ™ºèƒ½è§£æ"></a>2.6 æ™ºèƒ½è§£æ</h3><p>åœ¨DNSä¸­æ¤å…¥å…¨ä¸–ç•Œçš„IPåº“ä»¥åŠIPå¯¹åº”çš„åœ°åŸŸï¼Œå½“ç”¨æˆ·å‘æ¥è¯·æ±‚æ—¶ï¼Œä¼šæ ¹æ®ç”¨æˆ·å±äºå“ªä¸ªåœ°åŒºæ¥æ‰¾é‚£ä¸ªåœ°åŒºçš„åŒºåŸŸæ•°æ®åº“æ–‡ä»¶æ¥è¿›è¡Œè§£æï¼Œä»è€Œä½¿å¾—ä¸åŒåœ°åŸŸçš„ç”¨æˆ·è§£æä¸åŒã€‚</p>
<p>ä¾‹å­ï¼š</p>
<p>éƒ¨ç½²ä¸€å°æ™ºèƒ½è§£æDNSæœåŠ¡å™¨ï¼Œå¯¹cqm.comè¿›è¡Œè§£æ</p>
<p>æ·±åœ³ç”¨æˆ·è§£æä¸º1.1.1.1</p>
<p>å¹¿å·ç”¨æˆ·è§£æä¸º2.2.2.2</p>
<p>ä½›å±±ç”¨æˆ·è§£æä¸º3.3.3.3</p>
<ol>
<li>ä¿®æ”¹ä¸»é…æ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">options &#123;</span><br><span class="line">        listen-on port 53 &#123; 192.168.88.132; &#125;;</span><br><span class="line">        #listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class="line">        directory       &quot;/var/named&quot;;</span><br><span class="line">        dump-file       &quot;/var/named/data/cache_dump.db&quot;;</span><br><span class="line">        statistics-file &quot;/var/named/data/named_stats.txt&quot;;</span><br><span class="line">        memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;</span><br><span class="line">        recursing-file  &quot;/var/named/data/named.recursing&quot;;</span><br><span class="line">        secroots-file   &quot;/var/named/data/named.secroots&quot;;</span><br><span class="line">        allow-query     &#123; any; &#125;;</span><br><span class="line"></span><br><span class="line">        recursion yes;</span><br><span class="line"></span><br><span class="line">        dnssec-enable yes;</span><br><span class="line">        dnssec-validation yes;</span><br><span class="line"></span><br><span class="line">        pid-file &quot;/run/named/named.pid&quot;;</span><br><span class="line">        session-keyfile &quot;/run/named/session.key&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">acl sz &#123;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">å‡è®¾è¯¥ç½‘æ®µæ˜¯æ·±åœ³çš„IPåœ°å€æ®µ</span></span><br><span class="line">        192.168.77.0/24;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">acl gz &#123;</span><br><span class="line">        192.168.88.0/24;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">acl fs &#123;</span><br><span class="line">        192.168.99.0/24;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">view shenzhen &#123;</span><br><span class="line">match-clients &#123; sz; &#125;;</span><br><span class="line">        zone &quot;.&quot; IN &#123;</span><br><span class="line">                type hint;</span><br><span class="line">                file &quot;named.ca&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        zone &quot;cqm.com&quot; IN &#123;</span><br><span class="line">                type master;</span><br><span class="line">                file &quot;cqm.com.zone.SZ&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">view guangzhou &#123;</span><br><span class="line">match-clients &#123; gz; &#125;;</span><br><span class="line">        zone &quot;.&quot; IN &#123;</span><br><span class="line">                type hint;</span><br><span class="line">                file &quot;named.ca&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        zone &quot;cqm.com&quot; IN &#123;</span><br><span class="line">                type master;</span><br><span class="line">                file &quot;cqm.com.zone.GZ&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">view foshan &#123;</span><br><span class="line">match-clients &#123; fs; &#125;;</span><br><span class="line">        zone &quot;.&quot; IN &#123;</span><br><span class="line">                type hint;</span><br><span class="line">                file &quot;named.ca&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        zone &quot;cqm.com&quot; IN &#123;</span><br><span class="line">                type master;</span><br><span class="line">                file &quot;cqm.com.zone.FS&quot;;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ·»åŠ åŒºåŸŸæ•°æ®åº“æ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">cp cqm.com.zone cqm.com.zone.SZ</span><br><span class="line">cp cqm.com.zone cqm.com.zone.GZ</span><br><span class="line">cp cqm.com.zone cqm.com.zone.FS</span><br><span class="line">chgrp named cqm.com.zone.*</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ·±åœ³</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">TTL 1D</span></span><br><span class="line">cqm.com.        IN SOA  dns.cqm.com. rname.invalid. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      dns.cqm.com.</span><br><span class="line">dns     A       192.168.88.132</span><br><span class="line">www     A       1.1.1.1</span><br><span class="line">news    CNAME   www</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¹¿å·</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">TTL 1D</span></span><br><span class="line">cqm.com.        IN SOA  dns.cqm.com. rname.invalid. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      dns.cqm.com.</span><br><span class="line">dns     A       192.168.88.132</span><br><span class="line">www     A       2.2.2.2</span><br><span class="line">news    CNAME   www</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä½›å±±</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">TTL 1D</span></span><br><span class="line">cqm.com.        IN SOA  dns.cqm.com. rname.invalid. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      dns.cqm.com.</span><br><span class="line">dns     A       192.168.88.132</span><br><span class="line">www     A       3.3.3.3</span><br><span class="line">news    CNAME   www</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æµ‹è¯•</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æµ‹è¯•ä¸»æœºçš„åœ°å€æ®µä¸º192.168.88.0/24ç½‘æ®µçš„ï¼Œæ‰€ä»¥å±äºå¹¿å·åŒºåŸŸï¼Œå³åŒ¹é…è§£æåˆ°2.2.2.2</span></span><br><span class="line">host www.cqm.com</span><br><span class="line">www.cqm.com has address 2.2.2.2</span><br></pre></td></tr></table></figure>



<h2 id="ä¸‰ã€FTPæ–‡ä»¶ä¼ è¾“æœåŠ¡"><a href="#ä¸‰ã€FTPæ–‡ä»¶ä¼ è¾“æœåŠ¡" class="headerlink" title="ä¸‰ã€FTPæ–‡ä»¶ä¼ è¾“æœåŠ¡"></a>ä¸‰ã€FTPæ–‡ä»¶ä¼ è¾“æœåŠ¡</h2><h3 id="3-1-FTPæœåŠ¡ä»‹ç»"><a href="#3-1-FTPæœåŠ¡ä»‹ç»" class="headerlink" title="3.1 FTPæœåŠ¡ä»‹ç»"></a>3.1 FTPæœåŠ¡ä»‹ç»</h3><p>FTPå³æ–‡ä»¶ä¼ è¾“åè®®ï¼Œæ˜¯TCP&#x2F;IPåè®®ç»„çš„åè®®ä¹‹ä¸€ã€‚</p>
<p>FTPé»˜è®¤é‡‡ç”¨TCP20å’Œ21ç«¯å£ï¼Œ20ç”¨äºä¼ è¾“æ•°æ®ï¼Œ21ç”¨äºæ§åˆ¶ä¼ è¾“ä¿¡æ¯ã€‚</p>
<p>FTPåˆ†åˆ«æœ‰ä¸»åŠ¨ä¼ è¾“æ–¹å¼å’Œè¢«åŠ¨ä¼ è¾“æ–¹å¼ä¸¤ç§ï¼Œå½“FTPä¸ºä¸»åŠ¨ä¼ è¾“æ–¹å¼æ—¶è¿ç”¨20å’Œ21ç«¯å£ï¼Œè€Œå½“FTPä¸ºè¢«åŠ¨ä¼ è¾“æ–¹å¼æ—¶åˆ™ä¼šéšå³æ‰“å¼€ä¸€ä¸ªå¤§äº1024çš„ç«¯å£æ¥è¿›è¡Œæ•°æ®çš„ä¼ è¾“ã€‚</p>
<h3 id="3-2-FTPæœåŠ¡éƒ¨ç½²"><a href="#3-2-FTPæœåŠ¡éƒ¨ç½²" class="headerlink" title="3.2 FTPæœåŠ¡éƒ¨ç½²"></a>3.2 FTPæœåŠ¡éƒ¨ç½²</h3><ol>
<li>å®‰è£…vsftpd</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install vsftpd</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ä¸»é…æ–‡ä»¶è¯¦è§£</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Example config file /etc/vsftpd/vsftpd.conf</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The default compiled in settings are fairly paranoid. This sample file</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">loosens things up a bit, to make the ftp daemon more usable.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Please see vsftpd.conf.5 <span class="keyword">for</span> all compiled <span class="keyword">in</span> defaults.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># READ THIS: This example file is NOT an exhaustive list of vsftpd options.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Please <span class="built_in">read</span> the vsftpd.conf.5 manual page to get a full idea of vsftpd<span class="string">&#x27;s</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">capabilities.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#åŒ¿åç”¨æˆ·è®¿é—®,YESæ˜¯å…è®¸ï¼ŒNOæ˜¯æ‹’ç»</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Allow anonymous FTP? (Beware - allowed by default if you comment this out).</span></span></span><br><span class="line">anonymous_enable=YES</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Uncomment this to allow local users to log in.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">æœ¬åœ°ç”¨æˆ·ç™»å½•,YESæ˜¯å…è®¸ï¼ŒNOæ˜¯æ‹’ç».é»˜è®¤è®¿é—®çš„æ˜¯æœ¬åœ°ç”¨æˆ·å®¶ç›®å½•ï¼Œå¦‚æœä½ å¼€å¯äº†selinux</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">è¯·è®¾ç½®å¼€å¯å¸ƒå°”å€¼ftp_home_dirä¸ºON</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">When SELinux is enforcing check for SE bool ftp_home_dir</span></span></span><br><span class="line">local_enable=YES</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#å…è®¸æœ¬åœ°ç”¨æˆ·ä¸Šä¼ </span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Uncomment this to enable any form of FTP write command.</span></span></span><br><span class="line">write_enable=YES</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Default umask for local users is 077. You may wish to change this to 022,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ä¸Šä¼ çš„æƒé™æ˜¯022ï¼Œä½¿ç”¨çš„æ˜¯umaskæƒé™ã€‚å¯¹åº”çš„ç›®å½•æ˜¯755ï¼Œæ–‡ä»¶æ˜¯644</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">if your users expect that (022 is used by most other ftpd&#x27;</span>s)</span></span><br><span class="line">local_umask=022</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Uncomment this to allow the anonymous FTP user to upload files. This only</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">has an effect <span class="keyword">if</span> the above global write <span class="built_in">enable</span> is activated. Also, you will</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">obviously need to create a directory writable by the FTP user.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">When SELinux is enforcing check <span class="keyword">for</span> SE bool allow_ftpd_anon_write, allow_ftpd_full_access</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¼€å¯åŒ¿åç”¨æˆ·ä¸Šä¼ åŠŸèƒ½ï¼Œé»˜è®¤æ˜¯æ‹’ç»çš„</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">anon_upload_enable=YES</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Uncomment this if you want the anonymous FTP user to be able to create</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">new directories.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¼€å¯åŒ¿åç”¨æˆ·åˆ›å»ºæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æƒé™</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">anon_mkdir_write_enable=YES</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Activate directory messages - messages given to remote users when they</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">go into a certain directory.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¼€å¯ç›®å½•æ¬¢è¿æ¶ˆæ¯ï¼Œä¸€èˆ¬å¯¹å‘½ä»¤è¡Œç™»é™†æœ‰æ•ˆ</span></span><br><span class="line">dirmessage_enable=YES</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Activate logging of uploads/downloads.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¼€å¯ä¸Šä¼ å’Œä¸‹è½½æ—¥å¿—è®°å½•åŠŸèƒ½</span></span><br><span class="line">xferlog_enable=YES</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#ä½¿ç”¨æ ‡å‡†æ¨¡å¼</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Make sure PORT transfer connections originate from port 20 (ftp-data).</span></span><br><span class="line">connect_from_port_20=YES</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># If you want, you can arrange for uploaded anonymous files to be owned by</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a different user. Note! Using <span class="string">&quot;root&quot;</span> <span class="keyword">for</span> uploaded files is not</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">recommended!</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å£°æ˜åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„æ‰€æœ‰è€…</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…è®¸æ›´æ”¹åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„æ‰€æœ‰è€…</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">chown_uploads=YES</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ‰€æœ‰è€…ä¸ºwhoever</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">chown_username=whoever</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># You may override where the log file goes if you like. The default is shown</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">below.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ—¥å¿—æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">xferlog_file=/var/log/xferlog</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># If you want, you can have your log file in standard ftpd xferlog format.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Note that the default <span class="built_in">log</span> file location is /var/log/xferlog <span class="keyword">in</span> this <span class="keyword">case</span>.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ—¥å¿—æ–‡ä»¶é‡‡ç”¨æ ‡å‡†æ ¼æ–¯</span></span><br><span class="line">xferlog_std_format=YES</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># You may change the default value for timing out an idle session.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¼šè¯è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">idle_session_timeout=600</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># You may change the default value for timing out a data connection.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ•°æ®ä¼ è¾“è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">data_connection_timeout=120</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># It is recommended that you define on your system a unique user which the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ftp server can use as a totally isolated and unprivileged user.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">FTPå­è¿›ç¨‹ç®¡ç†ç”¨æˆ·</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nopriv_user=ftpsecure</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Enable this and the server will recognise asynchronous ABOR requests. Not</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">recommended <span class="keyword">for</span> security (the code is non-trivial). Not enabling it,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">however, may confuse older FTP clients.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¯å¦å…è®¸å®¢æˆ·ç«¯å‘èµ·â€œasync ABORâ€è¯·æ±‚ï¼Œè¯¥æ“ä½œæ˜¯ä¸å®‰å…¨çš„é»˜è®¤ç¦æ­¢ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">async_abor_enable=YES</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># By default the server will pretend to allow ASCII mode but in fact ignore</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the request. Turn on the below options to have the server actually <span class="keyword">do</span> ASCII</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mangling on files when <span class="keyword">in</span> ASCII mode. The vsftpd.conf(5) man page explains</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the behaviour when these options are disabled.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Beware that on some FTP servers, ASCII support allows a denial of service</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">attack (DoS) via the <span class="built_in">command</span> <span class="string">&quot;SIZE /big/file&quot;</span> <span class="keyword">in</span> ASCII mode. vsftpd</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">predicted this attack and has always been safe, reporting the size of the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">raw file.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ASCII mangling is a horrible feature of the protocol.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¯¥é€‰é¡¹ç”¨äºæŒ‡å®šæ˜¯å¦å…è®¸ä¸Šä¼ æ—¶ä»¥ASCIIæ¨¡å¼ä¼ è¾“æ•°æ®</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ascii_upload_enable=YES</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¯¥é€‰é¡¹ç”¨äºæŒ‡å®šæ˜¯å¦å…è®¸ä¸‹è½½æ—¶ä»¥ASCIIæ¨¡å¼ä¼ è¾“æ•°æ®</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ascii_download_enable=YES</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># You may fully customise the login banner string:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">FTPæ–‡æœ¬ç•Œé¢ç™»é™†æ¬¢è¿è¯</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ftpd_banner=Welcome to blah FTP service.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># You may specify a file of disallowed anonymous e-mail addresses. Apparently</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">useful <span class="keyword">for</span> combatting certain DoS attacks.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¯å¦å¼€å¯æ‹’ç»çš„EmailåŠŸèƒ½</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">deny_email_enable=YES</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">(default follows)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŒ‡å®šä¿å­˜è¢«æ‹’æ¥çš„Emailåœ°å€çš„æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">banned_email_file=/etc/vsftpd/banned_emails</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># You may specify an explicit list of local users to chroot() to their home</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">directory. If chroot_local_user is YES, <span class="keyword">then</span> this list becomes a list of</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">users</span> to NOT <span class="built_in">chroot</span>().</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">(Warning! <span class="built_in">chroot</span><span class="string">&#x27;ing can be very dangerous. If using chroot, make sure that</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the user does not have write access to the top level directory within the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">chroot)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">æ˜¯å¦å¼€å¯å¯¹æœ¬åœ°ç”¨æˆ·chrootçš„é™åˆ¶ï¼ŒYESä¸ºé»˜è®¤æ‰€æœ‰ç”¨æˆ·éƒ½ä¸èƒ½åˆ‡å‡ºå®¶ç›®å½•ï¼ŒNOä»£è¡¨é»˜è®¤ç”¨æˆ·éƒ½å¯ä»¥åˆ‡å‡ºå®¶ç›®å½•</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">è®¾ç½®æ–¹æ³•ç±»ä¼¼äºï¼šYESæ‹’ç»æ‰€æœ‰å…è®¸ä¸ªåˆ«ï¼›NOå…è®¸æ‰€æœ‰æ‹’ç»ä¸ªåˆ«</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">chroot_local_user=YES</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">å¼€å¯ç‰¹ä¾‹åˆ—è¡¨</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">chroot_list_enable=YES</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">(default follows)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">å¦‚æœchroot_local_userçš„å€¼æ˜¯YESåˆ™è¯¥æ–‡ä»¶ä¸­çš„ç”¨æˆ·æ˜¯å¯ä»¥åˆ‡å‡ºå®¶ç›®å½•ï¼Œå¦‚æœæ˜¯NOï¼Œè¯¥æ–‡ä»¶ä¸­çš„ç”¨æˆ·åˆ™ä¸èƒ½åˆ‡å‡ºå®¶ç›®å½•</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ä¸€è¡Œä¸€ä¸ªç”¨æˆ·ã€‚</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">chroot_list_file=/etc/vsftpd/chroot_list</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># You may activate the &quot;-R&quot; option to the builtin ls. This is disabled by</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">default to avoid remote users being able to cause excessive I/O on large</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">sites. However, some broken FTP clients such as &quot;ncftp&quot; and &quot;mirror&quot; assume</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the presence of the &quot;-R&quot; option, so there is a strong case for enabling it.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">æ˜¯å¦å¼€å¯ls é€’å½’æŸ¥è¯¢åŠŸèƒ½ ls -R</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">ls_recurse_enable=YES</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># When &quot;listen&quot; directive is enabled, vsftpd runs in standalone mode and</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">listens on IPv4 sockets. This directive cannot be used in conjunction</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">with the listen_ipv6 directive.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">æ˜¯å¦å¼€å¯ftpç‹¬ç«‹æ¨¡å¼åœ¨IPV4</span></span></span><br><span class="line">listen=NO</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># This directive enables listening on IPv6 sockets. By default, listening</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">on the IPv6 &quot;any&quot; address (::) will accept connections from both IPv6</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">and IPv4 clients. It is not necessary to listen on *both* IPv4 and IPv6</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">sockets. If you want that (perhaps because you want to listen on specific</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">addresses) then you must run two copies of vsftpd with two configuration</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">files.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Make sure, that one of the listen options is commented !!</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">æ˜¯å¦å¼€å¯ftpç‹¬ç«‹æ¨¡å¼åœ¨ipv6</span></span></span><br><span class="line">listen_ipv6=YES</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">å¯ç”¨pamæ¨¡å—éªŒè¯</span></span></span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">æ˜¯å¦å¼€å¯userliståŠŸèƒ½.</span></span></span><br><span class="line">å®šä¹‰å¯¹åˆ—è¡¨ä¸­çš„ç”¨æˆ·åšå®šä¹‰</span><br><span class="line">userlist_deny=NO</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">NOæ‹’ç»æ‰€æœ‰äººè®¿é—®ï¼Œå¯¹åº”åˆ—è¡¨ä¸­çš„ç”¨æˆ·å¯ä»¥è®¿é—®ï¼ŒYESå…è®¸æ‰€æœ‰äººè®¿é—®ï¼Œåˆ—è¡¨ä¸­çš„ç”¨æˆ·æ— æ³•è®¿é—®ã€‚</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">åªæœ‰userlist_file=/etc/vsftpd/user_listå®šä¹‰çš„ç”¨æˆ·æ‰å¯ä»¥è®¿é—®æˆ–æ‹’ç»è®¿é—®</span></span></span><br><span class="line">userlist_enable=YES</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">æ˜¯å¦å¼€å¯tcp_wrappersç®¡ç†ï¼ŒTCP_Wrappersæ˜¯ä¸€ä¸ªå·¥ä½œåœ¨ç¬¬å››å±‚ï¼ˆä¼ è¾“å±‚ï¼‰çš„çš„å®‰å…¨å·¥å…·ï¼Œ</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">å¯¹æœ‰çŠ¶æ€è¿æ¥çš„ç‰¹å®šæœåŠ¡è¿›è¡Œå®‰å…¨æ£€æµ‹å¹¶å®ç°è®¿é—®æ§åˆ¶</span></span></span><br><span class="line">tcp_wrappers=YES</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>åŒ¿åç”¨æˆ·å’Œæœ¬åœ°ç”¨æˆ·</p>
<ul>
<li><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŒ¿åç”¨æˆ·è®¿é—®çš„æ˜¯&#x2F;var&#x2F;ftpï¼Œè€Œæœ¬åœ°ç”¨æˆ·è®¿é—®çš„è¯æ˜¯å®¶ç›®å½•ã€‚</p>
</li>
<li><p>å…³äºæƒé™ï¼Œåœ¨ä¸»é…æ–‡ä»¶ä¸­è®¾ç½®çš„æƒé™æ˜¯åç ï¼Œæ–‡ä»¶å®é™…æƒé™ &#x3D; 666 - åç ã€‚</p>
</li>
<li><p>å‡å¦‚ä¸»é…æ–‡ä»¶ä¸­è®¾ç½®ä¸º022ï¼Œé‚£ä¹ˆæ–‡ä»¶å®é™…æƒé™ &#x3D; 666 - 022 &#x3D; 644ï¼Œæ–‡ä»¶å¤¹å®é™…æƒé™ &#x3D; 777 - 022 &#x3D; 755ã€‚</p>
</li>
<li><p>åœ¨linuxç«¯è®¿é—®FTPæœåŠ¡å™¨æ—¶ï¼Œæ— è®ºFTPæœåŠ¡å™¨æ˜¯å¦å¼€å¯äº†åŒ¿åç”¨æˆ·è®¿é—®ï¼Œå®¢æˆ·è®¿é—®æ—¶éƒ½è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼ŒåŒ¿åç”¨æˆ·ç”¨æˆ·åftpï¼Œå¯†ç éšæ„ï¼Œä½†æ˜¯éœ€è¦ä¸ºå¸¦æœ‰@çš„emailåœ°å€ã€‚</p>
</li>
</ul>
</li>
<li><p>å¼€å¯chroot</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¯å¦å¼€å¯å¯¹æœ¬åœ°ç”¨æˆ·<span class="built_in">chroot</span>çš„é™åˆ¶ï¼ŒYESä¸ºé»˜è®¤æ‰€æœ‰ç”¨æˆ·éƒ½ä¸èƒ½åˆ‡å‡ºå®¶ç›®å½•ï¼ŒNOä»£è¡¨é»˜è®¤ç”¨æˆ·éƒ½å¯ä»¥åˆ‡å‡ºå®¶ç›®å½•</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®æ–¹æ³•ç±»ä¼¼äºï¼šYESæ‹’ç»æ‰€æœ‰å…è®¸ä¸ªåˆ«ï¼›NOå…è®¸æ‰€æœ‰æ‹’ç»ä¸ªåˆ«</span></span><br><span class="line">chroot_local_user=YES</span><br><span class="line">chroot_list_enable=YES</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç‰¹ä¾‹åˆ—è¡¨</span></span><br><span class="line">chroot_list_file=/etc/vsftpd/chroot_list</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœç”¨æˆ·å®¶ç›®å½•æœ‰å†™æƒé™çš„è¯ï¼Œåˆ™è¯¥ç”¨æˆ·ç™»é™†ä¸ä¸Š</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœæƒ³åœ¨æœ‰å†™æƒé™çš„å®¶ç›®å½•ç™»å½•çš„è¯ï¼Œéœ€åœ¨é…ç½®æ–‡ä»¶åŠ ä¸Š</span></span><br><span class="line">allow_writeable_chroot=YES</span><br></pre></td></tr></table></figure>

<h3 id="3-3-FTPå‘½ä»¤"><a href="#3-3-FTPå‘½ä»¤" class="headerlink" title="3.3 FTPå‘½ä»¤"></a>3.3 FTPå‘½ä»¤</h3><p>ç™»å½•åˆ°FTPæœåŠ¡å™¨åï¼ŒåŸºæœ¬å‘½ä»¤å¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">help # æ‰“å°å‘½ä»¤èœå•</span><br><span class="line">!+linuxå‘½ä»¤ # æ‰§è¡Œlinuxå‘½ä»¤</span><br><span class="line">lcd ç›®å½•è·¯å¾„ # åˆ‡æ¢linuxå½“å‰è·¯å¾„</span><br><span class="line">put mput # ä¸Šä¼  æ‰¹é‡ä¸Šä¼ </span><br><span class="line">get mget # ä¸‹è½½ æ‰¹é‡ä¸‹è½½</span><br><span class="line">ls dir # åˆ—å‡ºç›®å½•å†…å®¹</span><br><span class="line">mkdir cd delete rmdir # åˆ›å»ºç›®å½• è¿›å…¥ç›®å½• åˆ é™¤æ–‡ä»¶ åˆ é™¤ç›®å½•</span><br><span class="line">pwd # ç°å®FTPå½“å‰è·¯å¾„</span><br><span class="line">open close bye # å¼€å¯/å…³é—­/é€€å‡ºFTP</span><br></pre></td></tr></table></figure>

<h3 id="3-4-è™šæ‹Ÿç”¨æˆ·"><a href="#3-4-è™šæ‹Ÿç”¨æˆ·" class="headerlink" title="3.4 è™šæ‹Ÿç”¨æˆ·"></a>3.4 è™šæ‹Ÿç”¨æˆ·</h3><p>ç”±äºFTPæ˜¯é‡‡ç”¨æœ¬åœ°ç”¨æˆ·æ¥è¿›è¡Œç™»å½•çš„ï¼Œæ‰€ä»¥ä¼šå°†æœ¬åœ°ç”¨æˆ·æš´éœ²åœ¨äº’è”ç½‘ä¸­ï¼Œå¦‚æœæ²¡æœ‰ç›¸å…³å®‰å…¨è®¾ç½®ï¼Œå°±ä¼šé€ æˆFTPä¸å®‰å…¨ã€‚</p>
<p>å› æ­¤FTPå¯ä»¥è®¾ç½®è™šæ‹Ÿç”¨æˆ·æ¥è§£å†³è¯¥é—®é¢˜ã€‚</p>
<p>åœ¨ä¸»é…æ–‡ä»¶ä¸­å¼€å¯è™šæ‹Ÿç”¨æˆ·</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">guest_enable=YES</span><br><span class="line">guest_username=cqm</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è™šæ‹Ÿç”¨æˆ·ä¸ç”¨æœ¬åœ°ç”¨æˆ·çš„æƒé™</span></span><br><span class="line">virtual_use_local_privs=NO</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç”¨æˆ·æ–‡ä»¶å­˜æ”¾åœ°å€</span></span><br><span class="line">user_config_dir=/etc/vsftpd/vconf.d</span><br></pre></td></tr></table></figure>

<h3 id="3-5-åŸºäºè™šæ‹Ÿç”¨æˆ·é…ç½®çš„å®‰å…¨FTP"><a href="#3-5-åŸºäºè™šæ‹Ÿç”¨æˆ·é…ç½®çš„å®‰å…¨FTP" class="headerlink" title="3.5 åŸºäºè™šæ‹Ÿç”¨æˆ·é…ç½®çš„å®‰å…¨FTP"></a>3.5 åŸºäºè™šæ‹Ÿç”¨æˆ·é…ç½®çš„å®‰å…¨FTP</h3><p>æ¡ˆä¾‹è¦æ±‚ï¼š</p>
<ul>
<li>å…¬å¸å…¬å…±æ–‡ä»¶å¯ä»¥é€šè¿‡åŒ¿åä¸‹è½½</li>
<li>å…¬å¼Aéƒ¨é—¨ã€Béƒ¨é—¨ã€Céƒ¨é—¨åˆ†åˆ«ç”±è‡ªå·±çš„æ–‡ä»¶å¤¹ï¼Œå¹¶ç›¸äº’éš”ç¦»</li>
<li>éƒ¨é—¨ä¹‹é—´åªæœ‰ä¸»ç®¡æ‹¥æœ‰ä¸Šä¼ æƒé™ï¼Œéƒ¨é—¨å‘˜å·¥åªæœ‰ä¸‹è½½æƒé™</li>
<li>ç¦æ­¢ç”¨æˆ·æŸ¥çœ‹å®¶ç›®å½•ä»¥å¤–çš„æ•°æ®</li>
<li>ç¡®ä¿FTPè´¦å·å®‰å…¨</li>
</ul>
<ol>
<li>åˆ›å»ºè™šæ‹Ÿç”¨æˆ·æ˜ å°„æœ¬åœ°è´¦å·</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -s /sbin/nologin -d /var/tmp/vuser_ftp cqm</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åˆ›å»ºç›®å½•ï¼Œæ‰€æœ‰æ“ä½œéƒ½åªèƒ½åœ¨æ­¤ç›®å½•è¿›è¡Œ</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chmod 500 /var/tmp/vuser_ftp</span><br><span class="line">mkdir /var/tmp/vuser_ftp/&#123;A,B,C&#125;</span><br><span class="line">chmod 700 /var/tmp/vuser_ftp/*</span><br><span class="line">chown -R cqm:cqm /var/tmp/vuser_ftp</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åˆ›å»ºè™šæ‹Ÿç”¨æˆ·è´¦å·å¯†ç æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆdbæ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/vsftpd/vuser</span><br><span class="line">A_01</span><br><span class="line">123</span><br><span class="line">B_01</span><br><span class="line">123</span><br><span class="line">C_01</span><br><span class="line">123</span><br><span class="line">A_02</span><br><span class="line">123</span><br><span class="line">B_02</span><br><span class="line">123</span><br><span class="line">C_02</span><br><span class="line">123</span><br><span class="line">db_load -T -t hash -f /etc/vsftpd/vuser /etc/vsftpd/vuser.db</span><br><span class="line">chmod 600 /etc/vsftpd/vuser.db</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>è®¾ç½®è™šæ‹Ÿç”¨æˆ·pamè®¤è¯</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/pam.d/vsftpd</span><br><span class="line">auth       sufficient   /lib64/security/pam_userdb.so db=/etc/vsftpd/vuser</span><br><span class="line">account    sufficient   /lib64/security/pam_userdb.so db=/etc/vsftpd/vuser</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>è¦æ±‚ä¸èƒ½åˆ‡å‡ºå®¶ç›®å½•ï¼Œæ‰€ä»¥è¦è®¾ç½®chroot_list</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/vsftpd/chroot_list</span><br><span class="line">A_01</span><br><span class="line">B_01</span><br><span class="line">C_01</span><br><span class="line">A_02</span><br><span class="line">B_02</span><br><span class="line">C_02</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>åˆ›å»ºå­é…ç½®æ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/vsftpd/vconf.d</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Aä¸»ç®¡æ–‡ä»¶</span></span><br><span class="line">vim /etc/vsftpd/vconf.d/A_01</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŒ‡å®šå®¶ç›®å½•</span></span><br><span class="line">local_root=/var/tmp/vuser_ftp/A</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŒ‡å®šæƒé™</span></span><br><span class="line">anon_umask=077</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸‹è½½æƒé™</span></span><br><span class="line">anon_world_readable_only=NO</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸Šä¼ æƒé™</span></span><br><span class="line">anon_upload_enable=YES</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºç›®å½•æƒé™</span></span><br><span class="line">anon_mkdir_write_enable=YES</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤å’Œé‡å‘½åç›®å½•æƒé™</span></span><br><span class="line">anon_other_write_enable=YES</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Aå‘˜å·¥æ–‡ä»¶</span></span><br><span class="line">vim /etc/vsftpd/vconf.d/A_02</span><br><span class="line">local_root=/var/tmp/vuser_ftp/A</span><br><span class="line">anon_world_readable_only=NO</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>é…ç½®ä¸»é…æ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/vsftpd/vsftpd.conf</span><br><span class="line">anonymous_enable=YES</span><br><span class="line">local_enable=YES</span><br><span class="line">write_enable=YES</span><br><span class="line">local_umask=022</span><br><span class="line">dirmessage_enable=YES</span><br><span class="line">xferlog_enable=YES</span><br><span class="line">connect_from_port_20=YES</span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">chroot_local_user=YES</span><br><span class="line">chroot_list_enable=YES</span><br><span class="line">chroot_list_file=/etc/vsftpd/chroot_list</span><br><span class="line">listen=YES</span><br><span class="line">listen_ipv6=NO</span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line">userlist_enable=YES</span><br><span class="line">tcp_wrappers=YES</span><br><span class="line">guest_enable=YES</span><br><span class="line">guest_username=cqm</span><br><span class="line">virtual_use_local_privs=NO</span><br><span class="line">user_config_dir=/etc/vsftpd/vconf.d</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>æµ‹è¯•ä¸»ç®¡ç”¨æˆ·å’Œå‘˜å·¥ç”¨æˆ·çš„æƒé™</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.88.132</span><br><span class="line">A_01</span><br><span class="line">123</span><br><span class="line">230 Login successful</span><br></pre></td></tr></table></figure>



<h2 id="å››ã€SambaæœåŠ¡"><a href="#å››ã€SambaæœåŠ¡" class="headerlink" title="å››ã€SambaæœåŠ¡"></a>å››ã€SambaæœåŠ¡</h2><h3 id="4-1-SambaæœåŠ¡ä»‹ç»"><a href="#4-1-SambaæœåŠ¡ä»‹ç»" class="headerlink" title="4.1 SambaæœåŠ¡ä»‹ç»"></a>4.1 SambaæœåŠ¡ä»‹ç»</h3><p>Sambaæ˜¯å¯ä»¥å®ç°ä¸åŒè®¡ç®—æœºç³»ç»Ÿä¹‹é—´æ–‡ä»¶å…±äº«çš„æœåŠ¡ï¼Œå³æ˜¯åœ¨Linuxå’ŒUNIXç³»ç»Ÿä¸Šå®ç°SMBåè®®çš„ä¸€ä¸ªå…è´¹è½¯ä»¶ã€‚</p>
<p>SMBï¼ˆServer Messages Blockï¼Œä¿¡æ¯æœåŠ¡å—ï¼‰æ˜¯ä¸€ç§åœ¨å±€åŸŸç½‘ä¸Šå…±äº«æ–‡ä»¶å’Œæ‰“å°æœºçš„ä¸€ç§é€šä¿¡åè®®ï¼Œå®ƒä¸ºå±€åŸŸç½‘å†…çš„ä¸åŒè®¡ç®—æœºä¹‹é—´æä¾›æ–‡ä»¶åŠæ‰“å°æœºç­‰èµ„æºçš„å…±äº«æœåŠ¡ã€‚</p>
<p>Sambaé‡‡ç”¨åˆ°çš„ç«¯å£æœ‰ï¼š</p>
<ul>
<li>UDP 137ï¼šNetBIOS åå­—æœåŠ¡</li>
<li>UDP 138ï¼šNetBIOS æ•°æ®æŠ¥æœåŠ¡</li>
<li>UDP 139ï¼šSMB</li>
<li>TCP 389ï¼šç”¨äº LDAP (Active Directory Mode)</li>
<li>TCP 445ï¼šNetBIOSæœåŠ¡åœ¨windos 2000åŠä»¥åç‰ˆæœ¬ä½¿ç”¨æ­¤ç«¯å£, (Common Internet File Systemï¼ŒCIFSï¼Œå®ƒæ˜¯SMBåè®®æ‰©å±•åˆ°Internetåï¼Œå®ç°Internetæ–‡ä»¶å…±äº«)</li>
<li>TCP 901ï¼šç”¨äº SWATï¼Œç”¨äºç½‘é¡µç®¡ç†Samba</li>
</ul>
<h3 id="4-2-SambaæœåŠ¡éƒ¨ç½²"><a href="#4-2-SambaæœåŠ¡éƒ¨ç½²" class="headerlink" title="4.2 SambaæœåŠ¡éƒ¨ç½²"></a>4.2 SambaæœåŠ¡éƒ¨ç½²</h3><ol>
<li>å®‰è£…samba</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install samba samba-client</span><br><span class="line">systemctl start smb nmb</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ä¸»é…æ–‡ä»¶è¯¦è§£</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/samba/smb.conf.example</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This is the main Samba configuration file. For detailed information about the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">options listed here, refer to the smb.conf(5) manual page. Samba has a huge</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">number of configurable options, most of <span class="built_in">which</span> are not shown <span class="keyword">in</span> this example.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The Samba Wiki contains a lot of step-by-step guides installing, configuring,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">and using Samba:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https://wiki.samba.org/index.php/User_Documentation</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># In this file, lines starting with a semicolon (;) or a hash (#) are</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">comments and are ignored. This file uses hashes to denote commentary and</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">semicolons <span class="keyword">for</span> parts of the file you may wish to configure.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># <span class="doctag">NOTE:</span> Run the &quot;testparm&quot; command after modifying this file to check for basic</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">syntax errors.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#---------------</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#SAMBA selinuxç›¸å…³è®¾ç½®ï¼Œå¦‚æœä½ å¼€å¯äº†selinuxï¼Œè¯·æ³¨æ„ä¸‹é¢çš„è¯´æ˜</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Security-Enhanced Linux (SELinux) Notes:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Turn the samba_domain_controller Boolean on to allow a Samba PDC to use the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">useradd and groupadd family of binaries. Run the following <span class="built_in">command</span> as the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">root user to turn this Boolean on:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœä½ åœ¨åŸŸç¯å¢ƒä¸­ä½¿ç”¨sambaé‚£ä¹ˆè¯·è®¾ç½®ä¸‹é¢çš„boolå€¼</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">setsebool -P samba_domain_controller on</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Turn the samba_enable_home_dirs Boolean on if you want to share home</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">directories via Samba. Run the following <span class="built_in">command</span> as the root user to turn this</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Boolean on:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># å‡å¦‚å¸Œæœ›é€šè¿‡sambaå…±äº«ç”¨æˆ·å®¶ç›®å½•è¯·è®¾ç½®ä¸‹é¢çš„boolå€¼</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">setsebool -P samba_enable_home_dirs on</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># If you create a new directory, such as a new top-level directory, label it</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">with samba_share_t so that SELinux allows Samba to <span class="built_in">read</span> and write to it. Do</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">not label system directories, such as /etc/ and /home/, with samba_share_t, as</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">such directories should already have an SELinux label.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#åŠ å…¥ä½ æƒ³å°†ç›®å½•é€šè¿‡sambaå…±äº«ï¼Œè¯·ç¡®è®¤å…¶ç›®å½•æ ‡ç­¾ä¸ºsambe_share_t</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Run the <span class="string">&quot;ls -ldZ /path/to/directory&quot;</span> <span class="built_in">command</span> to view the current SELinux</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">label <span class="keyword">for</span> a given directory.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Set SELinux labels only on files and directories you have created. Use the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">chcon</span> <span class="built_in">command</span> to temporarily change a label:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ‡ç­¾è®¾ç½®æ–¹æ³•</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">chcon</span> -t samba_share_t /path/to/directory</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Changes made via chcon are lost when the file system is relabeled or commands</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">such as restorecon are run.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Use the samba_export_all_ro or samba_export_all_rw Boolean to share system</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">directories. To share such directories and only allow read-only permissions:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯¹å…±äº«ç›®å½•çš„æƒé™çš„boolè®¾ç½®ï¼Œåªè¯»æˆ–è¯»å†™</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">setsebool -P samba_export_all_ro on</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">To share such directories and allow <span class="built_in">read</span> and write permissions:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">setsebool -P samba_export_all_rw on</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># To run scripts (preexec/root prexec/print command/...), copy them to the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/var/lib/samba/scripts/ directory so that SELinux will allow smbd to run them.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Note that <span class="keyword">if</span> you move the scripts to /var/lib/samba/scripts/, they retain</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">their existing SELinux labels, <span class="built_in">which</span> may be labels that SELinux does not allow</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">smbd to run. Copying the scripts will result <span class="keyword">in</span> the correct SELinux labels.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Run the <span class="string">&quot;restorecon -R -v /var/lib/samba/scripts&quot;</span> <span class="built_in">command</span> as the root user to</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">apply the correct SELinux labels to these files.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#--------------</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#======================= Global Settings =====================================</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å…¨å±€è®¾ç½®ï¼Œå¯¹æ•´ä¸ªæœåŠ¡éƒ½ç”Ÿæ•ˆ</span></span><br><span class="line">[global]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ç½‘ç»œè®¾ç½®</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">----------------------- Network-Related Options -------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># workgroup = the Windows NT domain name or workgroup name, for example, MYGROUP.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># server string = the equivalent of the Windows NT Description field.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># netbios name = used to specify a server name that is not tied to the hostname,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">               maximum is 15 characters.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># interfaces = used to configure Samba to listen on multiple network interfaces.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">If you have multiple interfaces, you can use the <span class="string">&quot;interfaces =&quot;</span> option to</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">configure <span class="built_in">which</span> of those interfaces Samba listens on. Never omit the localhost</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">interface (lo).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># hosts allow = the hosts allowed to connect. This option can also be used on a</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">per-share basis.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># hosts deny = the hosts not allowed to connect. This option can also be used on</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a per-share basis.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#å®šä¹‰è®¡ç®—æœºçš„å·¥ä½œç»„,å¦‚æœå¸Œæœ›å’Œwindowså…±äº«ï¼Œå¯ä»¥è®¾ç½®ä¸ºworkgroupï¼Œè¿™æ ·å°±å¯ä»¥åœ¨windowsçš„ç½‘ä¸Šé‚»å±…ä¸­æ‰¾åˆ°linuxè®¡ç®—æœº</span></span></span><br><span class="line">    workgroup = MYGROUP</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¯¹sambaæœåŠ¡å™¨çš„æè¿°ä¿¡æ¯</span></span><br><span class="line">    server string = Samba Server Version %v</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è®¾ç½®netbiosè®¡ç®—æœºåç§°</span></span><br><span class="line">;    netbios name = MYSERVER</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sambaä½¿ç”¨æœ¬æœºçš„é‚£å—ç½‘å¡</span></span><br><span class="line">;    interfaces = lo eth0 192.168.12.2/24 192.168.13.2/24</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å…è®¸é‚£ä¸ªç½‘æ®µè®¿é—®sambaæœåŠ¡å™¨å…±äº«</span></span><br><span class="line">;    hosts allow = 127. 192.168.12. 192.168.13.</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#æ—¥å¿—é€‰é¡¹</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--------------------------- Logging Options -----------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># log file = specify where log files are written to and how they are split.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># max log size = specify the maximum size log files are allowed to reach. Log</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">files are rotated when they reach the size specified with <span class="string">&quot;max log size&quot;</span>.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">    <span class="comment">#sambaæ—¥å¿—æ–‡ä»¶è·¯å¾„</span></span></span><br><span class="line">    # log files split per-machine:</span><br><span class="line">    log file = /var/log/samba/log.%m</span><br><span class="line">    #æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œ0ä¸ºä¸é™åˆ¶ï¼Œæ³¨æ„ä¸å»ºè®®è¿™æ ·è®¾ç½®</span><br><span class="line">    # maximum size of 50KB per log file, then rotate:</span><br><span class="line">    max log size = 50</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ç‹¬ç«‹æœåŠ¡é€‰é¡¹</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">----------------------- Standalone Server Options ------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># security = the mode Samba runs in. This can be set to user, share</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">(deprecated), or server (deprecated).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># passdb backend = the backend used to store user information in. New</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">installations should use either tdbsam or ldapsam. No additional configuration</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">is required <span class="keyword">for</span> tdbsam. The <span class="string">&quot;smbpasswd&quot;</span> utility is available <span class="keyword">for</span> backwards</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">compatibility.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#sambaå®‰å…¨çº§åˆ«</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">share:  ä¸éœ€è¦è´¦å·å¯†ç ï¼Œå…¬å¼€å…±äº«</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">user:   éœ€è¦æä¾›samè´¦å·å¯†ç æ‰èƒ½è®¿é—®å…±äº«ï¼Œç§å¯†å…±äº«</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">serverï¼šä¾é å…¶ä»–Windows NT/2000æˆ–Samba Serveræ¥éªŒè¯ç”¨æˆ·çš„è´¦å·å’Œå¯†ç ,æ˜¯ä¸€ç§ä»£ç†éªŒè¯ã€‚æ­¤ç§å®‰å…¨æ¨¡å¼ä¸‹,ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥æŠŠæ‰€æœ‰çš„Windowsç”¨æˆ·å’Œå£ä»¤é›†ä¸­åˆ°ä¸€ä¸ªNTç³»ç»Ÿä¸Š,&gt;ä½¿ç”¨Windows NTè¿›è¡ŒSambaè®¤è¯, è¿œç¨‹æœåŠ¡å™¨å¯ä»¥è‡ªåŠ¨è®¤è¯å…¨éƒ¨ç”¨æˆ·å’Œå£ä»¤,å¦‚æœè®¤è¯å¤±è´¥,Sambaå°†ä½¿ç”¨ç”¨æˆ·çº§å®‰å…¨æ¨¡å¼ä½œä¸ºæ›¿ä»£çš„æ–¹å¼ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">domainï¼šåŸŸå®‰å…¨çº§åˆ«,ä½¿ç”¨ä¸»åŸŸæ§åˆ¶å™¨(PDC)æ¥å®Œæˆè®¤è¯ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä½¿ç”¨shareå’Œuserçš„æ¯”è¾ƒå¤šï¼Œé™¤éå…¬å¸æœ‰å®Œæ•´çš„åŸŸç¯å¢ƒ</span></span></span><br><span class="line">    security = user</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¯¥æ–¹å¼åˆ™æ˜¯ä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶æ¥å»ºç«‹ç”¨æˆ·æ•°æ®åº“ã€‚æ•°æ®åº“æ–‡ä»¶å«passdb.tdbï¼Œé»˜è®¤åœ¨/etc/sambaç›®å½•ä¸‹ã€‚passdb.tdb ç”¨æˆ·æ•°æ®åº“å¯ä»¥ä½¿ç”¨smbpasswd â€“aæ¥å»ºç«‹Sambaç”¨æˆ·ï¼Œä¸è¿‡è¦å»ºç«‹çš„Sambaç”¨æˆ·å¿…é¡»å…ˆæ˜¯ç³»ç»Ÿç”¨æˆ·ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨pdbeditå‘½ä»¤æ¥å»ºç«‹Sambaè´¦æˆ·å¹¶ç”±å…¶pdbeditç®¡ç†ã€‚</span></span><br><span class="line">    passdb backend = tdbsam</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åŸŸæˆå‘˜é€‰é¡¹</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">----------------------- Domain Members Options ------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># security = must be set to domain or ads.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># passdb backend = the backend used to store user information in. New</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">installations should use either tdbsam or ldapsam. No additional configuration</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">is required <span class="keyword">for</span> tdbsam. The <span class="string">&quot;smbpasswd&quot;</span> utility is available <span class="keyword">for</span> backwards</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">compatibility.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># realm = only use the realm option when the &quot;security = ads&quot; option is set.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The realm option specifies the Active Directory realm the host is a part of.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># password server = only use this option when the &quot;security = server&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">option is <span class="built_in">set</span>, or <span class="keyword">if</span> you cannot use DNS to locate a Domain Controller. The</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">argument list can include My_PDC_Name, [My_BDC_Name], and [My_Next_BDC_Name]:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># password server = My_PDC_Name [My_BDC_Name] [My_Next_BDC_Name]</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Use &quot;password server = *&quot; to automatically locate Domain Controllers.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è®¾ç½®åŸŸå…±äº«</span></span><br><span class="line">;    security = domain</span><br><span class="line">;    passdb backend = tdbsam</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å®šä¹‰åŸŸåç§°</span></span><br><span class="line">;    realm = MY_REALM</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åŸŸéªŒè¯æœåŠ¡å™¨</span></span><br><span class="line">;    password server = </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åŸŸæ§é€‰é¡¹</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">----------------------- Domain Controller Options ------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># security = must be set to user for domain controllers.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># passdb backend = the backend used to store user information in. New</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">installations should use either tdbsam or ldapsam. No additional configuration</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">is required <span class="keyword">for</span> tdbsam. The <span class="string">&quot;smbpasswd&quot;</span> utility is available <span class="keyword">for</span> backwards</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">compatibility.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># domain master = specifies Samba to be the Domain Master Browser, allowing</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Samba to collate browse lists between subnets. Do not use the <span class="string">&quot;domain master&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">option <span class="keyword">if</span> you already have a Windows NT domain controller performing this task.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># domain logons = allows Samba to provide a network logon service for Windows</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">workstations.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># logon script = specifies a script to run at login time on the client. These</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">scripts must be provided <span class="keyword">in</span> a share named NETLOGON.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># logon path = specifies (with a UNC path) where user profiles are stored.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#</span></span></span><br><span class="line">;    security = user</span><br><span class="line">;    passdb backend = tdbsam</span><br><span class="line">;    domain master = yes</span><br><span class="line">;    domain logons = yes</span><br><span class="line">    # the following login script name is determined by the machine name</span><br><span class="line">    # (%m):</span><br><span class="line">;    logon script = %m.bat</span><br><span class="line">    # the following login script name is determined by the UNIX user used:</span><br><span class="line">;    logon script = %u.bat</span><br><span class="line">;    logon path = \\%L\Profiles\%u</span><br><span class="line">    # use an empty path to disable profile support:</span><br><span class="line">;    logon path =</span><br><span class="line">    # various scripts can be used on a domain controller or a stand-alone</span><br><span class="line">    # machine to add or delete corresponding UNIX accounts:</span><br><span class="line">;    add user script = /usr/sbin/useradd &quot;%u&quot; -n -g users</span><br><span class="line">;    add group script = /usr/sbin/groupadd &quot;%g&quot;</span><br><span class="line">;    add machine script = /usr/sbin/useradd -n -c &quot;Workstation (%u)&quot; -M -d /nohome -s /bin/false &quot;%u&quot;</span><br><span class="line">;    delete user script = /usr/sbin/userdel &quot;%u&quot;</span><br><span class="line">;    delete user from group script = /usr/sbin/userdel &quot;%u&quot; &quot;%g&quot;</span><br><span class="line">;    delete group script = /usr/sbin/groupdel &quot;%g&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿™äº›è®¾ç½®é€‰é¡¹ä¸»è¦ç”¨äºSMBç½‘ç»œä¸­è¿›è¡Œæµè§ˆæ—¶ï¼Œè®¾ç½®sambaæœåŠ¡å™¨çš„è¡Œä¸ºã€‚ç¼ºçœæƒ…å†µä¸è®© sambaæœåŠ¡å™¨å‚åŠ broswserçš„æ¨ä¸¾è¿‡ç¨‹ï¼Œä¸ºäº†ä½¿å¾—sambaæœåŠ¡å™¨èƒ½æˆä¸ºbrowserï¼Œå°±éœ€è¦è®¾å®š<span class="built_in">local</span> master =<span class="built_in">yes</span>ã€‚ç„¶åsambaæœåŠ¡å°±å¯ä»¥æ ¹æ®os levelè®¾ç½®çš„æƒé‡è¿›è¡Œæ¨ä¸¾ï¼Œç¼ºçœçš„os levelä¸º0ï¼Œè¿™ä¸ªæƒé‡ä¸ä¼šèµ¢å¾—æ¨ä¸¾ã€‚ä½†å¯ä»¥å–æ¶ˆæ³¨é‡Šï¼Œå°†os levelè®¾ç½®ä¸º33ï¼Œè¿™å°†åœ¨ä¸æ‰€æœ‰Windowsè®¡ç®—æœºï¼ˆåŒ…æ‹¬Windows NTï¼‰çš„æ¨ä¸¾ç«èµ›ä¸­è·å¾—èƒœåˆ©ï¼Œå› ä¸ºNT serverçš„æƒé‡ä¸º32ã€‚è®¾ç½®æ¯”33æ›´é«˜çš„æƒé‡ï¼Œåªæ˜¯åœ¨ä¸åŒçš„samba æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œé€‰æ‹©æ—¶æ‰æœ‰æ„ä¹‰ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># preferred master  å¯ä»¥è®¾ç½®è‡ªå·±ä¼˜å…ˆæˆä¸ºæµè§ˆæœåŠ¡å™¨å€™é€‰äºº</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ----------------------- Browser Control Options ----------------------------</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># local master = when set to no, Samba does not become the master browser on</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">your network. When <span class="built_in">set</span> to <span class="built_in">yes</span>, normal election rules apply.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># os level = determines the precedence the server has in master browser</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">elections. The default value should be reasonable.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># preferred master = when set to yes, Samba forces a local browser election at</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">start up (and gives itself a slightly higher chance of winning the election).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">;    <span class="built_in">local</span> master = no</span></span><br><span class="line">;    os level = 33</span><br><span class="line">;    preferred master = yes</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">winsæœåŠ¡ï¼Œå¦‚æœç½‘ç»œä¸­é…ç½®äº†winsæœåŠ¡å™¨å¯ä»¥åœ¨æ­¤è®¾ç½®winsç›¸å…³é¡¹</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">----------------------------- Name Resolution -------------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This section details the support for the Windows Internet Name Service (WINS).</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Note: Samba can be either a WINS server or a WINS client, but not both.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># wins support = when set to yes, the NMBD component of Samba enables its WINS</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">server.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># wins server = tells the NMBD component of Samba to be a WINS client.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># wins proxy = when set to yes, Samba answers name resolution queries on behalf</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">of a non WINS capable client. For this to work, there must be at least one</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">WINS server on the network. The default is no.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># dns proxy = when set to yes, Samba attempts to resolve NetBIOS names via DNS</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nslookups.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è®¾ç½®nmbè¿›ç¨‹æ”¯æŒwinsæœåŠ¡</span></span><br><span class="line">;    wins support = yes</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è®¾ç½®winsæœåŠ¡å™¨ip</span></span><br><span class="line">;    wins server = w.x.y.z</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è®¾ç½®winsä»£ç†IP</span></span><br><span class="line">;    wins proxy = yes</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è®¾ç½®SambaæœåŠ¡å™¨æ˜¯å¦åœ¨æ— æ³•è”ç³»WINSæœåŠ¡å™¨æ—¶é€šè¿‡DNSå»è§£æä¸»æœºçš„NetBIOSå</span></span><br><span class="line">;    dns proxy = yes</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¯¥éƒ¨åˆ†åŒ…æ‹¬SambaæœåŠ¡å™¨æ‰“å°æœºç›¸å…³è®¾ç½®</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--------------------------- Printing Options -----------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The options in this section allow you to configure a non-default printing</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">system.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># load printers = when set you yes, the list of printers is automatically</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">loaded, rather than setting them up individually.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># cups options = allows you to pass options to the CUPS library. Setting this</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">option to raw, <span class="keyword">for</span> example, allows you to use drivers on your Windows clients.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># printcap name = used to specify an alternative printcap file.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#æ˜¯å¦å¯ç”¨å…±äº«æ‰“å°æœº</span></span></span><br><span class="line">    load printers = yes</span><br><span class="line">    cups options = raw</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ‰“å°æœºé…ç½®æ–‡ä»¶</span></span><br><span class="line">;    printcap name = /etc/printcap</span><br><span class="line">    # obtain a list of printers automatically on UNIX System V systems:</span><br><span class="line">;    printcap name = lpstat</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ‰“å°æœºçš„ç³»ç»Ÿç±»å‹,ç°åœ¨æ”¯æŒçš„æ‰“å°ç³»ç»Ÿæœ‰ï¼šbsd, sysv, plp, lprng, aix, hpux, qnx,cups</span></span><br><span class="line">;    printing = cups</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¯¥éƒ¨åˆ†åŒ…æ‹¬SambaæœåŠ¡å™¨å¦‚ä½•ä¿ç•™ä»Windowså®¢æˆ·ç«¯å¤åˆ¶æˆ–ç§»åŠ¨åˆ°SambaæœåŠ¡å™¨å…±äº«ç›®å½•æ–‡ä»¶çš„Windowsæ–‡ä»¶å±æ€§çš„ç›¸å…³é…ç½®.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--------------------------- File System Options ---------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The options in this section can be un-commented if the file system supports</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">extended attributes, and those attributes are enabled (usually via the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;user_xattr&quot;</span> mount option). These options allow the administrator to specify</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">that DOS attributes are stored <span class="keyword">in</span> extended attributes and also make sure that</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Samba does not change the permission bits.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Note: These options can be used on a per-share basis. Setting them globally</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">(<span class="keyword">in</span> the [global] section) makes them the default <span class="keyword">for</span> all shares.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å½“Windowså®¢æˆ·ç«¯å°†æ–‡ä»¶å¤åˆ¶æˆ–ç§»åŠ¨åˆ°SambaæœåŠ¡å™¨å…±äº«ç›®å½•æ—¶ï¼Œæ˜¯å¦ä¿ç•™æ–‡ä»¶åœ¨Windowsä¸­çš„å­˜æ¡£å±æ€§ã€‚é»˜è®¤noã€‚</span></span><br><span class="line">;    map archive = no</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å½“Windowså®¢æˆ·ç«¯å°†æ–‡ä»¶å¤åˆ¶æˆ–ç§»åŠ¨åˆ°SambaæœåŠ¡å™¨å…±äº«ç›®å½•æ—¶ï¼Œæ˜¯å¦ä¿ç•™æ–‡ä»¶åœ¨Windowsä¸­çš„éšè—å±æ€§ã€‚é»˜è®¤noã€‚</span></span><br><span class="line">;    map hidden = no</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å½“Windowså®¢æˆ·ç«¯å°†æ–‡ä»¶å¤åˆ¶æˆ–ç§»åŠ¨åˆ°SambaæœåŠ¡å™¨å…±äº«ç›®å½•æ—¶ï¼Œæ˜¯å¦ä¿ç•™æ–‡ä»¶åœ¨Windowsä¸­çš„åªè¯»å±æ€§ã€‚é»˜è®¤ä¸ºnoã€‚</span></span><br><span class="line">;    map read only = no</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å½“Windowså®¢æˆ·ç«¯å°†æ–‡ä»¶å¤åˆ¶æˆ–ç§»åŠ¨åˆ°SambaæœåŠ¡å™¨å…±äº«ç›®å½•æ—¶ï¼Œæ˜¯å¦ä¿ç•™æ–‡ä»¶åœ¨Windowsä¸­çš„ç³»ç»Ÿæ–‡ä»¶å±æ€§ã€‚é»˜è®¤ä¸ºnoã€‚</span></span><br><span class="line">;    map system = no</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å½“Windowså®¢æˆ·ç«¯å°†æ–‡ä»¶å¤åˆ¶æˆ–ç§»åŠ¨åˆ°SambaæœåŠ¡å™¨å…±äº«ç›®å½•æ—¶ï¼Œæ˜¯å¦ä¿ç•™æ–‡ä»¶åœ¨Windowsä¸­çš„ç›¸å…³å±æ€§ï¼ˆåªè¯»ã€ç³»ç»Ÿã€éšè—ã€å­˜æ¡£å±æ€§ï¼‰ã€‚é»˜è®¤ä¸º<span class="built_in">yes</span>ã€‚</span></span><br><span class="line">;    store dos attributes = yes</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å…±äº«è®¾ç½®</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">============================ Share Definitions ==============================</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ç”¨æˆ·å®¶ç›®å½•å…±äº«</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å…±äº«åç§°</span></span><br><span class="line">[homes]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æè¿°</span></span><br><span class="line">    comment = Home Directories</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ˜¯å¦æ”¯æŒæµè§ˆ</span></span><br><span class="line">    browseable = no</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ˜¯å¦å…è®¸å†™å…¥</span></span><br><span class="line">    writable = yes</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å…è®¸è®¿é—®è¯¥å…±äº«èµ„æºçš„smbç”¨æˆ·ï¼Œ@ç»„</span></span><br><span class="line">;    valid users = %S</span><br><span class="line">;    valid users = MYDOMAIN\%S</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ‰“å°æœºå…±äº«</span></span><br><span class="line">[printers]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æè¿°</span></span><br><span class="line">    comment = All Printers</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è·¯å¾„</span></span><br><span class="line">    path = /var/spool/samba</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ˜¯å¦å¯æµè§ˆï¼Œnoç±»ä¼¼éšè—å…±äº«</span></span><br><span class="line">    browseable = no</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ˜¯å¦æ”¯æŒguestè®¿é—®ï¼Œå’ŒpublicæŒ‡ä»¤ç±»ä¼¼</span>    </span><br><span class="line">    guest ok = no</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ˜¯å¦å¯å†™</span></span><br><span class="line">    writable = no</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ˜¯å¦å…è®¸æ‰“å°</span></span><br><span class="line">    printable = yes</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Un-comment the following and create the netlogon directory <span class="keyword">for</span> Domain Logons:</span></span><br><span class="line">;    [netlogon]</span><br><span class="line">;    comment = Network Logon Service</span><br><span class="line">;    path = /var/lib/samba/netlogon</span><br><span class="line">;    guest ok = yes</span><br><span class="line">;    writable = no</span><br><span class="line">;    share modes = no</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Un-comment the following to provide a specific roaming profile share.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The default is to use the user<span class="string">&#x27;s home directory:</span></span></span><br><span class="line">;    [Profiles]</span><br><span class="line">;    path = /var/lib/samba/profiles</span><br><span class="line">;    browseable = no</span><br><span class="line">;    guest ok = yes</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">A publicly accessible directory that is read only, except for users in the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;staff&quot; group (which have write permissions):</span></span></span><br><span class="line">;    [public]</span><br><span class="line">;    comment = Public Stuff</span><br><span class="line">;    path = /home/samba</span><br><span class="line">;    public = yes</span><br><span class="line">;    writable = no</span><br><span class="line">;    printable = no</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">å®šä¹‰å…è®¸å“ªäº›smbç”¨æˆ·å†™å…¥</span></span></span><br><span class="line">;    write list = +staff</span><br></pre></td></tr></table></figure>

<h3 id="4-3-Sambaå…±äº«"><a href="#4-3-Sambaå…±äº«" class="headerlink" title="4.3 Sambaå…±äº«"></a>4.3 Sambaå…±äº«</h3><p>æ¡ˆä¾‹ï¼šåœ¨Windowsä¸Šè®¿é—®SambaæœåŠ¡å™¨ï¼Œå…±äº«ç›®å½•ä¸º&#x2F;commonï¼ŒæŒ‡å®šç”¨cqm1ã€cqm2ç”¨æˆ·æ‰èƒ½è®¿é—®ï¼Œä¸”åªæœ‰cqm2æœ‰å†™æƒé™ã€‚</p>
<ol>
<li>åˆ›å»ºSambaç”¨æˆ·</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">smbpasswdç”¨æˆ·å‘½ä»¤</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-a æ·»åŠ ç”¨æˆ· smbpasswd -a cqm</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-x åˆ é™¤ç”¨æˆ· smbpasswd -x cqm</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-d ç¦ç”¨å¸å· smbpasswd -d cqm</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-e å–æ¶ˆç¦ç”¨ smbpasswd -e cqm</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-n æ¸…é™¤å¯†ç  smbpasswd -a cqm</span></span><br><span class="line">useradd -s /sbin/nologin cqm1</span><br><span class="line">useradd -s /sbin/nologin cqm2</span><br><span class="line">smbpasswd -a cqm1</span><br><span class="line">smbpasswd -a cqm2</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åˆ›å»ºå…±äº«ç›®å½•</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /common</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®757æ˜¯ä¸ºäº†è®©cqm2æœ‰å†™æƒé™</span></span><br><span class="line">chmod 757 /common</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ä¿®æ”¹ä¸»é…æ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">		workgroup = WORKGROUP</span><br><span class="line">		...</span><br><span class="line">[common]</span><br><span class="line">        comment = samba share directory</span><br><span class="line">        path = /common</span><br><span class="line">        browseable = YES</span><br><span class="line">        hosts allow = 10.0.0.0/8,192.168.88.0/24</span><br><span class="line">        valid users = cqm1,cqm2</span><br><span class="line">        writable = No</span><br><span class="line">        write list = cqm2</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>åœ¨Windowsä¸­è¾“å…¥ \\192.168.88.132 è®¿é—®</li>
</ol>
<p>é¦–å…ˆæ˜¯cqm1ç”¨æˆ·</p>
<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/Samba%E4%B8%80.png" alt="Sambaä¸€"></p>
<p>å¯ä»¥çœ‹åˆ°cqm1ç”¨æˆ·æ²¡æœ‰å†™å…¥æƒé™</p>
<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/Samba%E4%BA%8C.png" alt="SambaäºŒ"></p>
<p>cqm2ç”¨æˆ·</p>
<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/Samba%E4%B8%89.png" alt="Sambaä¸‰"></p>
<p>å¯ä»¥çœ‹åˆ°cqm2ç”¨æˆ·æœ‰åˆ›å»ºæ–‡ä»¶å¤¹çš„æƒé™</p>
<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/Samba%E5%9B%9B.png" alt="Sambaå››"></p>
<h3 id="4-4-LinuxæŒ‚è½½"><a href="#4-4-LinuxæŒ‚è½½" class="headerlink" title="4.4 LinuxæŒ‚è½½"></a>4.4 LinuxæŒ‚è½½</h3><ol>
<li>åœ¨å®¢æˆ·ç«¯ä¸Šå®‰è£…samba-client</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install samba-client</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>é€šè¿‡smbclientå‘½ä»¤è®¿é—®</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient //192.168.88.132/common -U cqm2%toortoor</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>é€šè¿‡mountå‘½ä»¤æŒ‚è½½</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /common</span><br><span class="line">mount -o username=cqm2,password=toortoor -t cifs //192.168.88.132/common /common</span><br><span class="line">mount</span><br><span class="line">//192.168.88.132/common on /common type cifs (rw,relatime,vers=default,cache=strict,username=cqm2,domain=LOCALHOST,uid=0,noforceuid,gid=0,noforcegid,addr=192.168.88.132,file_mode=0755,dir_mode=0755,soft,nounix,serverino,mapposix,rsize=1048576,wsize=1048576,echo_interval=60,actimeo=1)</span><br></pre></td></tr></table></figure>



<h2 id="äº”ã€NFSæ–‡ä»¶æœåŠ¡"><a href="#äº”ã€NFSæ–‡ä»¶æœåŠ¡" class="headerlink" title="äº”ã€NFSæ–‡ä»¶æœåŠ¡"></a>äº”ã€NFSæ–‡ä»¶æœåŠ¡</h2><h3 id="5-1-NFSæœåŠ¡ä»‹ç»"><a href="#5-1-NFSæœåŠ¡ä»‹ç»" class="headerlink" title="5.1 NFSæœåŠ¡ä»‹ç»"></a>5.1 NFSæœåŠ¡ä»‹ç»</h3><p>NFSå³ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒå…è®¸ç½‘ç»œä¸­çš„è®¡ç®—æœºä¹‹é—´é€šè¿‡TCP&#x2F;IPç½‘ç»œå…±äº«èµ„æºã€‚åœ¨NFSçš„åº”ç”¨ä¸­ï¼Œæœ¬åœ°NFSçš„å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥é€æ˜åœ°è¯»å†™ä½äºè¿œç«¯NFSæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œå°±åƒè®¿é—®æœ¬åœ°æ–‡ä»¶ä¸€æ ·ã€‚</p>
<p>NFSåº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>å…±äº«å­˜å‚¨æœåŠ¡å™¨ï¼šå›¾ç‰‡æœåŠ¡å™¨ã€è§†é¢‘æœåŠ¡å™¨</li>
<li>å®¶ç›®å½•æ¼«æ¸¸ï¼šåŸŸç”¨æˆ·å®¶ç›®å½•æœåŠ¡å™¨</li>
<li>æ–‡ä»¶æœåŠ¡å™¨ï¼šæ–‡ä»¶å­˜å‚¨æœåŠ¡å™¨</li>
</ul>
<h3 id="5-2-NFSå®ç°å…±äº«"><a href="#5-2-NFSå®ç°å…±äº«" class="headerlink" title="5.2 NFSå®ç°å…±äº«"></a>5.2 NFSå®ç°å…±äº«</h3><ol>
<li>å®‰è£…NFS</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nfs-utils</span><br><span class="line">systemctl start rpcbind</span><br><span class="line">systemctl start nfs</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>&#x2F;etc&#x2F;exportså…±äº«æ–‡ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…±äº«æ ¼å¼</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…±äº«ç›®å½•ç»å¯¹è·¯å¾„ IPåœ°å€æˆ–ç½‘æ®µåœ°å€(æƒé™1,æƒé™2)</span></span><br><span class="line">/test 192.168.88.132(rw,sync)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æƒé™è¯´æ˜</span></span><br><span class="line">ro                      åªè¯»è®¿é—®  </span><br><span class="line">rw                      è¯»å†™è®¿é—®  </span><br><span class="line">sync                    æ‰€æœ‰æ•°æ®åœ¨è¯·æ±‚æ—¶å†™å…¥å…±äº«  </span><br><span class="line">async                   NFSåœ¨å†™å…¥æ•°æ®å‰å¯ä»¥ç›¸åº”è¯·æ±‚  </span><br><span class="line">secure                  NFSé€šè¿‡1024ä»¥ä¸‹çš„å®‰å…¨TCP/IPç«¯å£å‘é€  </span><br><span class="line">insecure                NFSé€šè¿‡1024ä»¥ä¸Šçš„ç«¯å£å‘é€  </span><br><span class="line">wdelay                  å¦‚æœå¤šä¸ªç”¨æˆ·è¦å†™å…¥NFSç›®å½•ï¼Œåˆ™å½’ç»„å†™å…¥ï¼ˆé»˜è®¤ï¼‰  </span><br><span class="line">no_wdelay               å¦‚æœå¤šä¸ªç”¨æˆ·è¦å†™å…¥NFSç›®å½•ï¼Œåˆ™ç«‹å³å†™å…¥ï¼Œå½“ä½¿ç”¨asyncæ—¶ï¼Œæ— éœ€æ­¤è®¾ç½®ã€‚  </span><br><span class="line">hide                    åœ¨NFSå…±äº«ç›®å½•ä¸­ä¸å…±äº«å…¶å­ç›®å½•  </span><br><span class="line">no_hide                 å…±äº«NFSç›®å½•çš„å­ç›®å½•  </span><br><span class="line">subtree_check           å¦‚æœå…±äº«/usr/binä¹‹ç±»çš„å­ç›®å½•æ—¶ï¼Œå¼ºåˆ¶NFSæ£€æŸ¥çˆ¶ç›®å½•çš„æƒé™ï¼ˆé»˜è®¤ï¼‰  </span><br><span class="line">no_subtree_check        å’Œä¸Šé¢ç›¸å¯¹ï¼Œä¸æ£€æŸ¥çˆ¶ç›®å½•æƒé™  </span><br><span class="line">all_squash              å…±äº«æ–‡ä»¶çš„UIDå’ŒGIDæ˜ å°„åŒ¿åç”¨æˆ·anonymousï¼Œé€‚åˆå…¬ç”¨ç›®å½•ã€‚  </span><br><span class="line">no_all_squash           ä¿ç•™å…±äº«æ–‡ä»¶çš„UIDå’ŒGIDï¼ˆé»˜è®¤ï¼‰  </span><br><span class="line">root_squash             rootç”¨æˆ·çš„æ‰€æœ‰è¯·æ±‚æ˜ å°„æˆå¦‚anonymousç”¨æˆ·ä¸€æ ·çš„æƒé™ï¼ˆé»˜è®¤ï¼‰  </span><br><span class="line">no_root_squash          rootç”¨æˆ·å…·æœ‰æ ¹ç›®å½•çš„å®Œå…¨ç®¡ç†è®¿é—®æƒé™  </span><br><span class="line">anonuid=xxx          	æŒ‡å®šNFSæœåŠ¡å™¨/etc/passwdæ–‡ä»¶ä¸­åŒ¿åç”¨æˆ·çš„UID  </span><br><span class="line">anongid=xxx          	æŒ‡å®šNFSæœåŠ¡å™¨/etc/passwdæ–‡ä»¶ä¸­åŒ¿åç”¨æˆ·çš„GID</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>exportfså…±äº«ç®¡ç†å‘½ä»¤</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">exportfså‘½ä»¤ï¼š</span><br><span class="line">-a     æ‰“å¼€æˆ–å–æ¶ˆæ‰€æœ‰ç›®å½•å…±äº«ã€‚</span><br><span class="line">-o     options,... æŒ‡å®šä¸€åˆ—å…±äº«é€‰é¡¹ï¼Œä¸ exports(5) ä¸­è®²åˆ°çš„ç±»ä¼¼ã€‚</span><br><span class="line">-i     å¿½ç•¥ /etc/exports æ–‡ä»¶ï¼Œä»è€Œåªä½¿ç”¨é»˜è®¤çš„å’Œå‘½ä»¤è¡ŒæŒ‡å®šçš„é€‰é¡¹ã€‚</span><br><span class="line">-r     é‡æ–°å…±äº«æ‰€æœ‰ç›®å½•ã€‚å®ƒä½¿/var/lib/nfs/xtabå’Œ/etc/exportsåŒæ­¥ã€‚å®ƒå°†/etc/exportsä¸­å·²åˆ é™¤çš„æ¡ç›®ä» /var/lib/nfs/xtabä¸­åˆ é™¤ï¼Œå°†å†…æ ¸å…±äº«è¡¨ä¸­ä»»ä½•ä¸å†æœ‰æ•ˆçš„æ¡ç›®ç§»é™¤ã€‚</span><br><span class="line">-u     å–æ¶ˆä¸€ä¸ªæˆ–å¤šä¸ªç›®å½•çš„å…±äº«ã€‚</span><br><span class="line">-f     åœ¨â€œæ–°â€æ¨¡å¼ä¸‹ï¼Œåˆ·æ–°å†…æ ¸å…±äº«è¡¨ä¹‹å¤–çš„ä»»ä½•ä¸œè¥¿ã€‚</span><br><span class="line">       ä»»ä½•æ´»åŠ¨çš„å®¢æˆ·ç¨‹åºå°†åœ¨å®ƒä»¬çš„ä¸‹æ¬¡è¯·æ±‚ä¸­å¾—åˆ°mountd æ·»åŠ çš„æ–°çš„å…±äº«æ¡ç›®ã€‚</span><br><span class="line">-v     è¾“å‡ºè¯¦ç»†ä¿¡æ¯ã€‚å½“å…±äº«æˆ–è€…å–æ¶ˆå…±äº«æ—¶ï¼Œæ˜¾ç¤ºåœ¨åšä»€ä¹ˆã€‚</span><br><span class="line">       æ˜¾ç¤ºå½“å‰å…±äº«åˆ—è¡¨çš„æ—¶å€™ï¼ŒåŒæ—¶æ˜¾ç¤ºå…±äº«çš„é€‰é¡¹ã€‚</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è®¾ç½®å…±äº«</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºè¢«å…±äº«ç›®å½•</span></span><br><span class="line">mkdir /test</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®exports</span></span><br><span class="line">vim /etc/exports</span><br><span class="line">/test 192.168.88.0/24(rw,sync)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…±äº«</span></span><br><span class="line">exportfs -r</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ˜¯å¦å…±äº«</span></span><br><span class="line">exportfs -v</span><br><span class="line">showmount -e 192.168.88.132</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>å®¢æˆ·ç«¯æŒ‚è½½</li>
</ol>
<p>å®¢æˆ·ç«¯æŒ‚è½½æ˜¯ä½¿ç”¨nfsnobodyç”¨æˆ·è¿›è¡Œçš„ï¼Œå¦‚æœæ˜¯rootåˆ›å»ºçš„å…±äº«ç›®å½•ï¼Œä¸”å®¢æˆ·ç«¯æŒ‚è½½åè¦è¿›è¡Œè¯»å†™çš„è¯ï¼Œå¾—ç»™ç›®å½•757çš„æƒé™ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t nfs 192.168.88.132:/test /test</span><br></pre></td></tr></table></figure>



<h2 id="å…­ã€iSCSIæœåŠ¡"><a href="#å…­ã€iSCSIæœåŠ¡" class="headerlink" title="å…­ã€iSCSIæœåŠ¡"></a>å…­ã€iSCSIæœåŠ¡</h2><h3 id="6-1-iSCSIä»‹ç»"><a href="#6-1-iSCSIä»‹ç»" class="headerlink" title="6.1 iSCSIä»‹ç»"></a>6.1 iSCSIä»‹ç»</h3><p>iSCSIå³ç½‘ç»œå°å‹è®¡ç®—æœºç³»ç»Ÿæ¥å£ï¼Œåˆè¢«ç§°ä¸ºIPSANã€‚å®é™…å°±æ˜¯é€šè¿‡ç½‘ç»œæ¥å…±äº«è®¾å¤‡ã€‚</p>
<p>æ•°æ®å­˜å‚¨æŠ€æœ¯ï¼š</p>
<ul>
<li>DSAï¼ˆDirect Attached Storage ç›´æ¥é™„åŠ å­˜å‚¨ï¼‰ï¼šIDE SATA SAS SCSIï¼ˆæœ¬åœ°ç£ç›˜ï¼‰</li>
<li>NSAï¼ˆNetwork Attached Storage ç½‘ç»œé™„åŠ å­˜å‚¨ï¼‰ï¼šSamba NFSï¼ˆå…±äº«æ–‡ä»¶å¤¹ï¼‰</li>
<li>SANï¼ˆStorage Attached Network ç½‘ç»œé™„åŠ å­˜å‚¨ï¼‰ï¼šiSCSIï¼ˆå…±äº«è®¾å¤‡ï¼‰</li>
</ul>
<h3 id="6-2-iSCSIæœåŠ¡éƒ¨ç½²"><a href="#6-2-iSCSIæœåŠ¡éƒ¨ç½²" class="headerlink" title="6.2 iSCSIæœåŠ¡éƒ¨ç½²"></a>6.2 iSCSIæœåŠ¡éƒ¨ç½²</h3><ol>
<li>å‡†å¤‡å¥½è¦è¢«æŒ‚è½½çš„ç£ç›˜ï¼Œè¿™é‡Œå…±äº«sdb1</li>
</ol>
<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/iSCSI%E4%B8%80.png" alt="iSCSIä¸€"></p>
<ol start="2">
<li>å®‰è£…iSCSI</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install targetcli</span><br><span class="line">sysetmctl start target</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>é€šè¿‡targetcliå‘½ä»¤æ·»åŠ è®¾å¤‡å…±äº«</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥å‘½ä»¤è¡Œ</span></span><br><span class="line">targetcli</span><br><span class="line">ls</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">backstores ä»£è¡¨åç«¯å­˜å‚¨,iscsié€šè¿‡ä½¿ç”¨æ–‡ä»¶ã€é€»è¾‘å·æˆ–ä»»ä½•ç±»å‹çš„ç£ç›˜ä½œä¸ºåº•å±‚å­˜å‚¨æ¥ä»¿çœŸå‘ˆç°ä¸ºç›®æ ‡çš„scsiè®¾å¤‡</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">block      åç«¯å­˜å‚¨æ˜¯ä¸ªå—è®¾å¤‡</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">fileio     åç«¯å­˜å‚¨æ˜¯ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pscsi      ç‰©ç†scsiè®¾å¤‡</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ramdisk    åç«¯å­˜å‚¨æ˜¯å†…å­˜ä¸Šçš„ç©ºé—´ï¼Œåœ¨å†…å­˜ä¸Šåˆ›å»ºä¸€ä¸ªæŒ‡å®šå¤§å°çš„ramdiskè®¾å¤‡å¯ä»¥é€šè¿‡<span class="built_in">help</span>å‘½ä»¤æ¥æ‰“å°å¯ç”¨å‘½ä»¤</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†è¦å…±äº«çš„è®¾å¤‡æ·»åŠ åˆ°backstoreså­˜å‚¨åº“ä¸­</span></span><br><span class="line">cd backstores/</span><br><span class="line">block/ creat block /dev/sdb1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®IQNæ ‡è¯†</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ ¼å¼ï¼šiqn.å¹´-æœˆ.äºŒçº§åŸŸåå€’å†™:å…±äº«å</span></span><br><span class="line">cd ..</span><br><span class="line">iscsi/ create iqn.2021-04.com.cqm:storage</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®TPGç»„ä¸­å¯¹åº”çš„ä¸‰ä¸ªé—®é¢˜ è° ä»å“ªé‡Œ è®¿é—®ä»€ä¹ˆè®¾å¤‡</span></span><br><span class="line">cd iscsi/iqn.2021-04.com.cqm:storage/tpg1/</span><br><span class="line">acls/ create iqn.2021-04.com.cqm:client</span><br><span class="line">luns/ create /backstores/block/block</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<h3 id="6-3-iSCSIå®¢æˆ·ç«¯æŒ‚è½½"><a href="#6-3-iSCSIå®¢æˆ·ç«¯æŒ‚è½½" class="headerlink" title="6.3 iSCSIå®¢æˆ·ç«¯æŒ‚è½½"></a>6.3 iSCSIå®¢æˆ·ç«¯æŒ‚è½½</h3><ol>
<li>å®‰è£…iSCSIå®¢æˆ·ç«¯</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install iscsi-initiator-utils</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è®¾ç½®å®¢æˆ·ç«¯åç§°</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/iscsi/initiatorname.iscsi</span><br><span class="line">InitiatorName=iqn.2021-04.com.cqm:client</span><br><span class="line">systemctl start iscsi</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å‘ç°å…±äº«è®¾å¤‡</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iscsiadm --mode discoverydb --type sendtargets --portal 192.168.88.132:3260 --discover</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>è¿æ¥è¿œç¨‹è®¾å¤‡</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iscsiadm --mode node --targetname iqn.2021-04.com.cqm:storage --portal 192.168.88.132:3260 --login</span><br><span class="line">lsblk</span><br><span class="line">...</span><br><span class="line">sdb</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>åˆ†åŒºæ ¼å¼åŒ–</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/sdb</span><br><span class="line">...</span><br><span class="line">mkfs.ext4 /dev/sdb1</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>æŒ‚è½½å…±äº«ç£ç›˜</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /root/sdb1</span><br><span class="line">vim /etc/fstab</span><br><span class="line">/dev/sdb1 /root/sdb1                            ext4    _netdev        0 0</span><br><span class="line">mount -a</span><br></pre></td></tr></table></figure>

<h3 id="6-4-iSCSIå–æ¶ˆæŒ‚è½½"><a href="#6-4-iSCSIå–æ¶ˆæŒ‚è½½" class="headerlink" title="6.4 iSCSIå–æ¶ˆæŒ‚è½½"></a>6.4 iSCSIå–æ¶ˆæŒ‚è½½</h3><ol>
<li>å®¢æˆ·ç«¯</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iscsiadm --mode node --targetname iqn.2021-04.com.cqm:storage --portal 192.168.88.132:3260 --logout</span><br><span class="line">rm -rf /var/lib/iscsi/nodes/iqn.2021-04.com.cqm\:storage/</span><br><span class="line">rm -rf /var/lib/iscsi/send_targets/192.168.88.132,3260/</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æœåŠ¡ç«¯</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å€’ç€åˆ </span></span><br><span class="line">targetcli</span><br><span class="line">iscsi/iqn.2021-04.com.cqm:storage/tpg1/portals/ delete 0.0.0.0 3260</span><br><span class="line">iscsi/iqn.2021-04.com.cqm:storage/tpg1/luns/ delete lun=0</span><br><span class="line">iscsi/iqn.2021-04.com.cqm:storage/tpg1/acls/ delete iqn.2021-04.com.cqm:client</span><br><span class="line">iscsi/ delete iqn.2021-04.com.cqm:storage</span><br><span class="line">backstores/block/ delete block</span><br></pre></td></tr></table></figure>



<h2 id="ä¸ƒã€IPSANå¤šé“¾è·¯éƒ¨ç½²"><a href="#ä¸ƒã€IPSANå¤šé“¾è·¯éƒ¨ç½²" class="headerlink" title="ä¸ƒã€IPSANå¤šé“¾è·¯éƒ¨ç½²"></a>ä¸ƒã€IPSANå¤šé“¾è·¯éƒ¨ç½²</h2><p>åœ¨ä¸Šè¾¹çš„ç¯å¢ƒä¸­çš„å…±äº«è®¾å¤‡æ˜¯é€šè¿‡å•é“¾è·¯å…±äº«çš„ï¼Œå¦‚æœè¿™æ¡é“¾è·¯å‡ºç°äº†æ•…éšœï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°è¿æ¥ä¸ä¸Šå…±äº«è®¾å¤‡çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ½ä¼šé…ç½®å¤šé“¾è·¯è¿›è¡Œéƒ¨ç½²ã€‚</p>
<p>iSCSIæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆ†åˆ«æ‹¥æœ‰ä¸¤å¼ ä¸åŒç½‘æ®µçš„ç½‘å¡ï¼Œå°±å¯ä»¥é…ç½®å¤šé“¾è·¯éƒ¨ç½²ã€‚</p>
<h3 id="7-1-éƒ¨ç½²å¤šé“¾è·¯"><a href="#7-1-éƒ¨ç½²å¤šé“¾è·¯" class="headerlink" title="7.1 éƒ¨ç½²å¤šé“¾è·¯"></a>7.1 éƒ¨ç½²å¤šé“¾è·¯</h3><ol>
<li>åœ¨æœåŠ¡ç«¯ä¸Šè®¾ç½®å…±äº«è®¾å¤‡ï¼Œå¹¶ç”¨ä¸¤ä¸ªIPè¿›è¡Œå…±äº«</li>
</ol>
<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/iSCSI%E4%BA%94.png" alt="iSCSIäº”"></p>
<ol start="2">
<li>åœ¨å®¢æˆ·ç«¯å‘ç°å…±äº«è®¾å¤‡</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/iscsi/initiatorname.iscsi</span><br><span class="line">InitiatorName=iqn.2021-04.com.cqm:client</span><br><span class="line"></span><br><span class="line">systemctl start iscsi</span><br><span class="line"></span><br><span class="line">iscsiadm --mode discoverydb --type sendtargets --portal 192.168.88.132:3260 --discover 192.168.88.132:3260,1 iqn.2021-04.com.cqm:storage 192.168.99.130:3260,1 iqn.2021-04.com.cqm:storage</span><br><span class="line"></span><br><span class="line">iscsiadm --mode node --targetname iqn.2021-04.com.cqm:storage --portal 192.168.88.132:3260 --login</span><br><span class="line">iscsiadm --mode node --targetname iqn.2021-04.com.cqm:storage --portal 192.168.99.130:3260 --login</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™é€šè¿‡lsblkå‘½ä»¤å¯ä»¥çœ‹åˆ°å¤šäº†ä¸¤å—è®¾å¤‡ï¼Œä½†å…¶å®æ˜¯åŒä¸€ä¸ªè®¾å¤‡ä¸åŒå</p>
<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/iSCSI%E4%B8%89.png" alt="iSCSIä¸‰"></p>
<ol start="3">
<li>å®‰è£…å¤šè·¯å¾„è½¯ä»¶</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install device-mapper-multipath</span><br><span class="line">cp /usr/share/doc/device-mapper-multipath-0.4.9/multipath.conf /etc/</span><br><span class="line">systemctl start multipathd</span><br></pre></td></tr></table></figure>

<p>å†ç”¨lsblkå‘½ä»¤æŸ¥çœ‹å¯å‘ç°</p>
<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/iSCSI%E5%9B%9B.png" alt="iSCSIå››"></p>
<ol start="4">
<li>é…ç½®å¤šè·¯å¾„è¿è¡Œæ¨¡å¼</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">multipath -ll</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">wwid:36001405ac25fe1abdfd4eecb1d0624b2</span></span><br><span class="line">mpatha (36001405ac25fe1abdfd4eecb1d0624b2) dm-2 LIO-ORG ,block</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">vim /etc/multipath.conf</span><br><span class="line">multipaths &#123;</span><br><span class="line">        multipath &#123;</span><br><span class="line">                wwid                    36001405ac25fe1abdfd4eecb1d0624b2 # wwid</span><br><span class="line">                alias                   cqm # èµ·å</span><br><span class="line">                path_grouping_policy    multibus # å¤šè·¯å¾„ç»„ç­–ç•¥</span><br><span class="line">                path_selector           &quot;round-robin 0&quot; # è´Ÿè½½å‡è¡¡æ¨¡å¼</span><br><span class="line">                failback                manual</span><br><span class="line">                rr_weight               priorities # æŒ‰ä¼˜å…ˆçº§è½®è¯¢</span><br><span class="line">                no_path_retry           5 # é‡è¯•æ—¶é—´5s</span><br><span class="line">        &#125;</span><br><span class="line">        multipath &#123;</span><br><span class="line">                wwid                    1DEC_____321816758474</span><br><span class="line">                alias                   red</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">systemctl restart multipathd</span><br><span class="line">systemctl restart iscsi</span><br><span class="line"></span><br><span class="line">multipath -ll</span><br><span class="line">cqm (36001405ac25fe1abdfd4eecb1d0624b2) dm-2 LIO-ORG ,block</span><br><span class="line">size=1023M features=&#x27;1 queue_if_no_path&#x27; hwhandler=&#x27;0&#x27; wp=rw</span><br><span class="line">`-+- policy=&#x27;round-robin 0&#x27; prio=1 status=active</span><br><span class="line">  |- 5:0:0:0 sdb 8:16 active ready running</span><br><span class="line">  `- 6:0:0:0 sdc 8:32 active ready running</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>æŒ‚è½½</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /root/test</span><br><span class="line">mount /dev/mapper/cqm1 /root/test</span><br></pre></td></tr></table></figure>

<h3 id="7-2-æµ‹è¯•"><a href="#7-2-æµ‹è¯•" class="headerlink" title="7.2 æµ‹è¯•"></a>7.2 æµ‹è¯•</h3><p>å°†ä¸€å—ç½‘å¡æ–­æ‰ï¼Œçœ‹æ˜¯å¦è¿˜èƒ½ä½¿ç”¨iSCSIè®¾å¤‡</p>
<ol>
<li>æ–­å¼€ç½‘å¡ens33</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifdown ens33</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/iSCSI%E5%85%AD.png" alt="iSCSIå…­"></p>
<ol start="2">
<li>ä¾æ—§å¯ä»¥åœ¨iSCSIè®¾å¤‡ä¸Šå†™å…¥æ•°æ®</li>
</ol>
<p><img src="/2024/02/18/linux%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/iSCSI%E4%B8%83.png" alt="iSCSIä¸ƒ"></p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/4/">Previous</a></div><div class="pagination-next"><a href="/page/6/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/4/">4</a></li><li><a class="pagination-link is-current" href="/page/5/">5</a></li><li><a class="pagination-link" href="/page/6/">6</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/NUX_Octodex.gif" alt="Warner"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Warner</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Shenzhen</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">27</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">18</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/cqmmm/" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/cqmmm/"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://wiki.sanxian.tech/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">sanxian</span></span><span class="level-right"><span class="level-item tag">wiki.sanxian.tech</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-03-31T07:44:02.000Z">2024-03-31</time></p><p class="title"><a href="/2024/03/31/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1ipv4-forward%E8%A2%AB%E4%BF%AE%E6%94%B9%E5%AF%BC%E8%87%B4%E7%9A%84%E7%94%9F%E4%BA%A7%E4%BA%8B%E6%95%85/">è®°å½•ä¸€æ¬¡ipv4_forwardè¢«ä¿®æ”¹å¯¼è‡´çš„ç”Ÿäº§äº‹æ•…</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-03-30T15:59:11.000Z">2024-03-30</time></p><p class="title"><a href="/2024/03/30/K8s%E7%BB%99%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E8%AE%BE%E7%BD%AE%E4%B8%93%E4%BA%AB%E8%8A%82%E7%82%B9/">K8sç»™å‘½åç©ºé—´è®¾ç½®ä¸“äº«èŠ‚ç‚¹</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-03-30T13:23:16.000Z">2024-03-30</time></p><p class="title"><a href="/2024/03/30/CoreDNS%E5%92%8CNodeLocalDNS%E7%9A%84%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/">CoreDNSå’ŒNodeLocalDNSçš„åŸŸåè§£æ</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-03-30T11:51:11.000Z">2024-03-30</time></p><p class="title"><a href="/2024/03/30/kube-proxy%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/">kube-proxyå·¥ä½œåŸç†</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-03-30T11:07:40.000Z">2024-03-30</time></p><p class="title"><a href="/2024/03/30/CNI%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/">CNIå·¥ä½œæµç¨‹</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">March 2024</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">February 2024</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ansible/"><span class="tag">ansible</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cisco/"><span class="tag">cisco</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/container/"><span class="tag">container</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/containerd/"><span class="tag">containerd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/elk/"><span class="tag">elk</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/etcd/"><span class="tag">etcd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jenkins/"><span class="tag">jenkins</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/k8s/"><span class="tag">k8s</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kafka/"><span class="tag">kafka</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nexus/"><span class="tag">nexus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/prometheus/"><span class="tag">prometheus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zookeeper/"><span class="tag">zookeeper</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%A6%96%E9%A1%B5/"><span class="tag">é¦–é¡µ</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/logo.jpg" alt="Warner&#039;s Wiki" height="28"></a><p class="is-size-7"><span>&copy; 2024 Warner</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/cqmmm/"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>